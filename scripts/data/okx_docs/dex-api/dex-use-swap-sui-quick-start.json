{
  "title": "在 Sui 链上搭建兑换应用 | 搭建兑换应用 | 指南 | 交易 API | DEX API | DEX API 文档 | 欧易",
  "text": "在 Sui 链上搭建兑换应用\n#\n在Sui上使用OKX DEX构建兑换应用程序有两种方法：\nAPI 方法 - 直接调用 OKX DEX API\nSDK方法 - 使用\n@okx-dex/okx-dex-sdk\n，简化了开发人员的体验\n本指南涵盖了这两种方法，以帮助你选择最适合你需求的方法。\n方法1：API方法\n#\n在本指南中，我们将提供通过OKX DEX进行Sui代币兑换的用例。\n1. 设置环境\n#\n导入必要的Node. js库并设置环境变量：\n// Required libraries\nimport\n{\nSuiWallet\n}\nfrom\n\"@okxweb3/coin-sui\"\n;\nimport\n{\ngetFullnodeUrl\n,\nSuiClient\n}\nfrom\n'@mysten/sui/client'\n;\nimport\n{\nTransaction\n}\nfrom\n'@mysten/sui/transactions'\n;\nimport\ncryptoJS\nfrom\n\"crypto-js\"\n;\n// Install dependencies\n// npm i @okxweb3/coin-sui\n// npm i @mysten/sui\n// npm i crypto-js\n// Set up environment variables\nconst\napiKey\n=\n'your_api_key'\n;\nconst\nsecretKey\n=\n'your_secret_key'\n;\nconst\napiPassphrase\n=\n'your_passphrase'\n;\nconst\nprojectId\n=\n'your_project_id'\n;\nconst\nuserAddress\n=\n'your_sui_wallet_address'\n;\nconst\nuserPrivateKey\n=\n'your_sui_wallet_private_key'\n;\n// Constants\nconst\nSUI_CHAIN_ID\n=\n\"784\"\n;\nconst\nDEFAULT_GAS_BUDGET\n=\n50000000\n;\nconst\nMAX_RETRIES\n=\n3\n;\n// Initialize Sui client\nconst\nwallet\n=\nnew\nSuiWallet\n(\n)\n;\nconst\nclient\n=\nnew\nSuiClient\n(\n{\nurl\n:\ngetFullnodeUrl\n(\n'mainnet'\n)\n}\n)\n;\n// For Sui, you need to use the hexWithoutFlag format of your private key\n// You can convert your key using sui keytool:\n// sui keytool convert <your_sui_private_key>\n2. 获取代币信息和兑换报价\n#\n首先，创建一个实用函数来处理API身份验证标头：\nfunction\ngetHeaders\n(\ntimestamp\n,\nmethod\n,\nrequestPath\n,\nqueryString\n=\n\"\"\n)\n{\nif\n(\n!\napiKey\n||\n!\nsecretKey\n||\n!\napiPassphrase\n||\n!\nprojectId\n)\n{\nthrow\nnew\nError\n(\n\"Missing required environment variables\"\n)\n;\n}\nconst\nstringToSign\n=\ntimestamp\n+\nmethod\n+\nrequestPath\n+\nqueryString\n;\nreturn\n{\n\"Content-Type\"\n:\n\"application/json\"\n,\n\"OK-ACCESS-KEY\"\n:\napiKey\n,\n\"OK-ACCESS-SIGN\"\n:\ncryptoJS\n.\nenc\n.\nBase64\n.\nstringify\n(\ncryptoJS\n.\nHmacSHA256\n(\nstringToSign\n,\nsecretKey\n)\n)\n,\n\"OK-ACCESS-TIMESTAMP\"\n:\ntimestamp\n,\n\"OK-ACCESS-PASSPHRASE\"\n:\napiPassphrase\n,\n\"OK-ACCESS-PROJECT\"\n:\nprojectId\n,\n}\n;\n}\n然后，创建一个函数来获取令牌信息：\nasync\nfunction\ngetTokenInfo\n(\nfromTokenAddress\n,\ntoTokenAddress\n)\n{\nconst\ntimestamp\n=\nnew\nDate\n(\n)\n.\ntoISOString\n(\n)\n;\nconst\nrequestPath\n=\n\"/api/v5/dex/aggregator/quote\"\n;\nconst\nparams\n=\n{\nchainId\n:\nSUI_CHAIN_ID\n,\nfromTokenAddress\n,\ntoTokenAddress\n,\namount\n:\n\"1000000\"\n,\nslippage\n:\n\"0.5\"\n,\n}\n;\nconst\nqueryString\n=\n\"?\"\n+\nnew\nURLSearchParams\n(\nparams\n)\n.\ntoString\n(\n)\n;\nconst\nheaders\n=\ngetHeaders\n(\ntimestamp\n,\n\"GET\"\n,\nrequestPath\n,\nqueryString\n)\n;\nconst\nresponse\n=\nawait\nfetch\n(\nhttps\n:\n/\n/\nweb3\n.\nokx\n.\ncom$\n{\nrequestPath\n}\n$\n{\nqueryString\n}\n,\n{\nmethod\n:\n\"GET\"\n,\nheaders\n}\n)\n;\nif\n(\n!\nresponse\n.\nok\n)\n{\nthrow\nnew\nError\n(\nFailed\nto\nget\nquote\n:\n$\n{\nawait\nresponse\n.\ntext\n(\n)\n}\n)\n;\n}\nconst\ndata\n=\nawait\nresponse\n.\njson\n(\n)\n;\nif\n(\ndata\n.\ncode\n!==\n\"0\"\n||\n!\ndata\n.\ndata\n?.\n[\n0\n]\n)\n{\nthrow\nnew\nError\n(\n\"Failed to get token information\"\n)\n;\n}\nconst\nquoteData\n=\ndata\n.\ndata\n[\n0\n]\n;\nreturn\n{\nfromToken\n:\n{\nsymbol\n:\nquoteData\n.\nfromToken\n.\ntokenSymbol\n,\ndecimals\n:\nparseInt\n(\nquoteData\n.\nfromToken\n.\ndecimal\n)\n,\nprice\n:\nquoteData\n.\nfromToken\n.\ntokenUnitPrice\n}\n,\ntoToken\n:\n{\nsymbol\n:\nquoteData\n.\ntoToken\n.\ntokenSymbol\n,\ndecimals\n:\nparseInt\n(\nquoteData\n.\ntoToken\n.\ndecimal\n)\n,\nprice\n:\nquoteData\n.\ntoToken\n.\ntokenUnitPrice\n}\n}\n;\n}\n创建一个函数将人类可读的数量转换为基本单位：\nfunction\nconvertAmount\n(\namount\n,\ndecimals\n)\n{\ntry\n{\nif\n(\n!\namount\n||\nisNaN\n(\nparseFloat\n(\namount\n)\n)\n)\n{\nthrow\nnew\nError\n(\n\"Invalid amount\"\n)\n;\n}\nconst\nvalue\n=\nparseFloat\n(\namount\n)\n;\nif\n(\nvalue\n<=\n0\n)\n{\nthrow\nnew\nError\n(\n\"Amount must be greater than 0\"\n)\n;\n}\nreturn\n(\nBigInt\n(\nMath\n.\nfloor\n(\nvalue\n*\nMath\n.\npow\n(\n10\n,\ndecimals\n)\n)\n)\n)\n.\ntoString\n(\n)\n;\n}\ncatch\n(\nerr\n)\n{\nconsole\n.\nerror\n(\n\"Amount conversion error:\"\n,\nerr\n)\n;\nthrow\nnew\nError\n(\n\"Invalid amount format\"\n)\n;\n}\n}\n3. 处理和签署交易\n#\n从/swap获得数据后，你需要处理并签署事务：\nasync\nfunction\nexecuteSwap\n(\ntxData\n,\nprivateKey\n)\n{\n// Create transaction block\nconst\ntxBlock\n=\nTransaction\n.\nfrom\n(\ntxData\n)\n;\ntxBlock\n.\nsetSender\n(\nnormalizedWalletAddress\n)\n;\n// Set gas parameters\nconst\nreferenceGasPrice\n=\nawait\nclient\n.\ngetReferenceGasPrice\n(\n)\n;\ntxBlock\n.\nsetGasPrice\n(\nBigInt\n(\nreferenceGasPrice\n)\n)\n;\ntxBlock\n.\nsetGasBudget\n(\nBigInt\n(\nDEFAULT_GAS_BUDGET\n)\n)\n;\n// Build and sign transaction\nconst\nbuiltTx\n=\nawait\ntxBlock\n.\nbuild\n(\n{\nclient\n}\n)\n;\nconst\ntxBytes\n=\nBuffer\n.\nfrom\n(\nbuiltTx\n)\n.\ntoString\n(\n'base64'\n)\n;\nconst\nsignedTx\n=\nawait\nwallet\n.\nsignTransaction\n(\n{\nprivateKey\n,\ndata\n:\n{\ntype\n:\n'raw'\n,\ndata\n:\ntxBytes\n}\n}\n)\n;\nif\n(\n!\nsignedTx\n?.\nsignature\n)\n{\nthrow\nnew\nError\n(\n\"Failed to sign transaction\"\n)\n;\n}\nreturn\n{\nbuiltTx\n,\nsignature\n:\nsignedTx\n.\nsignature\n}\n;\n}\n4. 执行交易\n#\n最后，执行签名交易：\nasync\nfunction\nsendTransaction\n(\nbuiltTx\n,\nsignature\n)\n{\n// Execute transaction\nconst\nresult\n=\nawait\nclient\n.\nexecuteTransactionBlock\n(\n{\ntransactionBlock\n:\nbuiltTx\n,\nsignature\n:\n[\nsignature\n]\n,\noptions\n:\n{\nshowEffects\n:\ntrue\n,\nshowEvents\n:\ntrue\n,\n}\n}\n)\n;\n// Wait for confirmation\nconst\nconfirmation\n=\nawait\nclient\n.\nwaitForTransaction\n(\n{\ndigest\n:\nresult\n.\ndigest\n,\noptions\n:\n{\nshowEffects\n:\ntrue\n,\nshowEvents\n:\ntrue\n,\n}\n}\n)\n;\nconsole\n.\nlog\n(\n\"\\nSwap completed successfully!\"\n)\n;\nconsole\n.\nlog\n(\n\"Transaction ID:\"\n,\nresult\n.\ndigest\n)\n;\nconsole\n.\nlog\n(\n\"Explorer URL:\"\n,\nhttps\n:\n/\n/\nsuiscan\n.\nxyz\n/\nmainnet\n/\ntx\n/\n$\n{\nresult\n.\ndigest\n}\n)\n;\nreturn\nresult\n.\ndigest\n;\n}\n5. 完整实现\n#\n这是一个完整的实现，将所有内容整合在一起：\n// swap.ts\nimport\n{\nSuiWallet\n}\nfrom\n\"@okxweb3/coin-sui\"\n;\nimport\n{\ngetFullnodeUrl\n,\nSuiClient\n}\nfrom\n'@mysten/sui/client'\n;\nimport\n{\nTransaction\n}\nfrom\n'@mysten/sui/transactions'\n;\nimport\ncryptoJS\nfrom\n\"crypto-js\"\n;\nimport\ndotenv\nfrom\n'dotenv'\n;\ndotenv\n.\nconfig\n(\n)\n;\n// Environment variables\nconst\napiKey\n=\nprocess\n.\nenv\n.\nOKX_API_KEY\n;\nconst\nsecretKey\n=\nprocess\n.\nenv\n.\nOKX_SECRET_KEY\n;\nconst\napiPassphrase\n=\nprocess\n.\nenv\n.\nOKX_API_PASSPHRASE\n;\nconst\nprojectId\n=\nprocess\n.\nenv\n.\nOKX_PROJECT_ID\n;\nconst\nuserAddress\n=\nprocess\n.\nenv\n.\nWALLET_ADDRESS\n;\nconst\nuserPrivateKey\n=\nprocess\n.\nenv\n.\nPRIVATE_KEY\n;\n// Constants\nconst\nSUI_CHAIN_ID\n=\n\"784\"\n;\nconst\nDEFAULT_GAS_BUDGET\n=\n50000000\n;\nconst\nMAX_RETRIES\n=\n3\n;\n// Initialize clients\nconst\nwallet\n=\nnew\nSuiWallet\n(\n)\n;\nconst\nclient\n=\nnew\nSuiClient\n(\n{\nurl\n:\ngetFullnodeUrl\n(\n'mainnet'\n)\n}\n)\n;\n// Normalize wallet address\nconst\nnormalizedWalletAddress\n=\nuserAddress\n;\nfunction\ngetHeaders\n(\ntimestamp\n,\nmethod\n,\nrequestPath\n,\nqueryString\n=\n\"\"\n)\n{\nif\n(\n!\napiKey\n||\n!\nsecretKey\n||\n!\napiPassphrase\n||\n!\nprojectId\n)\n{\nthrow\nnew\nError\n(\n\"Missing required environment variables\"\n)\n;\n}\nconst\nstringToSign\n=\ntimestamp\n+\nmethod\n+\nrequestPath\n+\nqueryString\n;\nreturn\n{\n\"Content-Type\"\n:\n\"application/json\"\n,\n\"OK-ACCESS-KEY\"\n:\napiKey\n,\n\"OK-ACCESS-SIGN\"\n:\ncryptoJS\n.\nenc\n.\nBase64\n.\nstringify\n(\ncryptoJS\n.\nHmacSHA256\n(\nstringToSign\n,\nsecretKey\n)\n)\n,\n\"OK-ACCESS-TIMESTAMP\"\n:\ntimestamp\n,\n\"OK-ACCESS-PASSPHRASE\"\n:\napiPassphrase\n,\n\"OK-ACCESS-PROJECT\"\n:\nprojectId\n,\n}\n;\n}\nasync\nfunction\ngetTokenInfo\n(\nfromTokenAddress\n,\ntoTokenAddress\n)\n{\nconst\ntimestamp\n=\nnew\nDate\n(\n)\n.\ntoISOString\n(\n)\n;\nconst\nrequestPath\n=\n\"/api/v5/dex/aggregator/quote\"\n;\nconst\nparams\n=\n{\nchainId\n:\nSUI_CHAIN_ID\n,\nfromTokenAddress\n,\ntoTokenAddress\n,\namount\n:\n\"1000000\"\n,\nslippage\n:\n\"0.5\"\n,\n}\n;\nconst\nqueryString\n=\n\"?\"\n+\nnew\nURLSearchParams\n(\nparams\n)\n.\ntoString\n(\n)\n;\nconst\nheaders\n=\ngetHeaders\n(\ntimestamp\n,\n\"GET\"\n,\nrequestPath\n,\nqueryString\n)\n;\nconst\nresponse\n=\nawait\nfetch\n(\nhttps\n:\n/\n/\nweb3\n.\nokx\n.\ncom$\n{\nrequestPath\n}\n$\n{\nqueryString\n}\n,\n{\nmethod\n:\n\"GET\"\n,\nheaders\n}\n)\n;\nif\n(\n!\nresponse\n.\nok\n)\n{\nthrow\nnew\nError\n(\nFailed\nto\nget\nquote\n:\n$\n{\nawait\nresponse\n.\ntext\n(\n)\n}\n)\n;\n}\nconst\ndata\n=\nawait\nresponse\n.\njson\n(\n)\n;\nif\n(\ndata\n.\ncode\n!==\n\"0\"\n||\n!\ndata\n.\ndata\n?.\n[\n0\n]\n)\n{\nthrow\nnew\nError\n(\n\"Failed to get token information\"\n)\n;\n}\nconst\nquoteData\n=\ndata\n.\ndata\n[\n0\n]\n;\nreturn\n{\nfromToken\n:\n{\nsymbol\n:\nquoteData\n.\nfromToken\n.\ntokenSymbol\n,\ndecimals\n:\nparseInt\n(\nquoteData\n.\nfromToken\n.\ndecimal\n)\n,\nprice\n:\nquoteData\n.\nfromToken\n.\ntokenUnitPrice\n}\n,\ntoToken\n:\n{\nsymbol\n:\nquoteData\n.\ntoToken\n.\ntokenSymbol\n,\ndecimals\n:\nparseInt\n(\nquoteData\n.\ntoToken\n.\ndecimal\n)\n,\nprice\n:\nquoteData\n.\ntoToken\n.\ntokenUnitPrice\n}\n}\n;\n}\nfunction\nconvertAmount\n(\namount\n,\ndecimals\n)\n{\ntry\n{\nif\n(\n!\namount\n||\nisNaN\n(\nparseFloat\n(\namount\n)\n)\n)\n{\nthrow\nnew\nError\n(\n\"Invalid amount\"\n)\n;\n}\nconst\nvalue\n=\nparseFloat\n(\namount\n)\n;\nif\n(\nvalue\n<=\n0\n)\n{\nthrow\nnew\nError\n(\n\"Amount must be greater than 0\"\n)\n;\n}\nreturn\n(\nBigInt\n(\nMath\n.\nfloor\n(\nvalue\n*\nMath\n.\npow\n(\n10\n,\ndecimals\n)\n)\n)\n)\n.\ntoString\n(\n)\n;\n}\ncatch\n(\nerr\n)\n{\nconsole\n.\nerror\n(\n\"Amount conversion error:\"\n,\nerr\n)\n;\nthrow\nnew\nError\n(\n\"Invalid amount format\"\n)\n;\n}\n}\nasync\nfunction\nmain\n(\n)\n{\ntry\n{\nconst\nargs\n=\nprocess\n.\nargv\n.\nslice\n(\n2\n)\n;\nif\n(\nargs\n.\nlength\n<\n3\n)\n{\nconsole\n.\nlog\n(\n\"Usage: ts-node swap.ts <amount> <fromTokenAddress> <toTokenAddress>\"\n)\n;\nconsole\n.\nlog\n(\n\"Example: ts-node swap.ts 1.5 0x2::sui::SUI 0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC\"\n)\n;\nprocess\n.\nexit\n(\n1\n)\n;\n}\nconst\n[\namount\n,\nfromTokenAddress\n,\ntoTokenAddress\n]\n=\nargs\n;\nif\n(\n!\nuserPrivateKey\n||\n!\nuserAddress\n)\n{\nthrow\nnew\nError\n(\n\"Private key or user address not found\"\n)\n;\n}\n// Get token information\nconsole\n.\nlog\n(\n\"Getting token information...\"\n)\n;\nconst\ntokenInfo\n=\nawait\ngetTokenInfo\n(\nfromTokenAddress\n,\ntoTokenAddress\n)\n;\nconsole\n.\nlog\n(\nFrom\n:\n$\n{\ntokenInfo\n.\nfromToken\n.\nsymbol\n}\n(\n$\n{\ntokenInfo\n.\nfromToken\n.\ndecimals\n}\ndecimals\n)\n)\n;\nconsole\n.\nlog\n(\nTo\n:\n$\n{\ntokenInfo\n.\ntoToken\n.\nsymbol\n}\n(\n$\n{\ntokenInfo\n.\ntoToken\n.\ndecimals\n}\ndecimals\n)\n)\n;\n// Convert amount using fetched decimals\nconst\nrawAmount\n=\nconvertAmount\n(\namount\n,\ntokenInfo\n.\nfromToken\n.\ndecimals\n)\n;\nconsole\n.\nlog\n(\nAmount\nin\n$\n{\ntokenInfo\n.\nfromToken\n.\nsymbol\n}\nbase units\n:\n,\nrawAmount\n)\n;\n// Get swap quote\nconst\nquoteParams\n=\n{\nchainId\n:\nSUI_CHAIN_ID\n,\namount\n:\nrawAmount\n,\nfromTokenAddress\n,\ntoTokenAddress\n,\nslippage\n:\n\"0.5\"\n,\nuserWalletAddress\n:\nnormalizedWalletAddress\n,\n}\n;\n// Get swap data\nconst\ntimestamp\n=\nnew\nDate\n(\n)\n.\ntoISOString\n(\n)\n;\nconst\nrequestPath\n=\n\"/api/v5/dex/aggregator/swap\"\n;\nconst\nqueryString\n=\n\"?\"\n+\nnew\nURLSearchParams\n(\nquoteParams\n)\n.\ntoString\n(\n)\n;\nconst\nheaders\n=\ngetHeaders\n(\ntimestamp\n,\n\"GET\"\n,\nrequestPath\n,\nqueryString\n)\n;\nconsole\n.\nlog\n(\n\"Requesting swap quote...\"\n)\n;\nconst\nresponse\n=\nawait\nfetch\n(\nhttps\n:\n/\n/\nweb3\n.\nokx\n.\ncom$\n{\nrequestPath\n}\n$\n{\nqueryString\n}\n,\n{\nmethod\n:\n\"GET\"\n,\nheaders\n}\n)\n;\nconst\ndata\n=\nawait\nresponse\n.\njson\n(\n)\n;\nif\n(\ndata\n.\ncode\n!==\n\"0\"\n)\n{\nthrow\nnew\nError\n(\nAPI\nError\n:\n$\n{\ndata\n.\nmsg\n}\n)\n;\n}\nconst\nswapData\n=\ndata\n.\ndata\n[\n0\n]\n;\n// Show estimated output and price impact\nconst\noutputAmount\n=\nparseFloat\n(\nswapData\n.\nrouterResult\n.\ntoTokenAmount\n)\n/\nMath\n.\npow\n(\n10\n,\ntokenInfo\n.\ntoToken\n.\ndecimals\n)\n;\nconsole\n.\nlog\n(\n\"\\nSwap Quote:\"\n)\n;\nconsole\n.\nlog\n(\nInput\n:\n$\n{\namount\n}\n$\n{\ntokenInfo\n.\nfromToken\n.\nsymbol\n}\n(\n$$\n{\n(\nparseFloat\n(\namount\n)\n*\nparseFloat\n(\ntokenInfo\n.\nfromToken\n.\nprice\n)\n)\n.\ntoFixed\n(\n2\n)\n}\n)\n)\n;\nconsole\n.\nlog\n(\nOutput\n:\n$\n{\noutputAmount\n.\ntoFixed\n(\ntokenInfo\n.\ntoToken\n.\ndecimals\n)\n}\n$\n{\ntokenInfo\n.\ntoToken\n.\nsymbol\n}\n(\n$$\n{\n(\noutputAmount\n*\nparseFloat\n(\ntokenInfo\n.\ntoToken\n.\nprice\n)\n)\n.\ntoFixed\n(\n2\n)\n}\n)\n)\n;\nif\n(\nswapData\n.\npriceImpactPercentage\n)\n{\nconsole\n.\nlog\n(\nPrice\nImpact\n:\n$\n{\nswapData\n.\npriceImpactPercentage\n}\n%\n)\n;\n}\nconsole\n.\nlog\n(\n\"\\nExecuting swap transaction...\"\n)\n;\nlet\nretryCount\n=\n0\n;\nwhile\n(\nretryCount\n<\nMAX_RETRIES\n)\n{\ntry\n{\n// Create transaction block\nconst\ntxBlock\n=\nTransaction\n.\nfrom\n(\nswapData\n.\ntx\n.\ndata\n)\n;\ntxBlock\n.\nsetSender\n(\nnormalizedWalletAddress\n)\n;\n// Set gas parameters\nconst\nreferenceGasPrice\n=\nawait\nclient\n.\ngetReferenceGasPrice\n(\n)\n;\ntxBlock\n.\nsetGasPrice\n(\nBigInt\n(\nreferenceGasPrice\n)\n)\n;\ntxBlock\n.\nsetGasBudget\n(\nBigInt\n(\nDEFAULT_GAS_BUDGET\n)\n)\n;\n// Build and sign transaction\nconst\nbuiltTx\n=\nawait\ntxBlock\n.\nbuild\n(\n{\nclient\n}\n)\n;\nconst\ntxBytes\n=\nBuffer\n.\nfrom\n(\nbuiltTx\n)\n.\ntoString\n(\n'base64'\n)\n;\nconst\nsignedTx\n=\nawait\nwallet\n.\nsignTransaction\n(\n{\nprivateKey\n:\nuserPrivateKey\n,\ndata\n:\n{\ntype\n:\n'raw'\n,\ndata\n:\ntxBytes\n}\n}\n)\n;\nif\n(\n!\nsignedTx\n?.\nsignature\n)\n{\nthrow\nnew\nError\n(\n\"Failed to sign transaction\"\n)\n;\n}\n// Execute transaction\nconst\nresult\n=\nawait\nclient\n.\nexecuteTransactionBlock\n(\n{\ntransactionBlock\n:\nbuiltTx\n,\nsignature\n:\n[\nsignedTx\n.\nsignature\n]\n,\noptions\n:\n{\nshowEffects\n:\ntrue\n,\nshowEvents\n:\ntrue\n,\n}\n}\n)\n;\n// Wait for confirmation\nconst\nconfirmation\n=\nawait\nclient\n.\nwaitForTransaction\n(\n{\ndigest\n:\nresult\n.\ndigest\n,\noptions\n:\n{\nshowEffects\n:\ntrue\n,\nshowEvents\n:\ntrue\n,\n}\n}\n)\n;\nconsole\n.\nlog\n(\n\"\\nSwap completed successfully!\"\n)\n;\nconsole\n.\nlog\n(\n\"Transaction ID:\"\n,\nresult\n.\ndigest\n)\n;\nconsole\n.\nlog\n(\n\"Explorer URL:\"\n,\nhttps\n:\n/\n/\nsuiscan\n.\nxyz\n/\nmainnet\n/\ntx\n/\n$\n{\nresult\n.\ndigest\n}\n)\n;\nprocess\n.\nexit\n(\n0\n)\n;\n}\ncatch\n(\nerror\n)\n{\nconsole\n.\nerror\n(\nAttempt\n$\n{\nretryCount\n+\n1\n}\nfailed\n:\n,\nerror\n)\n;\nretryCount\n++\n;\nif\n(\nretryCount\n===\nMAX_RETRIES\n)\n{\nthrow\nerror\n;\n}\nawait\nnew\nPromise\n(\nresolve\n=>\nsetTimeout\n(\nresolve\n,\n2000\n*\nretryCount\n)\n)\n;\n}\n}\n}\ncatch\n(\nerror\n)\n{\nconsole\n.\nerror\n(\n\"Error:\"\n,\nerror\ninstanceof\nError\n?\nerror\n.\nmessage\n:\n\"Unknown error\"\n)\n;\nprocess\n.\nexit\n(\n1\n)\n;\n}\n}\nif\n(\nrequire\n.\nmain\n===\nmodule\n)\n{\nmain\n(\n)\n;\n}\n方法2：SDK方法\n#\nOKX DEX SDK 提供了更简单的开发人员体验，同时保留了API方法的所有功能。SDK为你处理许多实现细节，包括重试逻辑、错误处理和交易管理。\n1. 安装SDK\n#\nnpm\ninstall\n@okx-dex/okx-dex-sdk\nor\nyarn\nadd\n@okx-dex/okx-dex-sdk\nor\npnpm\nadd\n@okx-dex/okx-dex-sdk\n2. 设置环境\n#\n使用你的API凭据和钱包信息创建一个. env文件：\nOKX API Credentials\nOKX_API_KEY\n=\nyour_api_key\nOKX_SECRET_KEY\n=\nyour_secret_key\nOKX_API_PASSPHRASE\n=\nyour_passphrase\nOKX_PROJECT_ID\n=\nyour_project_id\nSui Configuration\nSUI_WALLET_ADDRESS\n=\nyour_sui_wallet_address\nSUI_PRIVATE_KEY\n=\nyour_sui_private_key\n请记住，你需要使用SUI私钥的hexWithouse tFlag格式，你可以使用SUICLI获得：\nsui keytool convert\n<\nyour_sui_private_key\n>\n3. 初始化客户端\n#\n为你的DEX客户端创建一个文件（例如，DexClient. ts）：\n// DexClient.ts\nimport\n{\nOKXDexClient\n}\nfrom\n'@okx-dex/okx-dex-sdk'\n;\nimport\n'dotenv/config'\n;\n// Validate environment variables\nconst\nrequiredEnvVars\n=\n[\n'OKX_API_KEY'\n,\n'OKX_SECRET_KEY'\n,\n'OKX_API_PASSPHRASE'\n,\n'OKX_PROJECT_ID'\n,\n'SUI_WALLET_ADDRESS'\n,\n'SUI_PRIVATE_KEY'\n]\n;\nfor\n(\nconst\nenvVar\nof\nrequiredEnvVars\n)\n{\nif\n(\n!\nprocess\n.\nenv\n[\nenvVar\n]\n)\n{\nthrow\nnew\nError\n(\nMissing\nrequired environment variable\n:\n$\n{\nenvVar\n}\n)\n;\n}\n}\n// Initialize the client\nexport\nconst\nclient\n=\nnew\nOKXDexClient\n(\n{\napiKey\n:\nprocess\n.\nenv\n.\nOKX_API_KEY\n!\n,\nsecretKey\n:\nprocess\n.\nenv\n.\nOKX_SECRET_KEY\n!\n,\napiPassphrase\n:\nprocess\n.\nenv\n.\nOKX_API_PASSPHRASE\n!\n,\nprojectId\n:\nprocess\n.\nenv\n.\nOKX_PROJECT_ID\n!\n,\nsui\n:\n{\nprivateKey\n:\nprocess\n.\nenv\n.\nSUI_PRIVATE_KEY\n!\n,\nwalletAddress\n:\nprocess\n.\nenv\n.\nSUI_WALLET_ADDRESS\n!\n,\nconnection\n:\n{\nrpcUrl\n:\n'https://sui-mainnet.blockvision.org'\n}\n}\n}\n)\n;\n4. 创建代币助手（可选）\n#\n你可以创建一个代币列表助手以便于参考：\n// Common tokens on Sui mainnet\nexport\nconst\nTOKENS\n=\n{\nSUI\n:\n\"0x2::sui::SUI\"\n,\nUSDC\n:\n\"0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC\"\n}\nas\nconst\n;\n5. 调用SDK执行兑换\n#\n创建兑换执行的文件：\n// swap.ts\nimport\n{\nclient\n}\nfrom\n'./DexClient'\n;\nimport\n{\nTOKENS\n}\nfrom\n'./Tokens'\n;\n// Optional, if you created the token helper\n/**\nExample: Execute a swap from SUI to USDC\n*/\nasync\nfunction\nexecuteSwap\n(\n)\n{\ntry\n{\nif\n(\n!\nprocess\n.\nenv\n.\nSUI_PRIVATE_KEY\n)\n{\nthrow\nnew\nError\n(\n'Missing SUI_PRIVATE_KEY in .env file'\n)\n;\n}\n// First, get token information using a quote\nconsole\n.\nlog\n(\n\"Getting token information...\"\n)\n;\nconst\nfromTokenAddress\n=\nTOKENS\n.\nSUI\n;\n// Or use directly: \"0x2::sui::SUI\"\nconst\ntoTokenAddress\n=\nTOKENS\n.\nUSDC\n;\n// Or use directly: \"0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC\"\nconst\nquote\n=\nawait\nclient\n.\ndex\n.\ngetQuote\n(\n{\nchainId\n:\n'784'\n,\n// Sui chain ID\nfromTokenAddress\n,\ntoTokenAddress\n,\namount\n:\n'1000000'\n,\n// Small amount for quote\nslippage\n:\n'0.5'\n}\n)\n;\nconst\ntokenInfo\n=\n{\nfromToken\n:\n{\nsymbol\n:\nquote\n.\ndata\n[\n0\n]\n.\nfromToken\n.\ntokenSymbol\n,\ndecimals\n:\nparseInt\n(\nquote\n.\ndata\n[\n0\n]\n.\nfromToken\n.\ndecimal\n)\n,\nprice\n:\nquote\n.\ndata\n[\n0\n]\n.\nfromToken\n.\ntokenUnitPrice\n}\n,\ntoToken\n:\n{\nsymbol\n:\nquote\n.\ndata\n[\n0\n]\n.\ntoToken\n.\ntokenSymbol\n,\ndecimals\n:\nparseInt\n(\nquote\n.\ndata\n[\n0\n]\n.\ntoToken\n.\ndecimal\n)\n,\nprice\n:\nquote\n.\ndata\n[\n0\n]\n.\ntoToken\n.\ntokenUnitPrice\n}\n}\n;\n// Convert amount to base units\nconst\nhumanReadableAmount\n=\n1.5\n;\n// 1.5 SUI\nconst\nrawAmount\n=\n(\nhumanReadableAmount\n*\nMath\n.\npow\n(\n10\n,\ntokenInfo\n.\nfromToken\n.\ndecimals\n)\n)\n.\ntoString\n(\n)\n;\nconsole\n.\nlog\n(\n\"\\nSwap Details:\"\n)\n;\nconsole\n.\nlog\n(\n\"--------------------\"\n)\n;\nconsole\n.\nlog\n(\nFrom\n:\n$\n{\ntokenInfo\n.\nfromToken\n.\nsymbol\n}\n)\n;\nconsole\n.\nlog\n(\nTo\n:\n$\n{\ntokenInfo\n.\ntoToken\n.\nsymbol\n}\n)\n;\nconsole\n.\nlog\n(\nAmount\n:\n$\n{\nhumanReadableAmount\n}\n$\n{\ntokenInfo\n.\nfromToken\n.\nsymbol\n}\n)\n;\nconsole\n.\nlog\n(\nAmount\nin\nbase units\n:\n$\n{\nrawAmount\n}\n)\n;\nconsole\n.\nlog\n(\nApproximate\nUSD\nvalue\n:\n$$\n{\n(\nhumanReadableAmount\n*\nparseFloat\n(\ntokenInfo\n.\nfromToken\n.\nprice\n)\n)\n.\ntoFixed\n(\n2\n)\n}\n)\n;\n// Execute the swap\nconsole\n.\nlog\n(\n\"\\nExecuting swap...\"\n)\n;\nconst\nswapResult\n=\nawait\nclient\n.\ndex\n.\nexecuteSwap\n(\n{\nchainId\n:\n'784'\n,\n// Sui chain ID\nfromTokenAddress\n,\ntoTokenAddress\n,\namount\n:\nrawAmount\n,\nslippage\n:\n'0.5'\n,\n// 0.5% slippage\nuserWalletAddress\n:\nprocess\n.\nenv\n.\nSUI_WALLET_ADDRESS\n!\n}\n)\n;\nconsole\n.\nlog\n(\n'Swap executed successfully:'\n)\n;\nconsole\n.\nlog\n(\n\"\\nTransaction ID:\"\n,\nswapResult\n.\ntransactionId\n)\n;\nconsole\n.\nlog\n(\n\"Explorer URL:\"\n,\nswapResult\n.\nexplorerUrl\n)\n;\nif\n(\nswapResult\n.\ndetails\n)\n{\nconsole\n.\nlog\n(\n\"\\nDetails:\"\n)\n;\nconsole\n.\nlog\n(\nInput\n:\n$\n{\nswapResult\n.\ndetails\n.\nfromToken\n.\namount\n}\n$\n{\nswapResult\n.\ndetails\n.\nfromToken\n.\nsymbol\n}\n)\n;\nconsole\n.\nlog\n(\nOutput\n:\n$\n{\nswapResult\n.\ndetails\n.\ntoToken\n.\namount\n}\n$\n{\nswapResult\n.\ndetails\n.\ntoToken\n.\nsymbol\n}\n)\n;\nif\n(\nswapResult\n.\ndetails\n.\npriceImpact\n)\n{\nconsole\n.\nlog\n(\nPrice\nImpact\n:\n$\n{\nswapResult\n.\ndetails\n.\npriceImpact\n}\n%\n)\n;\n}\n}\nreturn\nswapResult\n;\n}\ncatch\n(\nerror\n)\n{\nif\n(\nerror\ninstanceof\nError\n)\n{\nconsole\n.\nerror\n(\n'Error executing swap:'\n,\nerror\n.\nmessage\n)\n;\n// API errors include details in the message\nif\n(\nerror\n.\nmessage\n.\nincludes\n(\n'API Error:'\n)\n)\n{\nconst\nmatch\n=\nerror\n.\nmessage\n.\nmatch\n(\n/\nAPI Error:\n(\n.\n*\n)\n/\n)\n;\nif\n(\nmatch\n)\nconsole\n.\nerror\n(\n'API Error Details:'\n,\nmatch\n[\n1\n]\n)\n;\n}\n}\nthrow\nerror\n;\n}\n}\n// Run if this file is executed directly\nif\n(\nrequire\n.\nmain\n===\nmodule\n)\n{\nexecuteSwap\n(\n)\n.\nthen\n(\n(\n)\n=>\nprocess\n.\nexit\n(\n0\n)\n)\n.\ncatch\n(\n(\nerror\n)\n=>\n{\nconsole\n.\nerror\n(\n'Error:'\n,\nerror\n)\n;\nprocess\n.\nexit\n(\n1\n)\n;\n}\n)\n;\n}\nexport\n{\nexecuteSwap\n}\n;\n## 附加\nSDK\n功能\nSDK\n提供了简化开发的附加方法：\n获取代币对的报价\n`\n`\n`javascript\nconst\nquote\n=\nawait\nclient\n.\ndex\n.\ngetQuote\n(\n{\nchainId\n:\n'784'\n,\n// Sui\nfromTokenAddress\n:\n'0x2::sui::SUI'\n,\n// SUI\ntoTokenAddress\n:\n'0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC'\n,\n// USDC\namount\n:\n'100000000'\n,\n// In base units\nslippage\n:\n'0.5'\n// 0.5%\n}\n)\n;",
  "html": "<div class=\"routes_md__xWlGF\"><!--$--><h1 id=\"在-sui-链上搭建兑换应用\">在 Sui 链上搭建兑换应用<a class=\"index_header-anchor__Xqb+L\" href=\"#在-sui-链上搭建兑换应用\" style=\"opacity:0\">#</a></h1>\n<p>在Sui上使用OKX DEX构建兑换应用程序有两种方法：</p>\n<ul>\n<li>API 方法 - 直接调用 OKX DEX API</li>\n<li>SDK方法 - 使用 <code>@okx-dex/okx-dex-sdk</code>，简化了开发人员的体验</li>\n</ul>\n<p>本指南涵盖了这两种方法，以帮助你选择最适合你需求的方法。</p>\n<h2 data-content=\"方法1：API方法\" id=\"方法1：api方法\">方法1：API方法<a class=\"index_header-anchor__Xqb+L\" href=\"#方法1：api方法\" style=\"opacity:0\">#</a></h2>\n<p>在本指南中，我们将提供通过OKX DEX进行Sui代币兑换的用例。</p>\n<h2 data-content=\"1. 设置环境\" id=\"1.-设置环境\">1. 设置环境<a class=\"index_header-anchor__Xqb+L\" href=\"#1.-设置环境\" style=\"opacity:0\">#</a></h2>\n<p>导入必要的Node. js库并设置环境变量：</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Required libraries</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">SuiWallet</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">\"@okxweb3/coin-sui\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> getFullnodeUrl<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">SuiClient</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'@mysten/sui/client'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">Transaction</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'@mysten/sui/transactions'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">cryptoJS</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">\"crypto-js\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Install dependencies</span>\n<span class=\"token comment\">// npm i @okxweb3/coin-sui</span>\n<span class=\"token comment\">// npm i @mysten/sui</span>\n<span class=\"token comment\">// npm i crypto-js</span>\n<span class=\"token comment\">// Set up environment variables</span>\n<span class=\"token keyword\">const</span> apiKey <span class=\"token operator\">=</span> <span class=\"token string\">'your_api_key'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> secretKey <span class=\"token operator\">=</span> <span class=\"token string\">'your_secret_key'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> apiPassphrase <span class=\"token operator\">=</span> <span class=\"token string\">'your_passphrase'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> projectId <span class=\"token operator\">=</span> <span class=\"token string\">'your_project_id'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> userAddress <span class=\"token operator\">=</span> <span class=\"token string\">'your_sui_wallet_address'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> userPrivateKey <span class=\"token operator\">=</span> <span class=\"token string\">'your_sui_wallet_private_key'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Constants</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">SUI_CHAIN_ID</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"784\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">DEFAULT_GAS_BUDGET</span> <span class=\"token operator\">=</span> <span class=\"token number\">50000000</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">MAX_RETRIES</span> <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Initialize Sui client</span>\n<span class=\"token keyword\">const</span> wallet <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SuiWallet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SuiClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token function\">getFullnodeUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mainnet'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// For Sui, you need to use the hexWithoutFlag format of your private key</span>\n<span class=\"token comment\">// You can convert your key using sui keytool:</span>\n<span class=\"token comment\">// sui keytool convert &lt;your_sui_private_key&gt;</span>\n</code></pre></div>\n<h2 data-content=\"2. 获取代币信息和兑换报价\" id=\"2.-获取代币信息和兑换报价\">2. 获取代币信息和兑换报价<a class=\"index_header-anchor__Xqb+L\" href=\"#2.-获取代币信息和兑换报价\" style=\"opacity:0\">#</a></h2>\n<p>首先，创建一个实用函数来处理API身份验证标头：</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">getHeaders</span><span class=\"token punctuation\">(</span>timestamp<span class=\"token punctuation\">,</span> method<span class=\"token punctuation\">,</span> requestPath<span class=\"token punctuation\">,</span> queryString <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>apiKey <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>secretKey <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>apiPassphrase <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>projectId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Missing required environment variables\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> stringToSign <span class=\"token operator\">=</span> timestamp <span class=\"token operator\">+</span> method <span class=\"token operator\">+</span> requestPath <span class=\"token operator\">+</span> queryString<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">\"Content-Type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"OK-ACCESS-KEY\"</span><span class=\"token operator\">:</span> apiKey<span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"OK-ACCESS-SIGN\"</span><span class=\"token operator\">:</span> cryptoJS<span class=\"token punctuation\">.</span><span class=\"token property-access\">enc</span><span class=\"token punctuation\">.</span><span class=\"token property-access\"><span class=\"token maybe-class-name\">Base64</span></span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>\n            cryptoJS<span class=\"token punctuation\">.</span><span class=\"token method function property-access\"><span class=\"token maybe-class-name\">HmacSHA256</span></span><span class=\"token punctuation\">(</span>stringToSign<span class=\"token punctuation\">,</span> secretKey<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"OK-ACCESS-TIMESTAMP\"</span><span class=\"token operator\">:</span> timestamp<span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"OK-ACCESS-PASSPHRASE\"</span><span class=\"token operator\">:</span> apiPassphrase<span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"OK-ACCESS-PROJECT\"</span><span class=\"token operator\">:</span> projectId<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n然后，创建一个函数来获取令牌信息：\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getTokenInfo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fromTokenAddress<span class=\"token punctuation\">,</span> toTokenAddress</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> timestamp <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> requestPath <span class=\"token operator\">=</span> <span class=\"token string\">\"/api/v5/dex/aggregator/quote\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> params <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">chainId</span><span class=\"token operator\">:</span> <span class=\"token constant\">SUI_CHAIN_ID</span><span class=\"token punctuation\">,</span>\n        fromTokenAddress<span class=\"token punctuation\">,</span>\n        toTokenAddress<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">amount</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1000000\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">slippage</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.5\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> queryString <span class=\"token operator\">=</span> <span class=\"token string\">\"?\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> headers <span class=\"token operator\">=</span> <span class=\"token function\">getHeaders</span><span class=\"token punctuation\">(</span>timestamp<span class=\"token punctuation\">,</span> <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> requestPath<span class=\"token punctuation\">,</span> queryString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>\n        \n<span class=\"token literal-property property\">https</span><span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>web3<span class=\"token punctuation\">.</span><span class=\"token property-access\">okx</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">com$</span><span class=\"token punctuation\">{</span>requestPath<span class=\"token punctuation\">}</span>$<span class=\"token punctuation\">{</span>queryString<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> headers <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>response<span class=\"token punctuation\">.</span><span class=\"token property-access\">ok</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>\n<span class=\"token maybe-class-name\">Failed</span> to <span class=\"token keyword\">get</span> <span class=\"token literal-property property\">quote</span><span class=\"token operator\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token keyword control-flow\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span><span class=\"token property-access\">code</span> <span class=\"token operator\">!==</span> <span class=\"token string\">\"0\"</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>data<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token operator\">?.</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Failed to get token information\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> quoteData <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">fromToken</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">symbol</span><span class=\"token operator\">:</span> quoteData<span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tokenSymbol</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">decimals</span><span class=\"token operator\">:</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>quoteData<span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">decimal</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">price</span><span class=\"token operator\">:</span> quoteData<span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tokenUnitPrice</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">toToken</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">symbol</span><span class=\"token operator\">:</span> quoteData<span class=\"token punctuation\">.</span><span class=\"token property-access\">toToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tokenSymbol</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">decimals</span><span class=\"token operator\">:</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>quoteData<span class=\"token punctuation\">.</span><span class=\"token property-access\">toToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">decimal</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">price</span><span class=\"token operator\">:</span> quoteData<span class=\"token punctuation\">.</span><span class=\"token property-access\">toToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tokenUnitPrice</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n创建一个函数将人类可读的数量转换为基本单位：\n<span class=\"token keyword\">function</span> <span class=\"token function\">convertAmount</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">amount<span class=\"token punctuation\">,</span> decimals</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>amount <span class=\"token operator\">||</span> <span class=\"token function\">isNaN</span><span class=\"token punctuation\">(</span><span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span>amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Invalid amount\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">const</span> value <span class=\"token operator\">=</span> <span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span>amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>value <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Amount must be greater than 0\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">BigInt</span><span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">floor</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">*</span> <span class=\"token known-class-name class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pow</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> decimals<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Amount conversion error:\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Invalid amount format\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2 data-content=\"3. 处理和签署交易\" id=\"3.-处理和签署交易\">3. 处理和签署交易<a class=\"index_header-anchor__Xqb+L\" href=\"#3.-处理和签署交易\" style=\"opacity:0\">#</a></h2>\n<p>从/swap获得数据后，你需要处理并签署事务：</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">executeSwap</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">txData<span class=\"token punctuation\">,</span> privateKey</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Create transaction block</span>\n    <span class=\"token keyword\">const</span> txBlock <span class=\"token operator\">=</span> <span class=\"token maybe-class-name\">Transaction</span><span class=\"token punctuation\">.</span><span class=\"token keyword module\">from</span><span class=\"token punctuation\">(</span>txData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    txBlock<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setSender</span><span class=\"token punctuation\">(</span>normalizedWalletAddress<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Set gas parameters</span>\n    <span class=\"token keyword\">const</span> referenceGasPrice <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getReferenceGasPrice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    txBlock<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setGasPrice</span><span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">BigInt</span><span class=\"token punctuation\">(</span>referenceGasPrice<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    txBlock<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setGasBudget</span><span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">BigInt</span><span class=\"token punctuation\">(</span><span class=\"token constant\">DEFAULT_GAS_BUDGET</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Build and sign transaction</span>\n    <span class=\"token keyword\">const</span> builtTx <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> txBlock<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> client <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> txBytes <span class=\"token operator\">=</span> <span class=\"token maybe-class-name\">Buffer</span><span class=\"token punctuation\">.</span><span class=\"token keyword module\">from</span><span class=\"token punctuation\">(</span>builtTx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> signedTx <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> wallet<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">signTransaction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        privateKey<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'raw'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> txBytes\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>signedTx<span class=\"token operator\">?.</span>signature<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Failed to sign transaction\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span> builtTx<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">signature</span><span class=\"token operator\">:</span> signedTx<span class=\"token punctuation\">.</span><span class=\"token property-access\">signature</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2 data-content=\"4. 执行交易\" id=\"4.-执行交易\">4. 执行交易<a class=\"index_header-anchor__Xqb+L\" href=\"#4.-执行交易\" style=\"opacity:0\">#</a></h2>\n<p>最后，执行签名交易：</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">sendTransaction</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">builtTx<span class=\"token punctuation\">,</span> signature</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Execute transaction</span>\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">executeTransactionBlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">transactionBlock</span><span class=\"token operator\">:</span> builtTx<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">signature</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>signature<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">showEffects</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">showEvents</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Wait for confirmation</span>\n    <span class=\"token keyword\">const</span> confirmation <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">waitForTransaction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">digest</span><span class=\"token operator\">:</span> result<span class=\"token punctuation\">.</span><span class=\"token property-access\">digest</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">showEffects</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">showEvents</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\nSwap completed successfully!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Transaction ID:\"</span><span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">.</span><span class=\"token property-access\">digest</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Explorer URL:\"</span><span class=\"token punctuation\">,</span> \n<span class=\"token literal-property property\">https</span><span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>suiscan<span class=\"token punctuation\">.</span><span class=\"token property-access\">xyz</span><span class=\"token operator\">/</span>mainnet<span class=\"token operator\">/</span>tx<span class=\"token operator\">/</span>$<span class=\"token punctuation\">{</span>result<span class=\"token punctuation\">.</span><span class=\"token property-access\">digest</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> result<span class=\"token punctuation\">.</span><span class=\"token property-access\">digest</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2 data-content=\"5. 完整实现\" id=\"5.-完整实现\">5. 完整实现<a class=\"index_header-anchor__Xqb+L\" href=\"#5.-完整实现\" style=\"opacity:0\">#</a></h2>\n<p>这是一个完整的实现，将所有内容整合在一起：</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// swap.ts</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">SuiWallet</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">\"@okxweb3/coin-sui\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> getFullnodeUrl<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">SuiClient</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'@mysten/sui/client'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">Transaction</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'@mysten/sui/transactions'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">cryptoJS</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">\"crypto-js\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">dotenv</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'dotenv'</span><span class=\"token punctuation\">;</span>\ndotenv<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Environment variables</span>\n<span class=\"token keyword\">const</span> apiKey <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OKX_API_KEY</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> secretKey <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OKX_SECRET_KEY</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> apiPassphrase <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OKX_API_PASSPHRASE</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> projectId <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OKX_PROJECT_ID</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> userAddress <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">WALLET_ADDRESS</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> userPrivateKey <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PRIVATE_KEY</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Constants</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">SUI_CHAIN_ID</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"784\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">DEFAULT_GAS_BUDGET</span> <span class=\"token operator\">=</span> <span class=\"token number\">50000000</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">MAX_RETRIES</span> <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Initialize clients</span>\n<span class=\"token keyword\">const</span> wallet <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SuiWallet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SuiClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token function\">getFullnodeUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mainnet'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Normalize wallet address</span>\n<span class=\"token keyword\">const</span> normalizedWalletAddress <span class=\"token operator\">=</span> userAddress<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">getHeaders</span><span class=\"token punctuation\">(</span>timestamp<span class=\"token punctuation\">,</span> method<span class=\"token punctuation\">,</span> requestPath<span class=\"token punctuation\">,</span> queryString <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>apiKey <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>secretKey <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>apiPassphrase <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>projectId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Missing required environment variables\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> stringToSign <span class=\"token operator\">=</span> timestamp <span class=\"token operator\">+</span> method <span class=\"token operator\">+</span> requestPath <span class=\"token operator\">+</span> queryString<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">\"Content-Type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"OK-ACCESS-KEY\"</span><span class=\"token operator\">:</span> apiKey<span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"OK-ACCESS-SIGN\"</span><span class=\"token operator\">:</span> cryptoJS<span class=\"token punctuation\">.</span><span class=\"token property-access\">enc</span><span class=\"token punctuation\">.</span><span class=\"token property-access\"><span class=\"token maybe-class-name\">Base64</span></span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>\n            cryptoJS<span class=\"token punctuation\">.</span><span class=\"token method function property-access\"><span class=\"token maybe-class-name\">HmacSHA256</span></span><span class=\"token punctuation\">(</span>stringToSign<span class=\"token punctuation\">,</span> secretKey<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"OK-ACCESS-TIMESTAMP\"</span><span class=\"token operator\">:</span> timestamp<span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"OK-ACCESS-PASSPHRASE\"</span><span class=\"token operator\">:</span> apiPassphrase<span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"OK-ACCESS-PROJECT\"</span><span class=\"token operator\">:</span> projectId<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getTokenInfo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fromTokenAddress<span class=\"token punctuation\">,</span> toTokenAddress</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> timestamp <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> requestPath <span class=\"token operator\">=</span> <span class=\"token string\">\"/api/v5/dex/aggregator/quote\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> params <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">chainId</span><span class=\"token operator\">:</span> <span class=\"token constant\">SUI_CHAIN_ID</span><span class=\"token punctuation\">,</span>\n        fromTokenAddress<span class=\"token punctuation\">,</span>\n        toTokenAddress<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">amount</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1000000\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">slippage</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.5\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> queryString <span class=\"token operator\">=</span> <span class=\"token string\">\"?\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> headers <span class=\"token operator\">=</span> <span class=\"token function\">getHeaders</span><span class=\"token punctuation\">(</span>timestamp<span class=\"token punctuation\">,</span> <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> requestPath<span class=\"token punctuation\">,</span> queryString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>\n        \n<span class=\"token literal-property property\">https</span><span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>web3<span class=\"token punctuation\">.</span><span class=\"token property-access\">okx</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">com$</span><span class=\"token punctuation\">{</span>requestPath<span class=\"token punctuation\">}</span>$<span class=\"token punctuation\">{</span>queryString<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> headers <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>response<span class=\"token punctuation\">.</span><span class=\"token property-access\">ok</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>\n<span class=\"token maybe-class-name\">Failed</span> to <span class=\"token keyword\">get</span> <span class=\"token literal-property property\">quote</span><span class=\"token operator\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token keyword control-flow\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span><span class=\"token property-access\">code</span> <span class=\"token operator\">!==</span> <span class=\"token string\">\"0\"</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>data<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token operator\">?.</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Failed to get token information\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> quoteData <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">fromToken</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">symbol</span><span class=\"token operator\">:</span> quoteData<span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tokenSymbol</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">decimals</span><span class=\"token operator\">:</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>quoteData<span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">decimal</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">price</span><span class=\"token operator\">:</span> quoteData<span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tokenUnitPrice</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">toToken</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">symbol</span><span class=\"token operator\">:</span> quoteData<span class=\"token punctuation\">.</span><span class=\"token property-access\">toToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tokenSymbol</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">decimals</span><span class=\"token operator\">:</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>quoteData<span class=\"token punctuation\">.</span><span class=\"token property-access\">toToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">decimal</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">price</span><span class=\"token operator\">:</span> quoteData<span class=\"token punctuation\">.</span><span class=\"token property-access\">toToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tokenUnitPrice</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">convertAmount</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">amount<span class=\"token punctuation\">,</span> decimals</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>amount <span class=\"token operator\">||</span> <span class=\"token function\">isNaN</span><span class=\"token punctuation\">(</span><span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span>amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Invalid amount\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">const</span> value <span class=\"token operator\">=</span> <span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span>amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>value <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Amount must be greater than 0\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">BigInt</span><span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">floor</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">*</span> <span class=\"token known-class-name class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pow</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> decimals<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Amount conversion error:\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Invalid amount format\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> args <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span><span class=\"token property-access\">argv</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Usage: ts-node swap.ts &lt;amount&gt; &lt;fromTokenAddress&gt; &lt;toTokenAddress&gt;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Example: ts-node swap.ts 1.5 0x2::sui::SUI 0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            process<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>amount<span class=\"token punctuation\">,</span> fromTokenAddress<span class=\"token punctuation\">,</span> toTokenAddress<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> args<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>userPrivateKey <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>userAddress<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Private key or user address not found\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// Get token information</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Getting token information...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> tokenInfo <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">getTokenInfo</span><span class=\"token punctuation\">(</span>fromTokenAddress<span class=\"token punctuation\">,</span> toTokenAddress<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>\n<span class=\"token literal-property property\">From</span><span class=\"token operator\">:</span> $<span class=\"token punctuation\">{</span>tokenInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">symbol</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">(</span>$<span class=\"token punctuation\">{</span>tokenInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">decimals</span><span class=\"token punctuation\">}</span> decimals<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>\n<span class=\"token literal-property property\">To</span><span class=\"token operator\">:</span> $<span class=\"token punctuation\">{</span>tokenInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">toToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">symbol</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">(</span>$<span class=\"token punctuation\">{</span>tokenInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">toToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">decimals</span><span class=\"token punctuation\">}</span> decimals<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// Convert amount using fetched decimals</span>\n        <span class=\"token keyword\">const</span> rawAmount <span class=\"token operator\">=</span> <span class=\"token function\">convertAmount</span><span class=\"token punctuation\">(</span>amount<span class=\"token punctuation\">,</span> tokenInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">decimals</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>\n<span class=\"token maybe-class-name\">Amount</span> <span class=\"token keyword\">in</span> $<span class=\"token punctuation\">{</span>tokenInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">symbol</span><span class=\"token punctuation\">}</span> base units<span class=\"token operator\">:</span>\n<span class=\"token punctuation\">,</span> rawAmount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// Get swap quote</span>\n        <span class=\"token keyword\">const</span> quoteParams <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">chainId</span><span class=\"token operator\">:</span> <span class=\"token constant\">SUI_CHAIN_ID</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">amount</span><span class=\"token operator\">:</span> rawAmount<span class=\"token punctuation\">,</span>\n            fromTokenAddress<span class=\"token punctuation\">,</span>\n            toTokenAddress<span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">slippage</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.5\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">userWalletAddress</span><span class=\"token operator\">:</span> normalizedWalletAddress<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// Get swap data</span>\n        <span class=\"token keyword\">const</span> timestamp <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> requestPath <span class=\"token operator\">=</span> <span class=\"token string\">\"/api/v5/dex/aggregator/swap\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> queryString <span class=\"token operator\">=</span> <span class=\"token string\">\"?\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span>quoteParams<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> headers <span class=\"token operator\">=</span> <span class=\"token function\">getHeaders</span><span class=\"token punctuation\">(</span>timestamp<span class=\"token punctuation\">,</span> <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> requestPath<span class=\"token punctuation\">,</span> queryString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Requesting swap quote...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>\n            \n<span class=\"token literal-property property\">https</span><span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>web3<span class=\"token punctuation\">.</span><span class=\"token property-access\">okx</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">com$</span><span class=\"token punctuation\">{</span>requestPath<span class=\"token punctuation\">}</span>$<span class=\"token punctuation\">{</span>queryString<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> headers <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span><span class=\"token property-access\">code</span> <span class=\"token operator\">!==</span> <span class=\"token string\">\"0\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>\n<span class=\"token constant\">API</span> <span class=\"token known-class-name class-name\">Error</span><span class=\"token operator\">:</span> $<span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span><span class=\"token property-access\">msg</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">const</span> swapData <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// Show estimated output and price impact</span>\n        <span class=\"token keyword\">const</span> outputAmount <span class=\"token operator\">=</span> <span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span>swapData<span class=\"token punctuation\">.</span><span class=\"token property-access\">routerResult</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">toTokenAmount</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token known-class-name class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pow</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> tokenInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">toToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">decimals</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\nSwap Quote:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>\n<span class=\"token literal-property property\">Input</span><span class=\"token operator\">:</span> $<span class=\"token punctuation\">{</span>amount<span class=\"token punctuation\">}</span> $<span class=\"token punctuation\">{</span>tokenInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">symbol</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">(</span>$$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span>amount<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span>tokenInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">price</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>\n<span class=\"token literal-property property\">Output</span><span class=\"token operator\">:</span> $<span class=\"token punctuation\">{</span>outputAmount<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toFixed</span><span class=\"token punctuation\">(</span>tokenInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">toToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">decimals</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span> $<span class=\"token punctuation\">{</span>tokenInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">toToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">symbol</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">(</span>$$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span>outputAmount <span class=\"token operator\">*</span> <span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span>tokenInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">toToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">price</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>swapData<span class=\"token punctuation\">.</span><span class=\"token property-access\">priceImpactPercentage</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>\n<span class=\"token maybe-class-name\">Price</span> <span class=\"token maybe-class-name\">Impact</span><span class=\"token operator\">:</span> $<span class=\"token punctuation\">{</span>swapData<span class=\"token punctuation\">.</span><span class=\"token property-access\">priceImpactPercentage</span><span class=\"token punctuation\">}</span><span class=\"token operator\">%</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\nExecuting swap transaction...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> retryCount <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">while</span> <span class=\"token punctuation\">(</span>retryCount <span class=\"token operator\">&lt;</span> <span class=\"token constant\">MAX_RETRIES</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// Create transaction block</span>\n                <span class=\"token keyword\">const</span> txBlock <span class=\"token operator\">=</span> <span class=\"token maybe-class-name\">Transaction</span><span class=\"token punctuation\">.</span><span class=\"token keyword module\">from</span><span class=\"token punctuation\">(</span>swapData<span class=\"token punctuation\">.</span><span class=\"token property-access\">tx</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                txBlock<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setSender</span><span class=\"token punctuation\">(</span>normalizedWalletAddress<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">// Set gas parameters</span>\n                <span class=\"token keyword\">const</span> referenceGasPrice <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getReferenceGasPrice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                txBlock<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setGasPrice</span><span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">BigInt</span><span class=\"token punctuation\">(</span>referenceGasPrice<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                txBlock<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setGasBudget</span><span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">BigInt</span><span class=\"token punctuation\">(</span><span class=\"token constant\">DEFAULT_GAS_BUDGET</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">// Build and sign transaction</span>\n                <span class=\"token keyword\">const</span> builtTx <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> txBlock<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> client <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">const</span> txBytes <span class=\"token operator\">=</span> <span class=\"token maybe-class-name\">Buffer</span><span class=\"token punctuation\">.</span><span class=\"token keyword module\">from</span><span class=\"token punctuation\">(</span>builtTx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">const</span> signedTx <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> wallet<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">signTransaction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                    <span class=\"token literal-property property\">privateKey</span><span class=\"token operator\">:</span> userPrivateKey<span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'raw'</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> txBytes\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>signedTx<span class=\"token operator\">?.</span>signature<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Failed to sign transaction\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token comment\">// Execute transaction</span>\n                <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">executeTransactionBlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                    <span class=\"token literal-property property\">transactionBlock</span><span class=\"token operator\">:</span> builtTx<span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">signature</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>signedTx<span class=\"token punctuation\">.</span><span class=\"token property-access\">signature</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token literal-property property\">showEffects</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token literal-property property\">showEvents</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">// Wait for confirmation</span>\n                <span class=\"token keyword\">const</span> confirmation <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">waitForTransaction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                    <span class=\"token literal-property property\">digest</span><span class=\"token operator\">:</span> result<span class=\"token punctuation\">.</span><span class=\"token property-access\">digest</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token literal-property property\">showEffects</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token literal-property property\">showEvents</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\nSwap completed successfully!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Transaction ID:\"</span><span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">.</span><span class=\"token property-access\">digest</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Explorer URL:\"</span><span class=\"token punctuation\">,</span> \n<span class=\"token literal-property property\">https</span><span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>suiscan<span class=\"token punctuation\">.</span><span class=\"token property-access\">xyz</span><span class=\"token operator\">/</span>mainnet<span class=\"token operator\">/</span>tx<span class=\"token operator\">/</span>$<span class=\"token punctuation\">{</span>result<span class=\"token punctuation\">.</span><span class=\"token property-access\">digest</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                process<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>\n<span class=\"token maybe-class-name\">Attempt</span> $<span class=\"token punctuation\">{</span>retryCount <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span> failed<span class=\"token operator\">:</span>\n<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                retryCount<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>retryCount <span class=\"token operator\">===</span> <span class=\"token constant\">MAX_RETRIES</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword control-flow\">throw</span> error<span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword control-flow\">await</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> <span class=\"token number\">2000</span> <span class=\"token operator\">*</span> retryCount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error:\"</span><span class=\"token punctuation\">,</span> error <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Error</span> <span class=\"token operator\">?</span> error<span class=\"token punctuation\">.</span><span class=\"token property-access\">message</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"Unknown error\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        process<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>require<span class=\"token punctuation\">.</span><span class=\"token property-access\">main</span> <span class=\"token operator\">===</span> module<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2 data-content=\"方法2：SDK方法\" id=\"方法2：sdk方法\">方法2：SDK方法<a class=\"index_header-anchor__Xqb+L\" href=\"#方法2：sdk方法\" style=\"opacity:0\">#</a></h2>\n<p>OKX DEX SDK 提供了更简单的开发人员体验，同时保留了API方法的所有功能。SDK为你处理许多实现细节，包括重试逻辑、错误处理和交易管理。</p>\n<h2 data-content=\"1. 安装SDK\" id=\"1.-安装sdk\">1. 安装SDK<a class=\"index_header-anchor__Xqb+L\" href=\"#1.-安装sdk\" style=\"opacity:0\">#</a></h2>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> @okx-dex/okx-dex-sdk\nor\n<span class=\"token function\">yarn</span> <span class=\"token function\">add</span> @okx-dex/okx-dex-sdk\nor\n<span class=\"token function\">pnpm</span> <span class=\"token function\">add</span> @okx-dex/okx-dex-sdk\n</code></pre></div>\n<h2 data-content=\"2. 设置环境\" id=\"2.-设置环境\">2. 设置环境<a class=\"index_header-anchor__Xqb+L\" href=\"#2.-设置环境\" style=\"opacity:0\">#</a></h2>\n<p>使用你的API凭据和钱包信息创建一个. env文件：</p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\">OKX API Credentials\n<span class=\"token assign-left variable\">OKX_API_KEY</span><span class=\"token operator\">=</span>your_api_key\n<span class=\"token assign-left variable\">OKX_SECRET_KEY</span><span class=\"token operator\">=</span>your_secret_key\n<span class=\"token assign-left variable\">OKX_API_PASSPHRASE</span><span class=\"token operator\">=</span>your_passphrase\n<span class=\"token assign-left variable\">OKX_PROJECT_ID</span><span class=\"token operator\">=</span>your_project_id\nSui Configuration\n<span class=\"token assign-left variable\">SUI_WALLET_ADDRESS</span><span class=\"token operator\">=</span>your_sui_wallet_address\n<span class=\"token assign-left variable\">SUI_PRIVATE_KEY</span><span class=\"token operator\">=</span>your_sui_private_key\n请记住，你需要使用SUI私钥的hexWithouse tFlag格式，你可以使用SUICLI获得：\nsui keytool convert <span class=\"token operator\">&lt;</span>your_sui_private_key<span class=\"token operator\">&gt;</span>\n</code></pre></div>\n<h2 data-content=\"3. 初始化客户端\" id=\"3.-初始化客户端\">3. 初始化客户端<a class=\"index_header-anchor__Xqb+L\" href=\"#3.-初始化客户端\" style=\"opacity:0\">#</a></h2>\n<p>为你的DEX客户端创建一个文件（例如，DexClient. ts）：</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// DexClient.ts</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">OKXDexClient</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'@okx-dex/okx-dex-sdk'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword module\">import</span> <span class=\"token string\">'dotenv/config'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Validate environment variables</span>\n<span class=\"token keyword\">const</span> requiredEnvVars <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'OKX_API_KEY'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'OKX_SECRET_KEY'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'OKX_API_PASSPHRASE'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'OKX_PROJECT_ID'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'SUI_WALLET_ADDRESS'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'SUI_PRIVATE_KEY'</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> envVar <span class=\"token keyword\">of</span> requiredEnvVars<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">[</span>envVar<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>\n<span class=\"token maybe-class-name\">Missing</span> required environment variable<span class=\"token operator\">:</span> $<span class=\"token punctuation\">{</span>envVar<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// Initialize the client</span>\n<span class=\"token keyword module\">export</span> <span class=\"token keyword\">const</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OKXDexClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">apiKey</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OKX_API_KEY</span><span class=\"token operator\">!</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">secretKey</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OKX_SECRET_KEY</span><span class=\"token operator\">!</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">apiPassphrase</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OKX_API_PASSPHRASE</span><span class=\"token operator\">!</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">projectId</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OKX_PROJECT_ID</span><span class=\"token operator\">!</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">sui</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">privateKey</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SUI_PRIVATE_KEY</span><span class=\"token operator\">!</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">walletAddress</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SUI_WALLET_ADDRESS</span><span class=\"token operator\">!</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">connection</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">rpcUrl</span><span class=\"token operator\">:</span> <span class=\"token string\">'https://sui-mainnet.blockvision.org'</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h2 data-content=\"4. 创建代币助手（可选）\" id=\"4.-创建代币助手（可选）\">4. 创建代币助手（可选）<a class=\"index_header-anchor__Xqb+L\" href=\"#4.-创建代币助手（可选）\" style=\"opacity:0\">#</a></h2>\n<p>你可以创建一个代币列表助手以便于参考：</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Common tokens on Sui mainnet</span>\n<span class=\"token keyword module\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">TOKENS</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token constant\">SUI</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0x2::sui::SUI\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token constant\">USDC</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC\"</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword module\">as</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n\n</code></pre></div>\n<h2 data-content=\"5. 调用SDK执行兑换\" id=\"5.-调用sdk执行兑换\">5. 调用SDK执行兑换<a class=\"index_header-anchor__Xqb+L\" href=\"#5.-调用sdk执行兑换\" style=\"opacity:0\">#</a></h2>\n<p>创建兑换执行的文件：</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// swap.ts</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> client <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'./DexClient'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword module\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">TOKENS</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'./Tokens'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Optional, if you created the token helper</span>\n<span class=\"token doc-comment comment\">/**</span>\n<span class=\"token doc-comment comment\">Example: Execute a swap from SUI to USDC</span>\n<span class=\"token doc-comment comment\">*/</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">executeSwap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SUI_PRIVATE_KEY</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Missing SUI_PRIVATE_KEY in .env file'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// First, get token information using a quote</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Getting token information...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> fromTokenAddress <span class=\"token operator\">=</span> <span class=\"token constant\">TOKENS</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SUI</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Or use directly: \"0x2::sui::SUI\"</span>\n    <span class=\"token keyword\">const</span> toTokenAddress <span class=\"token operator\">=</span> <span class=\"token constant\">TOKENS</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USDC</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Or use directly: \"0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC\"</span>\n\n    <span class=\"token keyword\">const</span> quote <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token property-access\">dex</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getQuote</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">chainId</span><span class=\"token operator\">:</span> <span class=\"token string\">'784'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Sui chain ID</span>\n        fromTokenAddress<span class=\"token punctuation\">,</span>\n        toTokenAddress<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">amount</span><span class=\"token operator\">:</span> <span class=\"token string\">'1000000'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Small amount for quote</span>\n        <span class=\"token literal-property property\">slippage</span><span class=\"token operator\">:</span> <span class=\"token string\">'0.5'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> tokenInfo <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">fromToken</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">symbol</span><span class=\"token operator\">:</span> quote<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tokenSymbol</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">decimals</span><span class=\"token operator\">:</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>quote<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">decimal</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">price</span><span class=\"token operator\">:</span> quote<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tokenUnitPrice</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">toToken</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">symbol</span><span class=\"token operator\">:</span> quote<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">toToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tokenSymbol</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">decimals</span><span class=\"token operator\">:</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>quote<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">toToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">decimal</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">price</span><span class=\"token operator\">:</span> quote<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">toToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tokenUnitPrice</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Convert amount to base units</span>\n    <span class=\"token keyword\">const</span> humanReadableAmount <span class=\"token operator\">=</span> <span class=\"token number\">1.5</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1.5 SUI</span>\n    <span class=\"token keyword\">const</span> rawAmount <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>humanReadableAmount <span class=\"token operator\">*</span> <span class=\"token known-class-name class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pow</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> tokenInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">decimals</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\nSwap Details:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"--------------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>\n<span class=\"token literal-property property\">From</span><span class=\"token operator\">:</span> $<span class=\"token punctuation\">{</span>tokenInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">symbol</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>\n<span class=\"token literal-property property\">To</span><span class=\"token operator\">:</span> $<span class=\"token punctuation\">{</span>tokenInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">toToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">symbol</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>\n<span class=\"token literal-property property\">Amount</span><span class=\"token operator\">:</span> $<span class=\"token punctuation\">{</span>humanReadableAmount<span class=\"token punctuation\">}</span> $<span class=\"token punctuation\">{</span>tokenInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">symbol</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>\n<span class=\"token maybe-class-name\">Amount</span> <span class=\"token keyword\">in</span> base units<span class=\"token operator\">:</span> $<span class=\"token punctuation\">{</span>rawAmount<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>\n<span class=\"token maybe-class-name\">Approximate</span> <span class=\"token constant\">USD</span> <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> $$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span>humanReadableAmount <span class=\"token operator\">*</span> <span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span>tokenInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">price</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Execute the swap</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\nExecuting swap...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> swapResult <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token property-access\">dex</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">executeSwap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">chainId</span><span class=\"token operator\">:</span> <span class=\"token string\">'784'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Sui chain ID</span>\n      fromTokenAddress<span class=\"token punctuation\">,</span>\n      toTokenAddress<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">amount</span><span class=\"token operator\">:</span> rawAmount<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">slippage</span><span class=\"token operator\">:</span> <span class=\"token string\">'0.5'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 0.5% slippage</span>\n      <span class=\"token literal-property property\">userWalletAddress</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SUI_WALLET_ADDRESS</span><span class=\"token operator\">!</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Swap executed successfully:'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\nTransaction ID:\"</span><span class=\"token punctuation\">,</span> swapResult<span class=\"token punctuation\">.</span><span class=\"token property-access\">transactionId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Explorer URL:\"</span><span class=\"token punctuation\">,</span> swapResult<span class=\"token punctuation\">.</span><span class=\"token property-access\">explorerUrl</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>swapResult<span class=\"token punctuation\">.</span><span class=\"token property-access\">details</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\nDetails:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>\n<span class=\"token literal-property property\">Input</span><span class=\"token operator\">:</span> $<span class=\"token punctuation\">{</span>swapResult<span class=\"token punctuation\">.</span><span class=\"token property-access\">details</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">amount</span><span class=\"token punctuation\">}</span> $<span class=\"token punctuation\">{</span>swapResult<span class=\"token punctuation\">.</span><span class=\"token property-access\">details</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">fromToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">symbol</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>\n<span class=\"token literal-property property\">Output</span><span class=\"token operator\">:</span> $<span class=\"token punctuation\">{</span>swapResult<span class=\"token punctuation\">.</span><span class=\"token property-access\">details</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">toToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">amount</span><span class=\"token punctuation\">}</span> $<span class=\"token punctuation\">{</span>swapResult<span class=\"token punctuation\">.</span><span class=\"token property-access\">details</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">toToken</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">symbol</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>swapResult<span class=\"token punctuation\">.</span><span class=\"token property-access\">details</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">priceImpact</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>\n<span class=\"token maybe-class-name\">Price</span> <span class=\"token maybe-class-name\">Impact</span><span class=\"token operator\">:</span> $<span class=\"token punctuation\">{</span>swapResult<span class=\"token punctuation\">.</span><span class=\"token property-access\">details</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">priceImpact</span><span class=\"token punctuation\">}</span><span class=\"token operator\">%</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword control-flow\">return</span> swapResult<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>error <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Error executing swap:'</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">.</span><span class=\"token property-access\">message</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// API errors include details in the message</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">.</span><span class=\"token property-access\">message</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'API Error:'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> match <span class=\"token operator\">=</span> error<span class=\"token punctuation\">.</span><span class=\"token property-access\">message</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">API Error: <span class=\"token group punctuation\">(</span><span class=\"token char-set class-name\">.</span><span class=\"token quantifier number\">*</span><span class=\"token group punctuation\">)</span></span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>match<span class=\"token punctuation\">)</span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'API Error Details:'</span><span class=\"token punctuation\">,</span> match<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">throw</span> error<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// Run if this file is executed directly</span>\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>require<span class=\"token punctuation\">.</span><span class=\"token property-access\">main</span> <span class=\"token operator\">===</span> module<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">executeSwap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> process<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token keyword control-flow\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Error:'</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      process<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword module\">export</span> <span class=\"token exports\"><span class=\"token punctuation\">{</span> executeSwap <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">;</span>\n\n## 附加<span class=\"token constant\">SDK</span>功能\n<span class=\"token constant\">SDK</span>提供了简化开发的附加方法：\n获取代币对的报价\n\n<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token template-punctuation string\">`</span></span>`javascript\n<span class=\"token keyword\">const</span> quote <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token property-access\">dex</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getQuote</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">chainId</span><span class=\"token operator\">:</span> <span class=\"token string\">'784'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// Sui</span>\n    <span class=\"token literal-property property\">fromTokenAddress</span><span class=\"token operator\">:</span> <span class=\"token string\">'0x2::sui::SUI'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// SUI</span>\n    <span class=\"token literal-property property\">toTokenAddress</span><span class=\"token operator\">:</span> <span class=\"token string\">'0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// USDC</span>\n    <span class=\"token literal-property property\">amount</span><span class=\"token operator\">:</span> <span class=\"token string\">'100000000'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// In base units</span>\n    <span class=\"token literal-property property\">slippage</span><span class=\"token operator\">:</span> <span class=\"token string\">'0.5'</span>     <span class=\"token comment\">// 0.5%</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div><!--/$--></div>",
  "url": "https://web3.okx.com/zh-hans/build/dev-docs/dex-api/dex-use-swap-sui-quick-start#方法1：api方法",
  "navigation": {
    "breadcrumbs": [
      "DEX API",
      "交易 API",
      "搭建兑换应用",
      "在 Sui 链上搭建兑换应用"
    ],
    "sidebar_links": [
      "搭建兑换应用",
      "在 Solana 链上搭建兑换应用",
      "在 Solana 链上兑换的高级用法",
      "在 EVM 链上搭建兑换应用",
      "在 Sui 链上搭建兑换应用",
      "在 Ton 链上搭建兑换应用",
      "搭建跨链应用",
      "介绍",
      "API 参考",
      "设置分佣",
      "DEX 集成",
      "智能合约",
      "错误码",
      "FAQ",
      "介绍",
      "API 参考",
      "支持的跨链桥",
      "智能合约",
      "错误码",
      "FAQ"
    ],
    "toc": [
      "方法1：API方法",
      "1. 设置环境",
      "2. 获取代币信息和兑换报价",
      "3. 处理和签署交易",
      "4. 执行交易",
      "5. 完整实现",
      "方法2：SDK方法",
      "1. 安装SDK",
      "2. 设置环境",
      "3. 初始化客户端",
      "4. 创建代币助手（可选）",
      "5. 调用SDK执行兑换"
    ]
  },
  "word_count": 3533,
  "extract_time": "2025-05-27 03:58:46"
}