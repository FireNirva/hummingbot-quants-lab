{
  "title": "搭建跨链应用 | 搭建跨链应用 | 指南 | 交易 API | DEX API | DEX API 文档 | 欧易",
  "text": "搭建跨链应用\n#\n在本指南中，我们将通过欧易 DEX 提供的一个示例来展示如何进行跨链兑换，使用 Ethereum 链上的 USDT 兑换 Arbitrum 链上的 USDC。这个过程包括:\n设置你的环境\n检查授权额度\n检查授权交易参数并发起授权交易\n通过 fromChainId 拿到可以交易的 toChainId 列表，并选择其中一条链作为目标链\n通过 toChainId 拿到该链的币种列表，并且选择其中一个代币作为目标链币种\n请求询价接口，拿到询价数据，主要目的是为了获取跨链桥 ID\n请求跨链兑换接口，发起交易\n查询交易状态\n1. 设置你的环境\n#\nconst\n{\nWeb3\n}\n=\nrequire\n(\n'web3'\n)\n;\nconst\ncryptoJS\n=\nrequire\n(\n'crypto-js'\n)\n;\n// The URL for the Ethereum node you want to connect to\nconst\nweb3\n=\nnew\nWeb3\n(\n'https://......com'\n)\n;\nconst\napiBaseUrl\n=\n'https://web3.okx.com/api/v5/dex/aggregator'\n;\n// --------------------- environment variable ---------------------\nconst\nchainId\n=\n'1'\n;\n// USDT contract address on Ethereum\nconst\nfromTokenAddress\n=\n'0xdac17f958d2ee523a2206206994597c13d831ec7'\n;\n// USDC on Arbitrum will be set later\nconst\ntoTokenAddress\n=\n'0xff970a61a04b1ca14834a43f5de4533ebddb5cc8'\n;\n// gasPrice or GasLimit ratio\nconst\nratio\n=\nBigInt\n(\n3\n)\n/\nBigInt\n(\n2\n)\n;\n// your wallet address\nconst\nuser\n=\n'0x6f9fxxxxxxxxxxxxxxxxxxxx61059dcfd9'\nconst\nfromAmount\n=\n'1000000'\n// user wallet private key\nconst\nprivateKey\n=\n'xxxxx'\n;\n// open api Secret key\nconst\nsecretkey\n=\n'xxxxx'\n// Get the current time\nconst\ndate\n=\nnew\nDate\n(\n)\n;\n// --------------------- util function ---------------------\nfunction\ngetAggregatorRequestUrl\n(\nmethodName\n,\nqueryParams\n)\n{\nreturn\napiBaseUrl\n+\nmethodName\n+\n'?'\n+\n(\nnew\nURLSearchParams\n(\nqueryParams\n)\n)\n.\ntoString\n(\n)\n;\n}\n// For cross-chain operations\nfunction\ngetCrossChainBaseUrl\n(\nmethodName\n,\nqueryParams\n)\n{\nconst\nbaseUrl\n=\n'https://web3.okx.com/api/v5/dex/cross-chain'\n;\nreturn\n{\napiRequestUrl\n:\nbaseUrl\n+\nmethodName\n+\n'?'\n+\n(\nnew\nURLSearchParams\n(\nqueryParams\n)\n)\n.\ntoString\n(\n)\n,\npath\n:\nmethodName\n+\n'?'\n+\n(\nnew\nURLSearchParams\n(\nqueryParams\n)\n)\n.\ntoString\n(\n)\n}\n;\n}\nconst\nheadersParams\n=\n{\n'Content-Type'\n:\n'application/json'\n,\n// The api Key obtained from the previous application\n'OK-ACCESS-KEY'\n:\n'xxxxx'\n,\n'OK-ACCESS-SIGN'\n:\ncryptoJS\n.\nenc\n.\nBase64\n.\nstringify\n(\n// The field order of headersParams should be consistent with the order of quoteParams.\n// example : quote ==> cryptoJS.HmacSHA256(timestamp + 'GET' + '/api/v5/dex/aggregator/quote?amount=1000000&chainId=1&toTokenAddress=0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE&fromTokenAddress=0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48', secretKey)\ncryptoJS\n.\nHmacSHA256\n(\ndate\n.\ntoISOString\n(\n)\n+\n'GET'\n+\n'/api/v5/dex/aggregator/quote?amount=1000000&chainId=1&toTokenAddress=0xff970a61a04b1ca14834a43f5de4533ebddb5cc8&fromTokenAddress=0xdac17f958d2ee523a2206206994597c13d831ec7'\n,\nsecretkey\n)\n)\n,\n// Convert the current time to the desired format\n'OK-ACCESS-TIMESTAMP'\n:\ndate\n.\ntoISOString\n(\n)\n,\n// The password created when applying for the key\n'OK-ACCESS-PASSPHRASE'\n:\n'xxxxxxx'\n,\n}\n;\n2. 检查授权额度\n#\n以 ETH chain 举例\n#\nDemo 为 JavaScript 语言\n连接到以太坊节点\n：您需要确保您已经连接到一个可用的以太坊节点。您可以使用 web3.js 或其他以太坊开发库来连接到节点。在代码中，您需要指定节点的 HTTP 或 WebSocket 端点。\n获取代币合约实例\n：使用代币的合约地址和 ABI，您需要创建一个代币合约的实例。您可以使用 web3.js 的 web3.eth.Contract 方法来实现这一点，将合约地址和 ABI 作为参数传递给合约实例。\n查询授权额度\n：通过调用合约实例的 allowance 函数来查询授权额度。该函数需要两个参数：拥有者的地址和被授权者的地址。您可以通过在调用时提供这两个地址来查询授权额度。\nspenderAddress 地址可以参考\n此处\n接口 Response 中的 dexTokenApproveAddress。\nconst\n{\nWeb3\n}\n=\nrequire\n(\n'web3'\n)\n;\n// Connect to an Ethereum node\nconst\nweb3\n=\nnew\nWeb3\n(\n'https://xxxxx'\n)\n;\n// token address and ABI\nconst\ntokenAddress\n=\n'0xxxxxxxxx'\n;\n// user address\nconst\nownerAddress\n=\n'0xxxxxxxx'\n;\n// ETH dex token approval address\nconst\nspenderAddress\n=\n'0x40aa958dd87fc8305b97f2ba922cddca374bcd7f'\n;\nconst\ntokenABI\n=\n[\n{\n\"constant\"\n:\ntrue\n,\n\"inputs\"\n:\n[\n{\n\"name\"\n:\n\"_owner\"\n,\n\"type\"\n:\n\"address\"\n}\n,\n{\n\"name\"\n:\n\"_spender\"\n,\n\"type\"\n:\n\"address\"\n}\n]\n,\n\"name\"\n:\n\"allowance\"\n,\n\"outputs\"\n:\n[\n{\n\"name\"\n:\n\"\"\n,\n\"type\"\n:\n\"uint256\"\n}\n]\n,\n\"payable\"\n:\nfalse\n,\n\"stateMutability\"\n:\n\"view\"\n,\n\"type\"\n:\n\"function\"\n}\n]\n;\n// Create token contract instance\nconst\ntokenContract\n=\nnew\nweb3\n.\neth\n.\nContract\n(\ntokenABI\n,\ntokenAddress\n)\n;\n// Query token approve allowance function\nasync\nfunction\ngetAllowance\n(\nownerAddress\n,\nspenderAddress\n)\n{\ntry\n{\nconst\nallowance\n=\nawait\ntokenContract\n.\nmethods\n.\nallowance\n(\nownerAddress\n,\nspenderAddress\n)\n.\ncall\n(\n)\n;\nconsole\n.\nlog\n(\n`\nAllowance for\n${\nownerAddress\n}\nto\n${\nspenderAddress\n}\n:\n${\nallowance\n}\n`\n)\n;\n}\ncatch\n(\nerror\n)\n{\nconsole\n.\nerror\n(\n'Failed to query allowance:'\n,\nerror\n)\n;\n}\n}\ngetAllowance\n(\nownerAddress\n,\nspenderAddress\n)\n.\nthen\n(\nr\n=>\nconsole\n.\nlog\n(\nr\n)\n)\n;\n下文的 allowanceAmount 代表真实的链上授权额度\n2.2 获取授权数量\n#\n提示\n获取授权数量。如果 allowanceAmount < fromTokenAmount，请查看步骤 3，如果 allowanceAmount >= fromTokenAmount，你可以选择使用步骤 3 增加授权数量，或者直接进行步骤 4。\nconst\n{\ndata\n:\nallowanceData\n}\n=\nawait\ngetAllowanceData\n(\n)\n;\nconst\nallowanceAmount\n=\nallowanceData\n?.\n[\n0\n]\n?.\nallowanceAmount\n;\n3. 检查授权交易参数并发起授权交易\n#\n提示\n由于 allowanceAmount < fromTokenAmount，我们需要对该币种进行授权。\n3.1 定义授权交易参数\n#\n接下来，定义你要执行授权交易的参数。\nconst\ngetApproveTransactionParams\n=\n{\nchainId\n:\nfromChainId\n,\ntokenContractAddress\n:\nfromTokenAddress\n,\nuserWalletAddress\n,\napproveAmount\n:\nfromTokenAmount\n,\n}\n;\n3.2 定义辅助函数\n#\n定义一个辅助函数，用于与 DEX API 进行交互。\nconst\napproveTransaction\n=\nasync\n(\n)\n=>\n{\nconst\n{\napiRequestUrl\n,\npath\n}\n=\ngetAggregatorRequestUrl\n(\n'/approve-transaction'\n,\ngetApproveTransactionParams\n)\n;\nreturn\nfetch\n(\napiRequestUrl\n,\n{\nmethod\n:\n'get'\n,\nheaders\n:\nheadersParams\n,\n}\n)\n.\nthen\n(\n(\nres\n)\n=>\nres\n.\njson\n(\n)\n)\n.\nthen\n(\n(\nres\n)\n=>\n{\nreturn\nres\n;\n}\n)\n;\n}\n;\n3.3 获取授权交易 tx 并且发送授权交易\n#\nif\n(\nparseFloat\n(\nallowanceAmount\n)\n<\nparseFloat\n(\nfromTokenAmount\n)\n)\n{\nconst\n{\ndata\n}\n=\nawait\napproveTransaction\n(\nallowanceAmount\n)\n;\nlet\nallowanceParams\n=\n{\n...\n{\ndata\n:\ndata\n[\n0\n]\n.\ndata\n}\n,\n// You can modify the data content you want according to the web3 official website\n}\n;\nconst\n{\nrawTransaction\n}\n=\nawait\nweb3\n.\neth\n.\naccounts\n.\nsignTransaction\n(\nallowanceParams\n,\nprivateKey\n)\n;\nawait\nweb3\n.\neth\n.\nsendSignedTransaction\n(\nrawTransaction\n)\n;\n}\n4. 通过 fromChainId 拿到可以交易的 toChainId 列表，并选择其中一条链作为目标链\n#\n4.1 定义获取支持的目标链参数\n#\n接下来，定义参数，并通过 fromChainId 拿到对应的 toChainId 列表。\nconst\ntoChainListParams\n=\n{\nchainId\n:\nfromChainId\n,\n}\n;\n4.2 定义辅助函数\n#\n定义一个辅助函数，用于与 DEX API 进行交互。\nconst\ngetSupportedChain\n=\nasync\n(\n)\n=>\n{\nconst\n{\napiRequestUrl\n,\npath\n}\n=\ngetCrossChainBaseUrl\n(\n'/supported/chain'\n,\ntoChainListParams\n)\n;\nreturn\nfetch\n(\napiRequestUrl\n,\n{\nmethod\n:\n'get'\n,\nheaders\n:\nheadersParams\n,\n}\n)\n.\nthen\n(\n(\nres\n)\n=>\nres\n.\njson\n(\n)\n)\n.\nthen\n(\n(\nres\n)\n=>\n{\nreturn\nres\n;\n}\n)\n;\n}\n;\n4.3 获取支持的目标链列表并选择 Arbitrum 链，你也可以根据列表选择其他链作为目标链\n#\nconst\n{\ndata\n:\nsupportedChainList\n}\n=\nawait\ngetSupportedChain\n(\n)\n;\nconst\nselectChainItem\n=\nsupportedChainList\n.\nfind\n(\n(\nitem\n)\n=>\n{\nreturn\nitem\n.\nchainName\n===\n'Arbitrum'\n;\n}\n)\n;\ntoChainId\n=\nselectChainItem\n?.\nchainId\n;\n5. 通过 toChainId 拿到该链的币种列表，并且选择其中一个代币作为目标链币种\n#\n5.1 定义获取可交易币种参数\n#\n接下来，定义参数，并通过 toChainId 拿到可交易的币种列表。\nconst\ntoChainTokenListParams\n=\n{\nchainId\n:\ntoChainId\n,\n}\n;\n5.2 定义辅助函数\n#\n定义一个辅助函数，用于与 DEX API 进行交互。\nconst\ngetToChainTokenList\n=\nasync\n(\n)\n=>\n{\nconst\n{\napiRequestUrl\n,\npath\n}\n=\ngetAggregatorRequestUrl\n(\n'/all-tokens'\n'\n,\ntoChainTokenListParams\n)\n;\nreturn\nfetch\n(\napiRequestUrl\n,\n{\nmethod\n:\n'get'\n,\nheaders\n:\nheadersParams\n,\n}\n)\n.\nthen\n(\n(\nres\n)\n=>\nres\n.\njson\n(\n)\n)\n.\nthen\n(\n(\nres\n)\n=>\n{\nreturn\nres\n;\n}\n)\n;\n}\n;\n5.3 获取币种列表并选择 USDC 币种，你也可以根据列表选择其他币种作为目标链币种\n#\nconst\n{\ndata\n:\ntoChainTokenList\n}\n=\nawait\ngetToChainTokenList\n(\n)\n;\nconst\nselectToChainToken\n=\ntoChainTokenList\n.\nfind\n(\n(\nitem\n)\n=>\n{\nreturn\nitem\n.\ntokenSymbol\n===\n'USDC'\n;\n}\n)\n;\ntoTokenAddress\n=\nselectToChainToken\n?.\ntokenContractAddress\n;\n6. 请求询价接口，拿到询价数据，主要目的是为了获取跨链桥 ID\n#\n6.1 定义询价参数\n#\n接下来，定义参数，用来拿到询价的基础信息和路径列表信息。\nconst\nquoteParams\n=\n{\nfromChainId\n,\ntoChainId\n,\nfromTokenAddress\n,\ntoTokenAddress\n,\namount\n:\nfromTokenAmount\n,\nslippage\n,\n}\n;\n6.2 定义辅助函数\n#\n定义一个辅助函数，用于与 DEX API 进行交互。\nconst\ngetQuote\n=\nasync\n(\n)\n=>\n{\nconst\n{\napiRequestUrl\n,\npath\n}\n=\ngetCrossChainBaseUrl\n(\n'/quote'\n,\nquoteParams\n)\n;\nreturn\nfetch\n(\napiRequestUrl\n,\n{\nmethod\n:\n'get'\n,\nheaders\n:\nheadersParams\n,\n}\n)\n.\nthen\n(\n(\nres\n)\n=>\nres\n.\njson\n(\n)\n)\n.\nthen\n(\n(\nres\n)\n=>\n{\nreturn\nres\n;\n}\n)\n;\n}\n;\n6.3 获取询价信息，并选择一条路径作为交易路径\n#\nconst\n{\ndata\n:\nquoteData\n}\n=\nawait\ngetQuote\n(\n)\n;\nbridgeId\n=\nquoteData\n[\n0\n]\n?.\nrouterList\n[\n0\n]\n?.\nrouter\n?.\nbridgeId\n;\n7. 请求跨链兑换接口，发起交易\n#\n7.1 定义跨链兑换参数\n#\n接下来，定义参数，并获取跨链兑换的 tx 信息。\nconst\nswapParams\n=\n{\nfromChainId\n:\nfromChainId\n,\ntoChainId\n:\ntoChainId\n,\nfromTokenAddress\n,\ntoTokenAddress\n,\namount\n:\nfromTokenAmount\n,\nslippage\n,\nuserWalletAddress\n,\nbridgeId\n,\n}\n;\n7.2 定义辅助函数\n#\n定义一个辅助函数，用于与 DEX API 进行交互。\nconst\ngetSwapData\n=\nasync\n(\n)\n=>\n{\nconst\n{\napiRequestUrl\n,\npath\n}\n=\ngetCrossChainBaseUrl\n(\n'/build-tx'\n,\nswapParams\n)\n;\nreturn\nfetch\n(\napiRequestUrl\n,\n{\nmethod\n:\n'get'\n,\nheaders\n:\nheadersParams\n,\n}\n)\n.\nthen\n(\n(\nres\n)\n=>\nres\n.\njson\n(\n)\n)\n.\nthen\n(\n(\nres\n)\n=>\n{\nreturn\nres\n;\n}\n)\n;\n}\n;\n7.3 请求跨链兑换接口拿到 tx 信息，发起上链交易\n#\nconst\n{\ndata\n:\nswapData\n}\n=\nawait\ngetSwapData\n(\n)\n;\nconst\nswapDataTxInfo\n=\nswapData\n[\n0\n]\n.\ntx\n;\nconst\nnonce\n=\nawait\nweb3\n.\neth\n.\ngetTransactionCount\n(\nuserWalletAddress\n,\n'latest'\n)\n;\n// You can obtain the latest nonce and process the hexadecimal numbers starting with 0x according to your needs\nlet\nsignTransactionParams\n=\n{\ndata\n:\nswapDataTxInfo\n.\ndata\n,\ngasPrice\n:\nswapDataTxInfo\n.\ngasPrice\n,\nto\n:\nswapDataTxInfo\n.\nto\n,\nvalue\n:\nswapDataTxInfo\n.\nvalue\n,\nnonce\n,\n}\n;\nconst\n{\nrawTransaction\n}\n=\nawait\nweb3\n.\neth\n.\naccounts\n.\nsignTransaction\n(\nsignTransactionParams\n,\nprivateKey\n)\n;\nconst\nchainTxInfo\n=\nawait\nweb3\n.\neth\n.\nsendSignedTransaction\n(\nrawTransaction\n)\n;\ntransactionTx\n=\nchainTxInfo\n;\n8. 查询交易状态\n#\n8.1 定义查询参数\n#\n接下来，定义参数，主要为源链 Hash 地址信息。\nconst\ngetCheckStatusParams\n=\n{\nhash\n:\ntransactionTx\n,\n}\n;\n8.2 定义辅助函数\n#\n定义一个辅助函数，用于与 DEX API 进行交互。\nconst\ncheckTransactionStatus\n=\nasync\n(\n)\n=>\n{\nconst\n{\napiRequestUrl\n,\npath\n}\n=\ngetCrossChainBaseUrl\n(\n'/status'\n,\ngetCheckStatusParams\n)\n;\nreturn\nfetch\n(\napiRequestUrl\n,\n{\nmethod\n:\n'get'\n,\nheaders\n:\nheadersParams\n,\n}\n)\n.\nthen\n(\n(\nres\n)\n=>\nres\n.\njson\n(\n)\n)\n.\nthen\n(\n(\nres\n)\n=>\n{\nreturn\nres\n;\n}\n)\n;\n}\n;\n8.3 获取交易状态\n#\n提示\n你也可以增加轮询的方式获取实时订单状态，这里为单次查询的例子。\nconst\n{\ndata\n:\nstatusInfo\n}\n=\nawait\ncheckTransactionStatus\n(\n)\n;\nconsole\n.\nlog\n(\nstatusInfo\n?.\ndata\n[\n0\n]\n?.\ndetailStatus\n)\n;",
  "html": "<div class=\"routes_md__xWlGF\"><!--$--><h1 id=\"搭建跨链应用\">搭建跨链应用<a class=\"index_header-anchor__Xqb+L\" href=\"#搭建跨链应用\" style=\"opacity:0\">#</a></h1>\n<p>在本指南中，我们将通过欧易 DEX 提供的一个示例来展示如何进行跨链兑换，使用 Ethereum 链上的 USDT 兑换 Arbitrum 链上的 USDC。这个过程包括:</p>\n<ul>\n<li>设置你的环境</li>\n<li>检查授权额度</li>\n<li>检查授权交易参数并发起授权交易</li>\n<li>通过 fromChainId 拿到可以交易的 toChainId 列表，并选择其中一条链作为目标链</li>\n<li>通过 toChainId 拿到该链的币种列表，并且选择其中一个代币作为目标链币种</li>\n<li>请求询价接口，拿到询价数据，主要目的是为了获取跨链桥 ID</li>\n<li>请求跨链兑换接口，发起交易</li>\n<li>查询交易状态</li>\n</ul>\n<h2 data-content=\"1. 设置你的环境\" id=\"1.-设置你的环境\">1. 设置你的环境<a class=\"index_header-anchor__Xqb+L\" href=\"#1.-设置你的环境\" style=\"opacity:0\">#</a></h2>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">Web3</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'web3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> cryptoJS <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'crypto-js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// The URL for the Ethereum node you want to connect to</span>\n<span class=\"token keyword\">const</span> web3 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Web3</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://......com'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> apiBaseUrl <span class=\"token operator\">=</span> <span class=\"token string\">'https://web3.okx.com/api/v5/dex/aggregator'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// --------------------- environment variable ---------------------</span>\n<span class=\"token keyword\">const</span> chainId <span class=\"token operator\">=</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// USDT contract address on Ethereum</span>\n<span class=\"token keyword\">const</span> fromTokenAddress <span class=\"token operator\">=</span> <span class=\"token string\">'0xdac17f958d2ee523a2206206994597c13d831ec7'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// USDC on Arbitrum will be set later</span>\n<span class=\"token keyword\">const</span> toTokenAddress <span class=\"token operator\">=</span> <span class=\"token string\">'0xff970a61a04b1ca14834a43f5de4533ebddb5cc8'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// gasPrice or GasLimit ratio</span>\n<span class=\"token keyword\">const</span> ratio <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">BigInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token known-class-name class-name\">BigInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// your wallet address</span>\n<span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token string\">'0x6f9fxxxxxxxxxxxxxxxxxxxx61059dcfd9'</span>\n<span class=\"token keyword\">const</span> fromAmount <span class=\"token operator\">=</span> <span class=\"token string\">'1000000'</span>\n<span class=\"token comment\">// user wallet private key</span>\n<span class=\"token keyword\">const</span> privateKey <span class=\"token operator\">=</span> <span class=\"token string\">'xxxxx'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// open api Secret key</span>\n<span class=\"token keyword\">const</span> secretkey <span class=\"token operator\">=</span> <span class=\"token string\">'xxxxx'</span>\n<span class=\"token comment\">// Get the current time</span>\n<span class=\"token keyword\">const</span> date <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// --------------------- util function ---------------------</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">getAggregatorRequestUrl</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">methodName<span class=\"token punctuation\">,</span> queryParams</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> apiBaseUrl <span class=\"token operator\">+</span> methodName <span class=\"token operator\">+</span> <span class=\"token string\">'?'</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span>queryParams<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// For cross-chain operations</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">getCrossChainBaseUrl</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">methodName<span class=\"token punctuation\">,</span> queryParams</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> baseUrl <span class=\"token operator\">=</span> <span class=\"token string\">'https://web3.okx.com/api/v5/dex/cross-chain'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">apiRequestUrl</span><span class=\"token operator\">:</span> baseUrl <span class=\"token operator\">+</span> methodName <span class=\"token operator\">+</span> <span class=\"token string\">'?'</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span>queryParams<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> methodName <span class=\"token operator\">+</span> <span class=\"token string\">'?'</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span>queryParams<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> headersParams <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// The api Key obtained from the previous application</span>\n    <span class=\"token string-property property\">'OK-ACCESS-KEY'</span><span class=\"token operator\">:</span> <span class=\"token string\">'xxxxx'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'OK-ACCESS-SIGN'</span><span class=\"token operator\">:</span> cryptoJS<span class=\"token punctuation\">.</span><span class=\"token property-access\">enc</span><span class=\"token punctuation\">.</span><span class=\"token property-access\"><span class=\"token maybe-class-name\">Base64</span></span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// The field order of headersParams should be consistent with the order of quoteParams.</span>\n    <span class=\"token comment\">// example : quote ==&gt; cryptoJS.HmacSHA256(timestamp + 'GET' + '/api/v5/dex/aggregator/quote?amount=1000000&amp;chainId=1&amp;toTokenAddress=0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE&amp;fromTokenAddress=0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48', secretKey)</span>\n        cryptoJS<span class=\"token punctuation\">.</span><span class=\"token method function property-access\"><span class=\"token maybe-class-name\">HmacSHA256</span></span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'GET'</span> <span class=\"token operator\">+</span> <span class=\"token string\">'/api/v5/dex/aggregator/quote?amount=1000000&amp;chainId=1&amp;toTokenAddress=0xff970a61a04b1ca14834a43f5de4533ebddb5cc8&amp;fromTokenAddress=0xdac17f958d2ee523a2206206994597c13d831ec7'</span><span class=\"token punctuation\">,</span> secretkey<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Convert the current time to the desired format</span>\n    <span class=\"token string-property property\">'OK-ACCESS-TIMESTAMP'</span><span class=\"token operator\">:</span> date<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// The password created when applying for the key</span>\n    <span class=\"token string-property property\">'OK-ACCESS-PASSPHRASE'</span><span class=\"token operator\">:</span> <span class=\"token string\">'xxxxxxx'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h2 data-content=\"2. 检查授权额度\" id=\"2.-检查授权额度\">2. 检查授权额度<a class=\"index_header-anchor__Xqb+L\" href=\"#2.-检查授权额度\" style=\"opacity:0\">#</a></h2>\n<h3 id=\"以-eth-chain-举例\">以 ETH chain 举例<a class=\"index_header-anchor__Xqb+L\" href=\"#以-eth-chain-举例\" style=\"opacity:0\">#</a></h3>\n<ul>\n<li><code>Demo 为 JavaScript 语言</code></li>\n</ul>\n<ol>\n<li><code>连接到以太坊节点</code>：您需要确保您已经连接到一个可用的以太坊节点。您可以使用 web3.js 或其他以太坊开发库来连接到节点。在代码中，您需要指定节点的 HTTP 或 WebSocket 端点。</li>\n<li><code>获取代币合约实例</code>：使用代币的合约地址和 ABI，您需要创建一个代币合约的实例。您可以使用 web3.js 的 web3.eth.Contract 方法来实现这一点，将合约地址和 ABI 作为参数传递给合约实例。</li>\n<li><code>查询授权额度</code>：通过调用合约实例的 allowance 函数来查询授权额度。该函数需要两个参数：拥有者的地址和被授权者的地址。您可以通过在调用时提供这两个地址来查询授权额度。</li>\n<li>spenderAddress 地址可以参考 <a href=\"/zh-hans/build/dev-docs/dex-api/dex-get-supported-chains\">此处</a> 接口 Response 中的 dexTokenApproveAddress。</li>\n</ol>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">Web3</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'web3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Connect to an Ethereum node</span>\n<span class=\"token keyword\">const</span> web3 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Web3</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://xxxxx'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// token address and  ABI</span>\n<span class=\"token keyword\">const</span> tokenAddress <span class=\"token operator\">=</span> <span class=\"token string\">'0xxxxxxxxx'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// user address</span>\n<span class=\"token keyword\">const</span> ownerAddress <span class=\"token operator\">=</span> <span class=\"token string\">'0xxxxxxxx'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ETH dex token approval address</span>\n<span class=\"token keyword\">const</span> spenderAddress <span class=\"token operator\">=</span> <span class=\"token string\">'0x40aa958dd87fc8305b97f2ba922cddca374bcd7f'</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">const</span> tokenABI <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">\"constant\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"inputs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token string-property property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_owner\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string-property property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"address\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token string-property property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_spender\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string-property property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"address\"</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"allowance\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"outputs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token string-property property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string-property property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"uint256\"</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"payable\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"stateMutability\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"view\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"function\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token comment\">// Create token contract instance</span>\n<span class=\"token keyword\">const</span> tokenContract <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">web3<span class=\"token punctuation\">.</span>eth<span class=\"token punctuation\">.</span>Contract</span><span class=\"token punctuation\">(</span>tokenABI<span class=\"token punctuation\">,</span> tokenAddress<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Query token approve allowance function</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getAllowance</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">ownerAddress<span class=\"token punctuation\">,</span> spenderAddress</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> allowance <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> tokenContract<span class=\"token punctuation\">.</span><span class=\"token property-access\">methods</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">allowance</span><span class=\"token punctuation\">(</span>ownerAddress<span class=\"token punctuation\">,</span> spenderAddress<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Allowance for </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>ownerAddress<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> to </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>spenderAddress<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>allowance<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Failed to query allowance:'</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">getAllowance</span><span class=\"token punctuation\">(</span>ownerAddress<span class=\"token punctuation\">,</span> spenderAddress<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">r</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<ul>\n<li>下文的 allowanceAmount 代表真实的链上授权额度</li>\n</ul>\n<h3 id=\"2.2-获取授权数量\">2.2 获取授权数量<a class=\"index_header-anchor__Xqb+L\" href=\"#2.2-获取授权数量\" style=\"opacity:0\">#</a></h3>\n<div class=\"index_wrapper__x5A2Q\"><div aria-labelledby=\":Rpbf:\" class=\"okui-alert info-alert\"><i aria-hidden=\"true\" class=\"icon iconfont okui-alert-icon doc-ssr-okds-information-circle-fill\" role=\"img\"></i><div class=\"okui-alert-msg-box\"><div class=\"okui-alert-title\" id=\":Rpbf:\">提示</div><div class=\"okui-alert-desc\"><div class=\"index_desc__5fNBE\">获取授权数量。如果 allowanceAmount &lt; fromTokenAmount，请查看步骤 3，如果 allowanceAmount &gt;= fromTokenAmount，你可以选择使用步骤 3 增加授权数量，或者直接进行步骤 4。</div></div></div></div></div>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> allowanceData <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">getAllowanceData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> allowanceAmount <span class=\"token operator\">=</span> allowanceData<span class=\"token operator\">?.</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">?.</span>allowanceAmount<span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h2 data-content=\"3. 检查授权交易参数并发起授权交易\" id=\"3.-检查授权交易参数并发起授权交易\">3. 检查授权交易参数并发起授权交易<a class=\"index_header-anchor__Xqb+L\" href=\"#3.-检查授权交易参数并发起授权交易\" style=\"opacity:0\">#</a></h2>\n<div class=\"index_wrapper__x5A2Q\"><div aria-labelledby=\":Rvbf:\" class=\"okui-alert info-alert\"><i aria-hidden=\"true\" class=\"icon iconfont okui-alert-icon doc-ssr-okds-information-circle-fill\" role=\"img\"></i><div class=\"okui-alert-msg-box\"><div class=\"okui-alert-title\" id=\":Rvbf:\">提示</div><div class=\"okui-alert-desc\"><div class=\"index_desc__5fNBE\">由于 allowanceAmount &lt; fromTokenAmount，我们需要对该币种进行授权。</div></div></div></div></div>\n<h3 id=\"3.1-定义授权交易参数\">3.1 定义授权交易参数<a class=\"index_header-anchor__Xqb+L\" href=\"#3.1-定义授权交易参数\" style=\"opacity:0\">#</a></h3>\n<p>接下来，定义你要执行授权交易的参数。</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> getApproveTransactionParams <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">chainId</span><span class=\"token operator\">:</span> fromChainId<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">tokenContractAddress</span><span class=\"token operator\">:</span> fromTokenAddress<span class=\"token punctuation\">,</span>\n  userWalletAddress<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">approveAmount</span><span class=\"token operator\">:</span> fromTokenAmount<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3 id=\"3.2-定义辅助函数\">3.2 定义辅助函数<a class=\"index_header-anchor__Xqb+L\" href=\"#3.2-定义辅助函数\" style=\"opacity:0\">#</a></h3>\n<p>定义一个辅助函数，用于与 DEX API 进行交互。</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">approveTransaction</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> apiRequestUrl<span class=\"token punctuation\">,</span> path <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">getAggregatorRequestUrl</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'/approve-transaction'</span><span class=\"token punctuation\">,</span>\n    getApproveTransactionParams\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>apiRequestUrl<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">'get'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> headersParams<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> res<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> res<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3 id=\"3.3-获取授权交易-tx-并且发送授权交易\">3.3 获取授权交易 tx 并且发送授权交易<a class=\"index_header-anchor__Xqb+L\" href=\"#3.3-获取授权交易-tx-并且发送授权交易\" style=\"opacity:0\">#</a></h3>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span>allowanceAmount<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span>fromTokenAmount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">approveTransaction</span><span class=\"token punctuation\">(</span>allowanceAmount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> allowanceParams <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token spread operator\">...</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> data<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// You can modify the data content you want according to the web3 official website</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> rawTransaction <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> web3<span class=\"token punctuation\">.</span><span class=\"token property-access\">eth</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">accounts</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">signTransaction</span><span class=\"token punctuation\">(</span>\n    allowanceParams<span class=\"token punctuation\">,</span>\n    privateKey\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">await</span> web3<span class=\"token punctuation\">.</span><span class=\"token property-access\">eth</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">sendSignedTransaction</span><span class=\"token punctuation\">(</span>rawTransaction<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2 data-content=\"4. 通过 fromChainId 拿到可以交易的 toChainId 列表，并选择其中一条链作为目标链\" id=\"4.-通过-fromchainid-拿到可以交易的-tochainid-列表，并选择其中一条链作为目标链\">4. 通过 fromChainId 拿到可以交易的 toChainId 列表，并选择其中一条链作为目标链<a class=\"index_header-anchor__Xqb+L\" href=\"#4.-通过-fromchainid-拿到可以交易的-tochainid-列表，并选择其中一条链作为目标链\" style=\"opacity:0\">#</a></h2>\n<h3 id=\"4.1-定义获取支持的目标链参数\">4.1 定义获取支持的目标链参数<a class=\"index_header-anchor__Xqb+L\" href=\"#4.1-定义获取支持的目标链参数\" style=\"opacity:0\">#</a></h3>\n<p>接下来，定义参数，并通过 fromChainId 拿到对应的 toChainId 列表。</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> toChainListParams <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">chainId</span><span class=\"token operator\">:</span> fromChainId<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3 id=\"4.2-定义辅助函数\">4.2 定义辅助函数<a class=\"index_header-anchor__Xqb+L\" href=\"#4.2-定义辅助函数\" style=\"opacity:0\">#</a></h3>\n<p>定义一个辅助函数，用于与 DEX API 进行交互。</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getSupportedChain</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> apiRequestUrl<span class=\"token punctuation\">,</span> path <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">getCrossChainBaseUrl</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'/supported/chain'</span><span class=\"token punctuation\">,</span>\n    toChainListParams\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>apiRequestUrl<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">'get'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> headersParams<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> res<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> res<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3 id=\"4.3-获取支持的目标链列表并选择-arbitrum-链，你也可以根据列表选择其他链作为目标链\">4.3 获取支持的目标链列表并选择 Arbitrum 链，你也可以根据列表选择其他链作为目标链<a class=\"index_header-anchor__Xqb+L\" href=\"#4.3-获取支持的目标链列表并选择-arbitrum-链，你也可以根据列表选择其他链作为目标链\" style=\"opacity:0\">#</a></h3>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> supportedChainList <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">getSupportedChain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> selectChainItem <span class=\"token operator\">=</span> supportedChainList<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> item<span class=\"token punctuation\">.</span><span class=\"token property-access\">chainName</span> <span class=\"token operator\">===</span> <span class=\"token string\">'Arbitrum'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ntoChainId <span class=\"token operator\">=</span> selectChainItem<span class=\"token operator\">?.</span>chainId<span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h2 data-content=\"5. 通过 toChainId 拿到该链的币种列表，并且选择其中一个代币作为目标链币种\" id=\"5.-通过-tochainid-拿到该链的币种列表，并且选择其中一个代币作为目标链币种\">5. 通过 toChainId 拿到该链的币种列表，并且选择其中一个代币作为目标链币种<a class=\"index_header-anchor__Xqb+L\" href=\"#5.-通过-tochainid-拿到该链的币种列表，并且选择其中一个代币作为目标链币种\" style=\"opacity:0\">#</a></h2>\n<h3 id=\"5.1-定义获取可交易币种参数\">5.1 定义获取可交易币种参数<a class=\"index_header-anchor__Xqb+L\" href=\"#5.1-定义获取可交易币种参数\" style=\"opacity:0\">#</a></h3>\n<p>接下来，定义参数，并通过 toChainId 拿到可交易的币种列表。</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> toChainTokenListParams <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">chainId</span><span class=\"token operator\">:</span> toChainId<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3 id=\"5.2-定义辅助函数\">5.2 定义辅助函数<a class=\"index_header-anchor__Xqb+L\" href=\"#5.2-定义辅助函数\" style=\"opacity:0\">#</a></h3>\n<p>定义一个辅助函数，用于与 DEX API 进行交互。</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getToChainTokenList</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> apiRequestUrl<span class=\"token punctuation\">,</span> path <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">getAggregatorRequestUrl</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'/all-tokens'</span>'<span class=\"token punctuation\">,</span>\n    toChainTokenListParams\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>apiRequestUrl<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">'get'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> headersParams<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> res<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> res<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3 id=\"5.3-获取币种列表并选择-usdc-币种，你也可以根据列表选择其他币种作为目标链币种\">5.3 获取币种列表并选择 USDC 币种，你也可以根据列表选择其他币种作为目标链币种<a class=\"index_header-anchor__Xqb+L\" href=\"#5.3-获取币种列表并选择-usdc-币种，你也可以根据列表选择其他币种作为目标链币种\" style=\"opacity:0\">#</a></h3>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> toChainTokenList <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">getToChainTokenList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> selectToChainToken <span class=\"token operator\">=</span> toChainTokenList<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> item<span class=\"token punctuation\">.</span><span class=\"token property-access\">tokenSymbol</span> <span class=\"token operator\">===</span> <span class=\"token string\">'USDC'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ntoTokenAddress <span class=\"token operator\">=</span> selectToChainToken<span class=\"token operator\">?.</span>tokenContractAddress<span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h2 data-content=\"6. 请求询价接口，拿到询价数据，主要目的是为了获取跨链桥 ID\" id=\"6.-请求询价接口，拿到询价数据，主要目的是为了获取跨链桥-id\">6. 请求询价接口，拿到询价数据，主要目的是为了获取跨链桥 ID<a class=\"index_header-anchor__Xqb+L\" href=\"#6.-请求询价接口，拿到询价数据，主要目的是为了获取跨链桥-id\" style=\"opacity:0\">#</a></h2>\n<h3 id=\"6.1-定义询价参数\">6.1 定义询价参数<a class=\"index_header-anchor__Xqb+L\" href=\"#6.1-定义询价参数\" style=\"opacity:0\">#</a></h3>\n<p>接下来，定义参数，用来拿到询价的基础信息和路径列表信息。</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> quoteParams <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  fromChainId<span class=\"token punctuation\">,</span>\n  toChainId<span class=\"token punctuation\">,</span>\n  fromTokenAddress<span class=\"token punctuation\">,</span>\n  toTokenAddress<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">amount</span><span class=\"token operator\">:</span> fromTokenAmount<span class=\"token punctuation\">,</span>\n  slippage<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3 id=\"6.2-定义辅助函数\">6.2 定义辅助函数<a class=\"index_header-anchor__Xqb+L\" href=\"#6.2-定义辅助函数\" style=\"opacity:0\">#</a></h3>\n<p>定义一个辅助函数，用于与 DEX API 进行交互。</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getQuote</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> apiRequestUrl<span class=\"token punctuation\">,</span> path <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">getCrossChainBaseUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/quote'</span><span class=\"token punctuation\">,</span> quoteParams<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>apiRequestUrl<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">'get'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> headersParams<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> res<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> res<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3 id=\"6.3-获取询价信息，并选择一条路径作为交易路径\">6.3 获取询价信息，并选择一条路径作为交易路径<a class=\"index_header-anchor__Xqb+L\" href=\"#6.3-获取询价信息，并选择一条路径作为交易路径\" style=\"opacity:0\">#</a></h3>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> quoteData <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">getQuote</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nbridgeId <span class=\"token operator\">=</span> quoteData<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">?.</span>routerList<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">?.</span>router<span class=\"token operator\">?.</span>bridgeId<span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h2 data-content=\"7. 请求跨链兑换接口，发起交易\" id=\"7.-请求跨链兑换接口，发起交易\">7. 请求跨链兑换接口，发起交易<a class=\"index_header-anchor__Xqb+L\" href=\"#7.-请求跨链兑换接口，发起交易\" style=\"opacity:0\">#</a></h2>\n<h3 id=\"7.1-定义跨链兑换参数\">7.1 定义跨链兑换参数<a class=\"index_header-anchor__Xqb+L\" href=\"#7.1-定义跨链兑换参数\" style=\"opacity:0\">#</a></h3>\n<p>接下来，定义参数，并获取跨链兑换的 tx 信息。</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> swapParams <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">fromChainId</span><span class=\"token operator\">:</span> fromChainId<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">toChainId</span><span class=\"token operator\">:</span> toChainId<span class=\"token punctuation\">,</span>\n  fromTokenAddress<span class=\"token punctuation\">,</span>\n  toTokenAddress<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">amount</span><span class=\"token operator\">:</span> fromTokenAmount<span class=\"token punctuation\">,</span>\n  slippage<span class=\"token punctuation\">,</span>\n  userWalletAddress<span class=\"token punctuation\">,</span>\n  bridgeId<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3 id=\"7.2-定义辅助函数\">7.2 定义辅助函数<a class=\"index_header-anchor__Xqb+L\" href=\"#7.2-定义辅助函数\" style=\"opacity:0\">#</a></h3>\n<p>定义一个辅助函数，用于与 DEX API 进行交互。</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getSwapData</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> apiRequestUrl<span class=\"token punctuation\">,</span> path <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">getCrossChainBaseUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/build-tx'</span><span class=\"token punctuation\">,</span> swapParams<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>apiRequestUrl<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">'get'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> headersParams<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> res<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> res<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3 id=\"7.3-请求跨链兑换接口拿到-tx-信息，发起上链交易\">7.3 请求跨链兑换接口拿到 tx 信息，发起上链交易<a class=\"index_header-anchor__Xqb+L\" href=\"#7.3-请求跨链兑换接口拿到-tx-信息，发起上链交易\" style=\"opacity:0\">#</a></h3>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> swapData <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">getSwapData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> swapDataTxInfo <span class=\"token operator\">=</span> swapData<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tx</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> nonce <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> web3<span class=\"token punctuation\">.</span><span class=\"token property-access\">eth</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getTransactionCount</span><span class=\"token punctuation\">(</span>userWalletAddress<span class=\"token punctuation\">,</span> <span class=\"token string\">'latest'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// You can obtain the latest nonce and process the hexadecimal numbers starting with 0x according to your needs</span>\n<span class=\"token keyword\">let</span> signTransactionParams <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> swapDataTxInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">gasPrice</span><span class=\"token operator\">:</span> swapDataTxInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">gasPrice</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">to</span><span class=\"token operator\">:</span> swapDataTxInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">to</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> swapDataTxInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span><span class=\"token punctuation\">,</span>\n  nonce<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> rawTransaction <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> web3<span class=\"token punctuation\">.</span><span class=\"token property-access\">eth</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">accounts</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">signTransaction</span><span class=\"token punctuation\">(</span>\n  signTransactionParams<span class=\"token punctuation\">,</span>\n  privateKey\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> chainTxInfo <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> web3<span class=\"token punctuation\">.</span><span class=\"token property-access\">eth</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">sendSignedTransaction</span><span class=\"token punctuation\">(</span>rawTransaction<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ntransactionTx <span class=\"token operator\">=</span> chainTxInfo<span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h2 data-content=\"8. 查询交易状态\" id=\"8.-查询交易状态\">8. 查询交易状态<a class=\"index_header-anchor__Xqb+L\" href=\"#8.-查询交易状态\" style=\"opacity:0\">#</a></h2>\n<h3 id=\"8.1-定义查询参数\">8.1 定义查询参数<a class=\"index_header-anchor__Xqb+L\" href=\"#8.1-定义查询参数\" style=\"opacity:0\">#</a></h3>\n<p>接下来，定义参数，主要为源链 Hash 地址信息。</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> getCheckStatusParams <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">hash</span><span class=\"token operator\">:</span> transactionTx<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3 id=\"8.2-定义辅助函数\">8.2 定义辅助函数<a class=\"index_header-anchor__Xqb+L\" href=\"#8.2-定义辅助函数\" style=\"opacity:0\">#</a></h3>\n<p>定义一个辅助函数，用于与 DEX API 进行交互。</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">checkTransactionStatus</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> apiRequestUrl<span class=\"token punctuation\">,</span> path <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">getCrossChainBaseUrl</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'/status'</span><span class=\"token punctuation\">,</span>\n    getCheckStatusParams\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>apiRequestUrl<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">'get'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> headersParams<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> res<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> res<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3 id=\"8.3-获取交易状态\">8.3 获取交易状态<a class=\"index_header-anchor__Xqb+L\" href=\"#8.3-获取交易状态\" style=\"opacity:0\">#</a></h3>\n<div class=\"index_wrapper__x5A2Q\"><div aria-labelledby=\":R49bf:\" class=\"okui-alert info-alert\"><i aria-hidden=\"true\" class=\"icon iconfont okui-alert-icon doc-ssr-okds-information-circle-fill\" role=\"img\"></i><div class=\"okui-alert-msg-box\"><div class=\"okui-alert-title\" id=\":R49bf:\">提示</div><div class=\"okui-alert-desc\"><div class=\"index_desc__5fNBE\">你也可以增加轮询的方式获取实时订单状态，这里为单次查询的例子。</div></div></div></div></div>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> statusInfo <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">checkTransactionStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>statusInfo<span class=\"token operator\">?.</span>data<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">?.</span>detailStatus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div><!--/$--></div>",
  "url": "https://web3.okx.com/zh-hans/build/dev-docs/dex-api/dex-use-crosschain-quick-start#8.3-获取交易状态",
  "navigation": {
    "breadcrumbs": [
      "DEX API",
      "交易 API",
      "搭建跨链应用",
      "搭建跨链应用"
    ],
    "sidebar_links": [
      "搭建兑换应用",
      "搭建跨链应用",
      "搭建跨链应用",
      "在 Solana 链上发送多签交易",
      "介绍",
      "API 参考",
      "设置分佣",
      "DEX 集成",
      "智能合约",
      "错误码",
      "FAQ",
      "介绍",
      "API 参考",
      "支持的跨链桥",
      "智能合约",
      "错误码",
      "FAQ",
      "介绍",
      "API 参考",
      "错误码"
    ],
    "toc": [
      "1. 设置你的环境",
      "2. 检查授权额度",
      "3. 检查授权交易参数并发起授权交易",
      "4. 通过 fromChainId 拿到可以交易的 toChainId 列表，并选择其中一条链作为目标链",
      "5. 通过 toChainId 拿到该链的币种列表，并且选择其中一个代币作为目标链币种",
      "6. 请求询价接口，拿到询价数据，主要目的是为了获取跨链桥 ID",
      "7. 请求跨链兑换接口，发起交易",
      "8. 查询交易状态"
    ]
  },
  "word_count": 1664,
  "extract_time": "2025-05-27 05:07:25"
}