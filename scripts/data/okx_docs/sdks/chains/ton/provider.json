{
  "title": "Provider API | TON | 连接浏览器插件钱包 | 接入 Web3 钱包 | DEX API 文档 | 欧易",
  "text": "Provider API\n#\n什么是 Injected provider API？\n#\n欧易 Injected providers API 是一个 JavaScript API，欧易将其注入用户访问的网站。您的 DApp 可以使用此 API 请求用户帐户，从用户连接的区块链读取数据，帮助用户签署消息和交易。\n特别说明\n#\nOKX Wallet 的 TON API 完全符合\nTon Connect 协议\n的规范。\nDapp 可以使用\nTON Connect SDK\n来更方便地接入 OKX Wallet 。\n获取注入的对象\n#\nOKX Wallet 按照 TON Connect 协议的规范向 Dapp 中注入如下属性：\nwindow\n.\nokxTonWallet\n.\ntonconnect\n其指向的对象的数据结构如下：\ninterface\nTonConnectBridge\n{\ndeviceInfo\n:\nDeviceInfo\n;\nwalletInfo\n?\n:\nWalletInfo\n;\nprotocolVersion\n:\nnumber\n;\nconnect\n(\nprotocolVersion\n:\nnumber\n,\nmessage\n:\nConnectRequest\n)\n:\nPromise\n<\nConnectEvent\n>\n;\nrestoreConnection\n(\n)\n:\nPromise\n<\nConnectEvent\n>\n;\nsend\n(\nmessage\n:\nAppRequest\n)\n:\nPromise\n<\nWalletResponse\n>\n;\nlisten\n(\ncallback\n:\n(\nevent\n:\nWalletEvent\n)\n=>\nvoid\n)\n:\n(\n)\n=>\nvoid\n;\n}\ndeviceInfo\n#\n用于获取设备信息，数据结构如下：\n{\nplatform\n:\n'browser'\n,\nappName\n:\n'OKX Wallet'\n,\nappVersion\n:\n'3.3.19'\n,\nmaxProtocolVersion\n:\n2\n,\nfeatures\n:\n[\n'SendTransaction'\n,\n{\nname\n:\n'SendTransaction'\n,\nmaxMessages\n:\n4\n,\n}\n,\n]\n,\n}\nplatform\n：设备平台\nappName\n：钱包名称\nappVersion\n：钱包版本\nmaxProtocolVersion\n：支持的最大协议版本\nfeatures\n：钱包支持的特性\nwalletInfo\n#\n用于获取钱包信息，数据结构如下：\n{\nname\n:\n'OKX Wallet'\n,\napp_name\n:\n'okxTonWallet'\n,\nimage\n:\n'https://static.okx.com/cdn/assets/imgs/247/58E63FEA47A2B7D7.png'\n,\nabout_url\n:\n'https://web3.okx.com/web3'\n,\nplatforms\n:\n[\n'chrome'\n,\n'firefox'\n,\n'safari'\n]\n,\n}\nname\n：钱包名称\napp_name\n：钱包应用唯一标识\nimage\n：钱包图标\nabout_url\n：钱包介绍页面\nplatforms\n：钱包支持的平台\nprotocolVersion\n#\nOKX Wallet 支持的 Ton Connect 的版本，目前为 2 。\nconnect\n#\n连接钱包的方法，连接钱包时，也可以对钱包进行签名验证。\nconnect\n(\nprotocolVersion\n:\nnumber\n,\nmessage\n:\nConnectRequest\n)\n:\nPromise\n<\nConnectEvent\n>\n;\n入参\n#\nprotocolVersion\n：Dapp 期望钱包支持的 Ton Connect 的版本，如果钱包暂未支持该版本，会直接返回错误\nmessage\n: 连接钱包的请求信息\nmessage 入参\ntype\nConnectRequest\n=\n{\nmanifestUrl\n:\nstring\n;\nitems\n:\nConnectItem\n[\n]\n,\n// 与应用共享的数据项\n}\ntype\nConnectItem\n=\nTonAddressItem\n|\nTonProofItem\ntype\nTonAddressItem\n=\n{\nname\n:\n\"ton_addr\"\n;\n}\ntype\nTonProofItem\n=\n{\nname\n:\n\"ton_proof\"\n;\npayload\n:\nstring\n;\n// 任意载荷，例如 nonce + 过期时间戳。\n}\nmanifestUrl\n：Dapp 的 manifest.json 文件的 URL，该文件中包含 Dapp 的元信息，数据结构如下：\n{\n\"url\"\n:\n\"<app-url>\"\n,\n// 必填\n\"name\"\n:\n\"<app-name>\"\n,\n// 必填\n\"iconUrl\"\n:\n\"<app-icon-url>\"\n,\n// 必填\n\"termsOfUseUrl\"\n:\n\"<terms-of-use-url>\"\n,\n// 可选\n\"privacyPolicyUrl\"\n:\n\"<privacy-policy-url>\"\n// 可选\n}\nitems\n：请求钱包的指令列表，目前支持两个指令：\nton_addr\n：获取用户的地址、公钥等信息\nton_proof\n：对钱包进行签名验证\n返回值\n#\n返回一个 Promise 对象，Promise 对象的结果为\nConnectEvent\n，数据结构如下：\ntype\nConnectEvent\n=\nConnectEventSuccess\n|\nConnectEventError\n;\ntype\nConnectEventSuccess\n=\n{\nevent\n:\n\"connect\"\n;\nid\n:\nnumber\n;\n// 递增的事件计数器\npayload\n:\n{\nitems\n:\nConnectItemReply\n[\n]\n;\ndevice\n:\nDeviceInfo\n;\n}\n}\ntype\nConnectEventError\n=\n{\nevent\n:\n\"connect_error\"\n,\nid\n:\nnumber\n;\n// 递增的事件计数器\npayload\n:\n{\ncode\n:\nnumber\n;\nmessage\n:\nstring\n;\n}\n}\n// 与 window.okxTonWallet.tonconnect 对象上的 deviceInfo 完全相同\ntype\nDeviceInfo\n=\n{\nplatform\n:\n\"iphone\"\n|\n\"ipad\"\n|\n\"android\"\n|\n\"windows\"\n|\n\"mac\"\n|\n\"linux\"\n;\nappName\n:\nstring\n;\nappVersion\n:\nstring\n;\nmaxProtocolVersion\n:\nnumber\n;\nfeatures\n:\nFeature\n[\n]\n;\n}\ntype\nFeature\n=\n{\nname\n:\n'SendTransaction'\n,\nmaxMessages\n:\nnumber\n}\n// `maxMessages` 是钱包支持的一次 `SendTransaction` 中的最大消息数\ntype\nConnectItemReply\n=\nTonAddressItemReply\n|\nTonProofItemReply\n;\n// 由钱包返回的不受信任的数据。\n// 如果您需要保证用户拥有此地址和公钥，您需要额外请求 ton_proof。\ntype\nTonAddressItemReply\n=\n{\nname\n:\n\"ton_addr\"\n;\naddress\n:\nstring\n;\n// TON 地址原始 (`0:<hex>`)\nnetwork\n:\nNETWORK\n;\n// 网络 global_id\npublicKey\n:\nstring\n;\n// HEX 字符串，不带 0x\nwalletStateInit\n:\nstring\n;\n// Base64（不安全 URL）编码的钱包合约的 stateinit cell\n}\ntype\nTonProofItemReply\n=\n{\nname\n:\n\"ton_proof\"\n;\nproof\n:\n{\ntimestamp\n:\nstring\n;\n// 签名操作的 64 位 unix epoch 时间（秒）\ndomain\n:\n{\nlengthBytes\n:\nnumber\n;\n// AppDomain 长度\nvalue\n:\nstring\n;\n// 应用域名（作为 url 部分，无编码）\n}\n;\nsignature\n:\nstring\n;\n// base64 编码的签名\npayload\n:\nstring\n;\n// 请求中的载荷\n}\n}\n// 目前仅支持主网\nenum\nNETWORK\n{\nMAINNET\n=\n'-239'\n,\nTESTNET\n=\n'-3'\n}\n示例\n#\n只是获取用户的地址、公钥等信息：\nconst\nresult\n=\nawait\nwindow\n.\nokxTonWallet\n.\ntonconnect\n.\nconnect\n(\n2\n,\n{\nmanifestUrl\n:\n'https://example.com/manifest.json'\n,\nitems\n:\n[\n{\nname\n:\n'ton_addr'\n}\n]\n}\n)\nif\n(\nresult\n.\nevent\n===\n'connect'\n)\n{\nconsole\n.\nlog\n(\nresult\n.\npayload\n.\nitems\n[\n0\n]\n.\naddress\n)\n}\nelse\n{\nconsole\n.\nlog\n(\nresult\n.\npayload\n.\nmessage\n)\n}\n获取用户地址、公钥等信息，同时对钱包进行签名验证：\nconst\nresult\n=\nawait\nwindow\n.\nokxTonWallet\n.\ntonconnect\n.\nconnect\n(\n2\n,\n{\nmanifestUrl\n:\n'https://example.com/manifest.json'\n,\nitems\n:\n[\n{\nname\n:\n'ton_addr'\n}\n,\n{\nname\n:\n'ton_proof'\n,\npayload\n:\n'123'\n}\n]\n}\n)\nif\n(\nresult\n.\nevent\n===\n'connect'\n)\n{\nconsole\n.\nlog\n(\nresult\n.\npayload\n.\nitems\n[\n0\n]\n.\naddress\n)\nconsole\n.\nlog\n(\nresult\n.\npayload\n.\nitems\n[\n1\n]\n.\nproof\n)\n}\nelse\n{\nconsole\n.\nlog\n(\nresult\n.\npayload\n.\nmessage\n)\n}\nrestoreConnection\n#\n恢复连接的方法，只会返回\nton_addr\n指令的结果，如果无法连接钱包，则返回错误。\nrestoreConnection\n(\n)\n:\nPromise\n<\nConnectEvent\n>\n;\n示例\n#\nconst\nresult\n=\nawait\nwindow\n.\nokxTonWallet\n.\ntonconnect\n.\nrestoreConnection\n(\n)\nif\n(\nresult\n.\nevent\n===\n'connect'\n)\n{\nconsole\n.\nlog\n(\nresult\n.\npayload\n.\nitems\n[\n0\n]\n.\naddress\n)\n}\nelse\n{\nconsole\n.\nlog\n(\nresult\n.\npayload\n.\nmessage\n)\n}\nsend\n#\n向钱包发送消息的方法：\nsend\n(\nmessage\n:\nAppRequest\n)\n:\nPromise\n<\nWalletResponse\n>\n;\n入参\n#\nmessage\n：发送给钱包的消息体\nmessage 入参\ninterface\nAppRequest\n{\nmethod\n:\nstring\n;\nparams\n:\nstring\n[\n]\n;\nid\n:\nstring\n;\n}\nmethod\n：消息的名称，目前支持\nsendTransaction\n和\ndisconnect\nparams\n：消息的参数\nid\n：递增的标识符，允许匹配请求和响应\nsendTransaction 消息\n#\n用于签署并广播交易。\n入参：\ninterface\nSendTransactionRequest\n{\nmethod\n:\n'sendTransaction'\n;\nparams\n:\n[\n<\ntransaction\n-\npayload\n>\n]\n;\nid\n:\nstring\n;\n}\n其中\n<transaction-payload>\n是具有以下属性的 JSON：\nvalid_until\n（整数，可选）：unix 时间戳。该时刻之后交易将无效。\nnetwork\n（NETWORK，可选）：目前仅支持主网\nfrom\n（以 wc:hex 格式的字符串，可选）- DApp打算从中发送交易的发送者地址。\nmessages\n（信息数组）：1-4 条从钱包合约到其他账户的输出消息。所有消息按顺序发送出去，但钱包无法保证消息会按相同顺序被传递和执行。\n消息结构：\naddress\n（字符串）：消息目的地\namount\n（小数字符串）：要发送的纳币数量。\npayload\n（base64 编码的字符串，可选）：以 Base64 编码的原始cell BoC。\nstateInit\n（base64 编码的字符串，可选）：以 Base64 编码的原始cell BoC。\n示例：\n{\n\"valid_until\"\n:\n1658253458\n,\n\"network\"\n:\n\"-239\"\n,\n\"from\"\n:\n\"0:348bcf827469c5fc38541c77fdd91d4e347eac200f6f2d9fd62dc08885f0415f\"\n,\n\"messages\"\n:\n[\n{\n\"address\"\n:\n\"0:412410771DA82CBA306A55FA9E0D43C9D245E38133CB58F1457DFB8D5CD8892F\"\n,\n\"amount\"\n:\n\"20000000\"\n,\n\"stateInit\"\n:\n\"base64bocblahblahblah==\"\n// 部署合约\n}\n,\n{\n\"address\"\n:\n\"0:E69F10CC84877ABF539F83F879291E5CA169451BA7BCE91A37A5CED3AB8080D3\"\n,\n\"amount\"\n:\n\"60000000\"\n,\n\"payload\"\n:\n\"base64bocblahblahblah==\"\n// 将 nft 转移至新部署的账户 0:412410771DA82CBA306A55FA9E0D43C9D245E38133CB58F1457DFB8D5CD8892F\n}\n]\n}\n返回值：\ntype\nSendTransactionResponse\n=\nSendTransactionResponseSuccess\n|\nSendTransactionResponseError\n;\ninterface\nSendTransactionResponseSuccess\n{\nresult\n:\n<\nboc\n>\n;\nid\n:\nstring\n;\n}\ninterface\nSendTransactionResponseError\n{\nerror\n:\n{\ncode\n:\nnumber\n;\nmessage\n:\nstring\n}\n;\nid\n:\nstring\n;\n}\n其中\nresult\n是签名后的签名串。\ndisconnect 消息\n#\n用于断开钱包连接。\n入参：\ninterface\nDisconnectRequest\n{\nmethod\n:\n'disconnect'\n;\nparams\n:\n[\n]\n;\nid\n:\nstring\n;\n}\n返回值：\ntype\nDisconnectResponse\n=\nDisconnectResponseSuccess\n|\nDisconnectResponseError\n;\ninterface\nDisconnectResponseSuccess\n{\nresult\n:\n{\n}\n;\nid\n:\nstring\n;\n}\ninterface\nDisconnectResponseError\n{\nerror\n:\n{\ncode\n:\nnumber\n;\nmessage\n:\nstring\n}\n;\nid\n:\nstring\n;\n}\nlisten\n#\n监听钱包事件的方法。\nlisten\n(\ncallback\n:\n(\nevent\n:\nWalletEvent\n)\n=>\nvoid\n)\n:\n(\n)\n=>\nvoid\n;\n入参\n#\ncallback\n：事件监听的回调函数\ninterface\nWalletEvent\n{\nevent\n:\nWalletEventName\n;\nid\n:\nnumber\n;\n// 递增的事件计数器\npayload\n:\n<\nevent\n-\npayload\n>\n;\n// 每个事件特定的载荷\n}\ntype\nWalletEventName\n=\n'connect'\n|\n'connect_error'\n|\n'disconnect'\n;\n返回值\n#\n返回一个函数，用于取消监听。\non / off\n#\n这是专属于 OKX Wallet 的非标准 API，设计该 API 主要是为了支持 accountChanged 事件，可以让 Dapp 响应插件内的钱包切换\n添加/移除事件监听，目前支持的事件有：\nconnect\n: 钱包已连接的事件\ndisconnect\n：当用户断开连接时会触发该事件\naccountChanged\n：当用户切换账户时会触发该事件\nconst\naccountChanged\n=\n(\n)\n=>\n{\n}\nwindow\n.\nokxTonWallet\n.\ntonconnect\n.\non\n(\n'accountChanged'\n,\naccountChanged\n)\nwindow\n.\nokxTonWallet\n.\ntonconnect\n.\noff\n(\n'accountChanged'\n,\naccountChanged\n)",
  "html": "<div class=\"routes_md__xWlGF\"><!--$--><h1 id=\"provider-api\">Provider API<a class=\"index_header-anchor__Xqb+L\" href=\"#provider-api\" style=\"opacity:0\">#</a></h1>\n<h2 data-content=\"什么是 Injected provider API？\" id=\"什么是-injected-provider-api？\">什么是 Injected provider API？<a class=\"index_header-anchor__Xqb+L\" href=\"#什么是-injected-provider-api？\" style=\"opacity:0\">#</a></h2>\n<p>欧易 Injected providers API 是一个 JavaScript API，欧易将其注入用户访问的网站。您的 DApp 可以使用此 API 请求用户帐户，从用户连接的区块链读取数据，帮助用户签署消息和交易。</p>\n<h2 data-content=\"特别说明\" id=\"特别说明\">特别说明<a class=\"index_header-anchor__Xqb+L\" href=\"#特别说明\" style=\"opacity:0\">#</a></h2>\n<p>OKX Wallet 的 TON API 完全符合 <a class=\"items-center\" href=\"https://docs.ton.org/mandarin/develop/dapps/ton-connect/protocol/\" rel=\"nofollow noreferrer\" style=\"display:inline-flex;line-height:16px\" target=\"_blank\">Ton Connect 协议<i aria-hidden=\"true\" class=\"icon iconfont doc-ssr-okds-open-link\" role=\"img\" style=\"font-size:24px;color:#0569FF;margin-left:2px\"></i></a> 的规范。</p>\n<p>Dapp 可以使用 <a class=\"items-center\" href=\"https://docs.ton.org/mandarin/develop/dapps/ton-connect/developers\" rel=\"nofollow noreferrer\" style=\"display:inline-flex;line-height:16px\" target=\"_blank\">TON Connect SDK<i aria-hidden=\"true\" class=\"icon iconfont doc-ssr-okds-open-link\" role=\"img\" style=\"font-size:24px;color:#0569FF;margin-left:2px\"></i></a> 来更方便地接入 OKX Wallet 。</p>\n<h2 data-content=\"获取注入的对象\" id=\"获取注入的对象\">获取注入的对象<a class=\"index_header-anchor__Xqb+L\" href=\"#获取注入的对象\" style=\"opacity:0\">#</a></h2>\n<p>OKX Wallet 按照 TON Connect 协议的规范向 Dapp 中注入如下属性：</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">okxTonWallet</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tonconnect</span>\n</code></pre></div>\n<p>其指向的对象的数据结构如下：</p>\n<div class=\"remark-highlight\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">TonConnectBridge</span> <span class=\"token punctuation\">{</span>\n    deviceInfo<span class=\"token operator\">:</span> DeviceInfo<span class=\"token punctuation\">;</span>\n    walletInfo<span class=\"token operator\">?</span><span class=\"token operator\">:</span> WalletInfo<span class=\"token punctuation\">;</span>\n    protocolVersion<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>protocolVersion<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> message<span class=\"token operator\">:</span> ConnectRequest<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>ConnectEvent<span class=\"token operator\">&gt;</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">restoreConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>ConnectEvent<span class=\"token operator\">&gt;</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">send</span><span class=\"token punctuation\">(</span>message<span class=\"token operator\">:</span> AppRequest<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>WalletResponse<span class=\"token operator\">&gt;</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> WalletEvent<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2 data-content=\"deviceInfo\" id=\"deviceinfo\">deviceInfo<a class=\"index_header-anchor__Xqb+L\" href=\"#deviceinfo\" style=\"opacity:0\">#</a></h2>\n<p>用于获取设备信息，数据结构如下：</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">platform</span><span class=\"token operator\">:</span> <span class=\"token string\">'browser'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">appName</span><span class=\"token operator\">:</span> <span class=\"token string\">'OKX Wallet'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">appVersion</span><span class=\"token operator\">:</span> <span class=\"token string\">'3.3.19'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">maxProtocolVersion</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">features</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">'SendTransaction'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'SendTransaction'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">maxMessages</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<ul>\n<li><code>platform</code>：设备平台</li>\n<li><code>appName</code>：钱包名称</li>\n<li><code>appVersion</code>：钱包版本</li>\n<li><code>maxProtocolVersion</code>：支持的最大协议版本</li>\n<li><code>features</code>：钱包支持的特性</li>\n</ul>\n<h2 data-content=\"walletInfo\" id=\"walletinfo\">walletInfo<a class=\"index_header-anchor__Xqb+L\" href=\"#walletinfo\" style=\"opacity:0\">#</a></h2>\n<p>用于获取钱包信息，数据结构如下：</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'OKX Wallet'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">app_name</span><span class=\"token operator\">:</span> <span class=\"token string\">'okxTonWallet'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">image</span><span class=\"token operator\">:</span> <span class=\"token string\">'https://static.okx.com/cdn/assets/imgs/247/58E63FEA47A2B7D7.png'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">about_url</span><span class=\"token operator\">:</span> <span class=\"token string\">'https://web3.okx.com/web3'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">platforms</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'chrome'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'firefox'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'safari'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<ul>\n<li><code>name</code>：钱包名称</li>\n<li><code>app_name</code>：钱包应用唯一标识</li>\n<li><code>image</code>：钱包图标</li>\n<li><code>about_url</code>：钱包介绍页面</li>\n<li><code>platforms</code>：钱包支持的平台</li>\n</ul>\n<h2 data-content=\"protocolVersion\" id=\"protocolversion\">protocolVersion<a class=\"index_header-anchor__Xqb+L\" href=\"#protocolversion\" style=\"opacity:0\">#</a></h2>\n<p>OKX Wallet 支持的 Ton Connect 的版本，目前为 2 。</p>\n<h2 data-content=\"connect\" id=\"connect\">connect<a class=\"index_header-anchor__Xqb+L\" href=\"#connect\" style=\"opacity:0\">#</a></h2>\n<p>连接钱包的方法，连接钱包时，也可以对钱包进行签名验证。</p>\n<div class=\"remark-highlight\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>protocolVersion<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> message<span class=\"token operator\">:</span> ConnectRequest<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>ConnectEvent<span class=\"token operator\">&gt;</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3 id=\"入参\">入参<a class=\"index_header-anchor__Xqb+L\" href=\"#入参\" style=\"opacity:0\">#</a></h3>\n<ul>\n<li><code>protocolVersion</code>：Dapp 期望钱包支持的 Ton Connect 的版本，如果钱包暂未支持该版本，会直接返回错误</li>\n<li><code>message</code>: 连接钱包的请求信息</li>\n</ul>\n<p><strong>message 入参</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">ConnectRequest</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  manifestUrl<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  items<span class=\"token operator\">:</span> ConnectItem<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 与应用共享的数据项</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">ConnectItem</span> <span class=\"token operator\">=</span> TonAddressItem <span class=\"token operator\">|</span> TonProofItem\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">TonAddressItem</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> <span class=\"token string\">\"ton_addr\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">TonProofItem</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> <span class=\"token string\">\"ton_proof\"</span><span class=\"token punctuation\">;</span>\n  payload<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 任意载荷，例如 nonce + 过期时间戳。</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<ul>\n<li><code>manifestUrl</code>：Dapp 的 manifest.json 文件的 URL，该文件中包含 Dapp 的元信息，数据结构如下：<!-- -->\n<div class=\"remark-highlight\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;app-url&gt;\"</span><span class=\"token punctuation\">,</span>                        <span class=\"token comment\">// 必填</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;app-name&gt;\"</span><span class=\"token punctuation\">,</span>                      <span class=\"token comment\">// 必填</span>\n      <span class=\"token property\">\"iconUrl\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;app-icon-url&gt;\"</span><span class=\"token punctuation\">,</span>               <span class=\"token comment\">// 必填</span>\n      <span class=\"token property\">\"termsOfUseUrl\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;terms-of-use-url&gt;\"</span><span class=\"token punctuation\">,</span>     <span class=\"token comment\">// 可选</span>\n      <span class=\"token property\">\"privacyPolicyUrl\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;privacy-policy-url&gt;\"</span> <span class=\"token comment\">// 可选</span>\n    <span class=\"token punctuation\">}</span>\n</code></pre></div>\n</li>\n<li><code>items</code>：请求钱包的指令列表，目前支持两个指令：<!-- -->\n<ul>\n<li><code>ton_addr</code>：获取用户的地址、公钥等信息</li>\n<li><code>ton_proof</code>：对钱包进行签名验证</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"返回值\">返回值<a class=\"index_header-anchor__Xqb+L\" href=\"#返回值\" style=\"opacity:0\">#</a></h3>\n<p>返回一个 Promise 对象，Promise 对象的结果为 <code>ConnectEvent</code>，数据结构如下：</p>\n<div class=\"remark-highlight\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">ConnectEvent</span> <span class=\"token operator\">=</span> ConnectEventSuccess <span class=\"token operator\">|</span> ConnectEventError<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">ConnectEventSuccess</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  event<span class=\"token operator\">:</span> <span class=\"token string\">\"connect\"</span><span class=\"token punctuation\">;</span>\n  id<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 递增的事件计数器</span>\n  payload<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      items<span class=\"token operator\">:</span> ConnectItemReply<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      device<span class=\"token operator\">:</span> DeviceInfo<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">ConnectEventError</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  event<span class=\"token operator\">:</span> <span class=\"token string\">\"connect_error\"</span><span class=\"token punctuation\">,</span>\n  id<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 递增的事件计数器</span>\n  payload<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      code<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n      message<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 与 window.okxTonWallet.tonconnect 对象上的 deviceInfo 完全相同</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">DeviceInfo</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  platform<span class=\"token operator\">:</span> <span class=\"token string\">\"iphone\"</span> <span class=\"token operator\">|</span> <span class=\"token string\">\"ipad\"</span> <span class=\"token operator\">|</span> <span class=\"token string\">\"android\"</span> <span class=\"token operator\">|</span> <span class=\"token string\">\"windows\"</span> <span class=\"token operator\">|</span> <span class=\"token string\">\"mac\"</span> <span class=\"token operator\">|</span> <span class=\"token string\">\"linux\"</span><span class=\"token punctuation\">;</span>\n  appName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  appVersion<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  maxProtocolVersion<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  features<span class=\"token operator\">:</span> Feature<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">Feature</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'SendTransaction'</span><span class=\"token punctuation\">,</span> maxMessages<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">}</span> <span class=\"token comment\">// `maxMessages` 是钱包支持的一次 `SendTransaction` 中的最大消息数</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">ConnectItemReply</span> <span class=\"token operator\">=</span> TonAddressItemReply <span class=\"token operator\">|</span> TonProofItemReply<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 由钱包返回的不受信任的数据。</span>\n<span class=\"token comment\">// 如果您需要保证用户拥有此地址和公钥，您需要额外请求 ton_proof。</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">TonAddressItemReply</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> <span class=\"token string\">\"ton_addr\"</span><span class=\"token punctuation\">;</span>\n  address<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// TON 地址原始 (`0:&lt;hex&gt;`)</span>\n  network<span class=\"token operator\">:</span> <span class=\"token constant\">NETWORK</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 网络 global_id</span>\n  publicKey<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// HEX 字符串，不带 0x</span>\n  walletStateInit<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Base64（不安全 URL）编码的钱包合约的 stateinit cell</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">TonProofItemReply</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> <span class=\"token string\">\"ton_proof\"</span><span class=\"token punctuation\">;</span>\n  proof<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    timestamp<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 签名操作的 64 位 unix epoch 时间（秒）</span>\n    domain<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      lengthBytes<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// AppDomain 长度</span>\n      value<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 应用域名（作为 url 部分，无编码）</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    signature<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// base64 编码的签名</span>\n    payload<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 请求中的载荷</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 目前仅支持主网</span>\n<span class=\"token keyword\">enum</span> <span class=\"token constant\">NETWORK</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token constant\">MAINNET</span> <span class=\"token operator\">=</span> <span class=\"token string\">'-239'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">TESTNET</span> <span class=\"token operator\">=</span> <span class=\"token string\">'-3'</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h3 id=\"示例\">示例<a class=\"index_header-anchor__Xqb+L\" href=\"#示例\" style=\"opacity:0\">#</a></h3>\n<p>只是获取用户的地址、公钥等信息：</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">okxTonWallet</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tonconnect</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">connect</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">manifestUrl</span><span class=\"token operator\">:</span> <span class=\"token string\">'https://example.com/manifest.json'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">items</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'ton_addr'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span><span class=\"token property-access\">event</span> <span class=\"token operator\">===</span> <span class=\"token string\">'connect'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span><span class=\"token property-access\">payload</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">items</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">address</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span><span class=\"token property-access\">payload</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">message</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>获取用户地址、公钥等信息，同时对钱包进行签名验证：</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">okxTonWallet</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tonconnect</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">connect</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">manifestUrl</span><span class=\"token operator\">:</span> <span class=\"token string\">'https://example.com/manifest.json'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">items</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'ton_addr'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'ton_proof'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">payload</span><span class=\"token operator\">:</span> <span class=\"token string\">'123'</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword control-flow\">if</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span><span class=\"token property-access\">event</span> <span class=\"token operator\">===</span> <span class=\"token string\">'connect'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span><span class=\"token property-access\">payload</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">items</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">address</span><span class=\"token punctuation\">)</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span><span class=\"token property-access\">payload</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">items</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">proof</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span><span class=\"token property-access\">payload</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">message</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2 data-content=\"restoreConnection\" id=\"restoreconnection\">restoreConnection<a class=\"index_header-anchor__Xqb+L\" href=\"#restoreconnection\" style=\"opacity:0\">#</a></h2>\n<p>恢复连接的方法，只会返回 <code>ton_addr</code> 指令的结果，如果无法连接钱包，则返回错误。</p>\n<div class=\"remark-highlight\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token function\">restoreConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>ConnectEvent<span class=\"token operator\">&gt;</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3 id=\"示例\">示例<a class=\"index_header-anchor__Xqb+L\" href=\"#示例\" style=\"opacity:0\">#</a></h3>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">okxTonWallet</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tonconnect</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">restoreConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword control-flow\">if</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span><span class=\"token property-access\">event</span> <span class=\"token operator\">===</span> <span class=\"token string\">'connect'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span><span class=\"token property-access\">payload</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">items</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">address</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span><span class=\"token property-access\">payload</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">message</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2 data-content=\"send\" id=\"send\">send<a class=\"index_header-anchor__Xqb+L\" href=\"#send\" style=\"opacity:0\">#</a></h2>\n<p>向钱包发送消息的方法：</p>\n<div class=\"remark-highlight\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>message<span class=\"token operator\">:</span> AppRequest<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>WalletResponse<span class=\"token operator\">&gt;</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3 id=\"入参\">入参<a class=\"index_header-anchor__Xqb+L\" href=\"#入参\" style=\"opacity:0\">#</a></h3>\n<ul>\n<li><code>message</code>：发送给钱包的消息体</li>\n</ul>\n<p><strong>message 入参</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">AppRequest</span> <span class=\"token punctuation\">{</span>\n    method<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n    params<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<ul>\n<li><code>method</code>：消息的名称，目前支持 <code>sendTransaction</code> 和 <code>disconnect</code></li>\n<li><code>params</code>：消息的参数</li>\n<li><code>id</code>：递增的标识符，允许匹配请求和响应</li>\n</ul>\n<h3 id=\"sendtransaction-消息\">sendTransaction 消息<a class=\"index_header-anchor__Xqb+L\" href=\"#sendtransaction-消息\" style=\"opacity:0\">#</a></h3>\n<p>用于签署并广播交易。</p>\n<p><strong>入参：</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">SendTransactionRequest</span> <span class=\"token punctuation\">{</span>\n    method<span class=\"token operator\">:</span> <span class=\"token string\">'sendTransaction'</span><span class=\"token punctuation\">;</span>\n    params<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span>transaction<span class=\"token operator\">-</span>payload<span class=\"token operator\">&gt;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>其中 <code>&lt;transaction-payload&gt;</code> 是具有以下属性的 JSON：</p>\n<ul>\n<li><code>valid_until</code>（整数，可选）：unix 时间戳。该时刻之后交易将无效。</li>\n<li><code>network</code>（NETWORK，可选）：目前仅支持主网</li>\n<li><code>from</code>（以 wc:hex 格式的字符串，可选）- DApp打算从中发送交易的发送者地址。</li>\n<li><code>messages</code>（信息数组）：1-4 条从钱包合约到其他账户的输出消息。所有消息按顺序发送出去，但钱包无法保证消息会按相同顺序被传递和执行。</li>\n</ul>\n<p>消息结构：</p>\n<ul>\n<li><code>address</code>（字符串）：消息目的地</li>\n<li><code>amount</code>（小数字符串）：要发送的纳币数量。</li>\n<li><code>payload</code>（base64 编码的字符串，可选）：以 Base64 编码的原始cell BoC。</li>\n<li><code>stateInit</code>（base64 编码的字符串，可选）：以 Base64 编码的原始cell BoC。</li>\n</ul>\n<p>示例：</p>\n<div class=\"remark-highlight\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"valid_until\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1658253458</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"network\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"-239\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"from\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0:348bcf827469c5fc38541c77fdd91d4e347eac200f6f2d9fd62dc08885f0415f\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"messages\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"address\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0:412410771DA82CBA306A55FA9E0D43C9D245E38133CB58F1457DFB8D5CD8892F\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"amount\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"20000000\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"stateInit\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"base64bocblahblahblah==\"</span> <span class=\"token comment\">// 部署合约</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"address\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0:E69F10CC84877ABF539F83F879291E5CA169451BA7BCE91A37A5CED3AB8080D3\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"amount\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"60000000\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"payload\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"base64bocblahblahblah==\"</span> <span class=\"token comment\">// 将 nft 转移至新部署的账户 0:412410771DA82CBA306A55FA9E0D43C9D245E38133CB58F1457DFB8D5CD8892F</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><strong>返回值：</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">SendTransactionResponse</span> <span class=\"token operator\">=</span> SendTransactionResponseSuccess <span class=\"token operator\">|</span> SendTransactionResponseError<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">SendTransactionResponseSuccess</span> <span class=\"token punctuation\">{</span>\n    result<span class=\"token operator\">:</span> <span class=\"token operator\">&lt;</span>boc<span class=\"token operator\">&gt;</span><span class=\"token punctuation\">;</span>\n    id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">SendTransactionResponseError</span> <span class=\"token punctuation\">{</span>\n   error<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> code<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span> message<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n   id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>其中 <code>result</code> 是签名后的签名串。</p>\n<h3 id=\"disconnect-消息\">disconnect 消息<a class=\"index_header-anchor__Xqb+L\" href=\"#disconnect-消息\" style=\"opacity:0\">#</a></h3>\n<p>用于断开钱包连接。</p>\n<p><strong>入参：</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">DisconnectRequest</span> <span class=\"token punctuation\">{</span>\n    method<span class=\"token operator\">:</span> <span class=\"token string\">'disconnect'</span><span class=\"token punctuation\">;</span>\n    params<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><strong>返回值：</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">DisconnectResponse</span> <span class=\"token operator\">=</span> DisconnectResponseSuccess <span class=\"token operator\">|</span> DisconnectResponseError<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">DisconnectResponseSuccess</span> <span class=\"token punctuation\">{</span>\n    result<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">DisconnectResponseError</span> <span class=\"token punctuation\">{</span>\n   error<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> code<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span> message<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n   id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2 data-content=\"listen\" id=\"listen\">listen<a class=\"index_header-anchor__Xqb+L\" href=\"#listen\" style=\"opacity:0\">#</a></h2>\n<p>监听钱包事件的方法。</p>\n<div class=\"remark-highlight\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> WalletEvent<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3 id=\"入参\">入参<a class=\"index_header-anchor__Xqb+L\" href=\"#入参\" style=\"opacity:0\">#</a></h3>\n<ul>\n<li><code>callback</code>：事件监听的回调函数</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">WalletEvent</span> <span class=\"token punctuation\">{</span>\n    event<span class=\"token operator\">:</span> WalletEventName<span class=\"token punctuation\">;</span>\n    id<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 递增的事件计数器</span>\n    payload<span class=\"token operator\">:</span> <span class=\"token operator\">&lt;</span>event<span class=\"token operator\">-</span>payload<span class=\"token operator\">&gt;</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 每个事件特定的载荷</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">WalletEventName</span> <span class=\"token operator\">=</span> <span class=\"token string\">'connect'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'connect_error'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'disconnect'</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3 id=\"返回值\">返回值<a class=\"index_header-anchor__Xqb+L\" href=\"#返回值\" style=\"opacity:0\">#</a></h3>\n<p>返回一个函数，用于取消监听。</p>\n<h2 data-content=\"on / off\" id=\"on-/-off\">on / off<a class=\"index_header-anchor__Xqb+L\" href=\"#on-/-off\" style=\"opacity:0\">#</a></h2>\n<div class=\"index_wrapper__x5A2Q\"><div aria-labelledby=\":R4tbf:\" class=\"okui-alert info-alert\"><i aria-hidden=\"true\" class=\"icon iconfont okui-alert-icon doc-ssr-okds-information-circle-fill\" role=\"img\"></i><div class=\"okui-alert-msg-box\"><div class=\"okui-alert-title\" id=\":R4tbf:\">这是专属于 OKX Wallet 的非标准 API，设计该 API 主要是为了支持 accountChanged 事件，可以让 Dapp 响应插件内的钱包切换</div><div class=\"okui-alert-desc\"><div class=\"index_desc__5fNBE\"></div></div></div></div></div>\n<p>添加/移除事件监听，目前支持的事件有：</p>\n<ul>\n<li><code>connect</code>: 钱包已连接的事件</li>\n<li><code>disconnect</code>：当用户断开连接时会触发该事件</li>\n<li><code>accountChanged</code>：当用户切换账户时会触发该事件</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">accountChanged</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">okxTonWallet</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tonconnect</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'accountChanged'</span><span class=\"token punctuation\">,</span> accountChanged<span class=\"token punctuation\">)</span>\n<span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">okxTonWallet</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tonconnect</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">off</span><span class=\"token punctuation\">(</span><span class=\"token string\">'accountChanged'</span><span class=\"token punctuation\">,</span> accountChanged<span class=\"token punctuation\">)</span>\n</code></pre></div><!--/$--></div>",
  "url": "https://web3.okx.com/zh-hans/build/dev-docs/sdks/chains/ton/provider#deviceinfo",
  "navigation": {
    "breadcrumbs": [
      "DApp 连接钱包",
      "TON",
      "Provider API"
    ],
    "sidebar_links": [
      "什么是连接钱包",
      "支持的网络",
      "接入前提",
      "EVM 兼容链",
      "Bitcoin 兼容链",
      "Solana 兼容链",
      "TON",
      "SUI",
      "Aptos/Movement",
      "Cosmos 系/Sei",
      "Tron",
      "Starknet",
      "常见问题",
      "接入前提",
      "EVM 兼容链",
      "Bitcoin 兼容链",
      "Tron",
      "Solana 兼容链",
      "TON",
      "Provider API"
    ],
    "toc": [
      "什么是 Injected provider API？",
      "特别说明",
      "获取注入的对象",
      "deviceInfo",
      "walletInfo",
      "protocolVersion",
      "connect",
      "restoreConnection",
      "send",
      "listen",
      "on / off"
    ]
  },
  "word_count": 1229,
  "extract_time": "2025-05-27 07:33:05"
}