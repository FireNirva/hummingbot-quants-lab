{
  "title": "Provider API | sui | 连接浏览器插件钱包 | 接入 Web3 钱包 | DEX API 文档 | 欧易",
  "text": "Provider API\n#\n什么是 Injected provider API？\n#\n欧易 Injected providers API 是一个 JavaScript API，欧易将其注入用户访问的网站。您的 DApp 可以使用此 API 请求用户帐户，从用户连接的区块链读取数据，帮助用户签署消息和交易。\n获取 wallet 对象\n#\nSui 钱包使用的是 wallet standard，相比其他异构链有些不同，可以通过事件通知的方式获取 wallet 对象：\nconst\nGlobalWallet\n=\n{\nregister\n:\n(\nwallet\n)\n=>\n{\nGlobalWallet\n[\nwallet\n.\nchainName\n]\n=\nwallet\n}\n}\nconst\nevent\n=\nnew\nCustomEvent\n(\n'wallet-standard:app-ready'\n,\n{\ndetail\n:\nGlobalWallet\n}\n)\n;\nwindow\n.\ndispatchEvent\n(\nevent\n)\n;\nconst\nsuiWallet\n=\nGlobalWallet\n.\nsuiMainnet\n获取账户\n#\n通过以上获取到的 suiWallet 对象，可以获取到账户：\nconst\nsuiAccounts\n=\nsuiWallet\n.\nconnectedAccounts\n// suiAccounts 结构:\n[\n{\n\"address\"\n:\n\"0x7995ca23961fe06d8cea7da58ca751567ce820d7cba77b4a373249034eecca4a\"\n,\n\"publicKey\"\n:\n\"tUvCYrG22rHKR0c306MxgnhXOSf16Ot6H3GMO7btwDI=\"\n,\n\"chains\"\n:\n[\n\"sui:mainnet\"\n]\n,\n\"features\"\n:\n[\n\"sui:signAndExecuteTransactionBlock\"\n,\n\"sui:signTransactionBlock\"\n,\n\"sui:signMessage\"\n]\n}\n]\n第一笔交易\n#\nsuiWallet.features['sui:signAndExecuteTransactionBlock'].signAndExecuteTransactionBlock\n签名并发送交易\nSui 钱包使用的是 wallet standard，相比其他异构链有些不同，所有方法都挂在 features[] 里\n创建交易后，Web 应用程序可能会要求用户的欧易 Web3 钱包签署并发送交易。如果接受，欧易 Web3 钱包将使用用户的私钥签署交易并通过\nSUI JSON RPC\n连接提交。在\nsuiWallet\n上调用\nsignAndExecuteTransactionBlock\n方法会为已签名的交易返回\npromise\n。\nconst\nhandleTransaction\n=\nasync\n(\n)\n=>\n{\nconst\ntx\n=\nnew\nTransactionBlock\n(\n)\ntx\n.\nmoveCall\n(\n{\ntarget\n:\n`\n${\npackageId\n}\n::\n${\nmoduleName\n}\n::\n${\nfunctionName\n}\n`\n,\narguments\n:\n[\ntx\n.\npure\n(\nparams1\n)\n,\ntx\n.\npure\n(\nparams2\n)\n,\n]\n,\ntypeArguments\n:\n[\n]\n,\n}\n)\nconst\nresult\n=\nawait\nsuiWallet\n.\nfeatures\n[\n'sui:signAndExecuteTransactionBlock'\n]\n.\nsignAndExecuteTransactionBlock\n(\n{\ntransactionBlock\n:\ntx\n,\noptions\n:\n{\nshowEffects\n:\ntrue\n}\n,\n}\n)\nconsole\n.\nlog\n(\n'result'\n,\nresult\n)\n// 通过result?.effects?.status?.status获取交易状态，成功为 'success'，失败为'failure'\n}\n拆币\n在发交易时，付 gas 费的 objectId，如果这个 object 本身就要被发送，还要用来付 gas 费，这时候就需要用到拆币(split coin)\nconst\nhandleTransaction\n=\nasync\n(\n)\n=>\n{\nconst\ntx\n=\nnew\nTransactionBlock\n(\n)\nconst\nvalue\n=\n'300000000'\n// 这里是想要拆出的目标值\nconst\n[\ncoins\n]\n=\ntx\n.\nsplitCoins\n(\ntx\n.\ngas\n,\n[\ntx\n.\npure\n(\nBigInt\n(\nvalue\n)\n)\n,\n]\n)\ntx\n.\nmoveCall\n(\n{\ntarget\n:\n`\n${\npackageId\n}\n::\n${\nmoduleName\n}\n::\n${\nfunctionName\n}\n`\n,\narguments\n:\n[\ntx\n.\npure\n(\n参数\n1\n)\n,\ntx\n.\npure\n(\n参数\n2\n)\n,\ntx\n.\nmakeMoveVec\n(\n{\nobjects\n:\n[\ncoins\n]\n}\n)\n,\n]\n,\ntypeArguments\n:\n[\n]\n,\n}\n)\nconst\nresult\n=\nawait\nsuiWallet\n.\nfeatures\n[\n'sui:signAndExecuteTransactionBlock'\n]\n.\nsignAndExecuteTransactionBlock\n(\n{\ntransactionBlock\n:\ntx\n,\noptions\n:\n{\nshowEffects\n:\ntrue\n}\n,\n}\n)\nconsole\n.\nlog\n(\n'result'\n,\nresult\n)\n// 通过result?.effects?.status?.status获取交易状态，成功为 'success'，失败为'failure'\n}\n对交易块进行签名\n通过\nprovider\n上的\nsignTransactionBlock\n方法可以签署一个交易块(多个交易的集合)。\nconst\ntx\n=\nnew\nTransactionBlock\n(\n)\n;\ntx\n.\nmoveCall\n(\n{\ntarget\n:\n'xxx'\n,\narguments\n:\n[\ntx\n.\npure\n(\n'okx'\n)\n,\ntx\n.\npure\n(\n'wallet'\n)\n,\n]\n,\n}\n)\n;\nconst\ninput\n=\n{\ntransactionBlockSerialized\n:\ntx\n.\nserialize\n(\n)\n,\noptions\n:\n{\nshowEffects\n:\ntrue\n,\n}\n}\nl\nconst\ntransaction\n=\nawait\nsuiWallet\n.\nfeatures\n[\n'sui:signTransactionBlock'\n]\n.\nsignTransactionBlock\n(\n{\ntransactionBlock\n:\ntx\n}\n)\n签名信息\n#\n对单个交易签名（不发送）\n创建交易后，Web 应用程序可能会要求用户的欧易 Web3 钱包签署交易，而无需将其提交到网络。调用\nsignMessage\n方法会为已签名的交易返回\nPromise\n。\nimport\n{\nethers\n}\nfrom\n'ethers'\n;\n// 这里借用 ethers 库来帮我们处理 message，将其转为 Uint8Array 类型\nconst\nmessage\n=\nethers\n.\nutils\n.\ntoUtf8Bytes\n(\n'okx'\n)\nconst\n{\nsignature\n,\nmessageBytes\n}\n=\nawait\nsuiWallet\n.\nfeatures\n[\n'sui:signMessage'\n]\n.\nsignMessage\n(\n{\nmessage\n}\n)\n错误码\n#\n错误码\n标题\n描述\n4900\n断开连接\nOKX Wallet could not connect to the network.\n4100\n未授权\nThe requested method and/or account has not been authorized by the user.\n4001\n用户拒绝请求\nThe user rejected the request through OKX wallet.\n-32000\n无效输入\nMissing or invalid parameters.\n-32002\n请求资源不可用\nThis error occurs when a dapp attempts to submit a new transaction while OKX wallet's approval dialog is already open for a previous transaction. Only one approve window can be open at a time. Users should approve or reject their transaction before initiating a new transaction.\n-32003\n拒绝交易\nOKX Wallet does not recognize a valid transaction.\n-32601\n未找到方法\nOKX Wallet does not recognize the method.\n-32603\n内部错误\nSomething went wrong within OKX wallet.\n连接账户\n#\nsuiWallet.features['standard:connect'].connect()\n描述\n连接到欧易 Web3 钱包可以通过调用\nsuiWallet.features['standard:connect'].connect()\n。\nconnect\n调用将返回一个\nPromise\n对象，该\nPromise\n对象在用户接受连接请求时\nresolve\n，并在用户拒绝请求或关闭弹出窗口时\nreject\n。有关欧易 Web3 钱包可能发生错误的详细信息，请参考\n错误码\n。\n当用户接受连接请求时，\nsuiWallet.features['standard:events']\n也会触发连接事件。\nsuiWallet\n.\nfeatures\n[\n'standard:events'\n]\n.\non\n(\n\"connect\"\n,\n(\n)\n=>\nconsole\n.\nlog\n(\n\"connected!\"\n)\n)\n;\n一旦 Web 应用程序连接到欧易 Web3 钱包，它将能够读取连接账户的公钥并提示用户进行其他交易。\n例子\n在\ncodeopen\n中打开。\n事件\n#\n成功连接\n连接到欧易 Web3 钱包可以通过调用\nsuiWallet.features['standard:events'].on\n。 当用户接受连接请求时，会触发连接事件。\n用法\nsuiWallet\n.\nfeatures\n[\n'standard:events'\n]\n.\non\n(\n\"connect\"\n,\n(\n)\n=>\nconsole\n.\nlog\n(\n\"connected!\"\n)\n)\n;\n断开连接\n断开连接与连接过程相同。但是，钱包也有可能发起断开连接，而不是应用程序本身。\n用法\nsuiWallet\n.\nfeatures\n[\n'standard:events'\n]\n.\non\n(\n\"disconnect\"\n,\n(\n)\n=>\n{\nconsole\n.\nlog\n(\n\"disconnected!\"\n)\n}\n)\n;\n账户变更\n欧易 Web3 钱包允许用户从单个扩展程序或移动应用程序中无缝管理多个账户。每当用户切换账户时，欧易 Web3 钱包都会发出一个\naccountChanged\n事件。\n如果用户在已连接到应用程序时更改账户，并且新账户已经将该应用程序列入白名单，那么用户将保持连接状态并且欧易 Web3 钱包将传递新账户的公钥：\n用法\nsuiWallet\n.\nfeatures\n[\n'standard:events'\n]\n.\non\n(\n'accountChanged'\n,\n(\npublicKey\n)\n=>\n{\nif\n(\npublicKey\n)\n{\nconsole\n.\nlog\n(\n`\nSwitched to account\n${\npublicKey\n.\ntoBase58\n(\n)\n}\n`\n)\n;\n}\n}\n)\n;",
  "html": "<div class=\"routes_md__xWlGF\"><!--$--><h1 id=\"provider-api\">Provider API<a class=\"index_header-anchor__Xqb+L\" href=\"#provider-api\" style=\"opacity:0\">#</a></h1>\n<h2 data-content=\"什么是 Injected provider API？\" id=\"什么是-injected-provider-api？\">什么是 Injected provider API？<a class=\"index_header-anchor__Xqb+L\" href=\"#什么是-injected-provider-api？\" style=\"opacity:0\">#</a></h2>\n<p>欧易 Injected providers API 是一个 JavaScript API，欧易将其注入用户访问的网站。您的 DApp 可以使用此 API 请求用户帐户，从用户连接的区块链读取数据，帮助用户签署消息和交易。</p>\n<h2 data-content=\"获取 wallet 对象\" id=\"获取-wallet-对象\">获取 wallet 对象<a class=\"index_header-anchor__Xqb+L\" href=\"#获取-wallet-对象\" style=\"opacity:0\">#</a></h2>\n<p>Sui 钱包使用的是 wallet standard，相比其他异构链有些不同，可以通过事件通知的方式获取 wallet 对象：</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> GlobalWallet <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function-variable function\">register</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>wallet<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n          GlobalWallet<span class=\"token punctuation\">[</span>wallet<span class=\"token punctuation\">.</span>chainName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> wallet\n      <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">const</span> event <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CustomEvent</span><span class=\"token punctuation\">(</span><span class=\"token string\">'wallet-standard:app-ready'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> detail<span class=\"token operator\">:</span> GlobalWallet <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  window<span class=\"token punctuation\">.</span><span class=\"token function\">dispatchEvent</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> suiWallet <span class=\"token operator\">=</span> GlobalWallet<span class=\"token punctuation\">.</span>suiMainnet\n</code></pre></div>\n<h2 data-content=\"获取账户\" id=\"获取账户\">获取账户<a class=\"index_header-anchor__Xqb+L\" href=\"#获取账户\" style=\"opacity:0\">#</a></h2>\n<p>通过以上获取到的 suiWallet 对象，可以获取到账户：</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> suiAccounts <span class=\"token operator\">=</span> suiWallet<span class=\"token punctuation\">.</span>connectedAccounts\n\n<span class=\"token comment\">// suiAccounts 结构:</span>\n<span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">\"address\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0x7995ca23961fe06d8cea7da58ca751567ce820d7cba77b4a373249034eecca4a\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string-property property\">\"publicKey\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tUvCYrG22rHKR0c306MxgnhXOSf16Ot6H3GMO7btwDI=\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string-property property\">\"chains\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">\"sui:mainnet\"</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string-property property\">\"features\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">\"sui:signAndExecuteTransactionBlock\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"sui:signTransactionBlock\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"sui:signMessage\"</span>\n      <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span>\n</code></pre></div>\n<h2 data-content=\"第一笔交易\" id=\"第一笔交易\">第一笔交易<a class=\"index_header-anchor__Xqb+L\" href=\"#第一笔交易\" style=\"opacity:0\">#</a></h2>\n<p><code>suiWallet.features['sui:signAndExecuteTransactionBlock'].signAndExecuteTransactionBlock</code></p>\n<p><strong>签名并发送交易</strong></p>\n<p>Sui 钱包使用的是 wallet standard，相比其他异构链有些不同，所有方法都挂在 features[] 里\n创建交易后，Web 应用程序可能会要求用户的欧易 Web3 钱包签署并发送交易。如果接受，欧易 Web3 钱包将使用用户的私钥签署交易并通过 <code>SUI JSON RPC</code> 连接提交。在 <code>suiWallet</code> 上调用 <code>signAndExecuteTransactionBlock</code> 方法会为已签名的交易返回 <code>promise</code>。</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleTransaction</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> tx <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TransactionBlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    tx<span class=\"token punctuation\">.</span><span class=\"token function\">moveCall</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      target<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>packageId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">::</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>moduleName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">::</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>functionName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      arguments<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        tx<span class=\"token punctuation\">.</span><span class=\"token function\">pure</span><span class=\"token punctuation\">(</span>params1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        tx<span class=\"token punctuation\">.</span><span class=\"token function\">pure</span><span class=\"token punctuation\">(</span>params2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      typeArguments<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> suiWallet<span class=\"token punctuation\">.</span>features<span class=\"token punctuation\">[</span><span class=\"token string\">'sui:signAndExecuteTransactionBlock'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">signAndExecuteTransactionBlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      transactionBlock<span class=\"token operator\">:</span> tx<span class=\"token punctuation\">,</span>\n      options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> showEffects<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'result'</span><span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// 通过result?.effects?.status?.status获取交易状态，成功为 'success'，失败为'failure'</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><strong>拆币</strong></p>\n<p>在发交易时，付 gas 费的 objectId，如果这个 object 本身就要被发送，还要用来付 gas 费，这时候就需要用到拆币(split coin)</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleTransaction</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> tx <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TransactionBlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> value <span class=\"token operator\">=</span> <span class=\"token string\">'300000000'</span>  <span class=\"token comment\">// 这里是想要拆出的目标值</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>coins<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> tx<span class=\"token punctuation\">.</span><span class=\"token function\">splitCoins</span><span class=\"token punctuation\">(</span>tx<span class=\"token punctuation\">.</span>gas<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n      tx<span class=\"token punctuation\">.</span><span class=\"token function\">pure</span><span class=\"token punctuation\">(</span><span class=\"token function\">BigInt</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    tx<span class=\"token punctuation\">.</span><span class=\"token function\">moveCall</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      target<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>packageId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">::</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>moduleName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">::</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>functionName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      arguments<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        tx<span class=\"token punctuation\">.</span><span class=\"token function\">pure</span><span class=\"token punctuation\">(</span>参数<span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        tx<span class=\"token punctuation\">.</span><span class=\"token function\">pure</span><span class=\"token punctuation\">(</span>参数<span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        tx<span class=\"token punctuation\">.</span><span class=\"token function\">makeMoveVec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> objects<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>coins<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      typeArguments<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> suiWallet<span class=\"token punctuation\">.</span>features<span class=\"token punctuation\">[</span><span class=\"token string\">'sui:signAndExecuteTransactionBlock'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">signAndExecuteTransactionBlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      transactionBlock<span class=\"token operator\">:</span> tx<span class=\"token punctuation\">,</span>\n      options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> showEffects<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'result'</span><span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// 通过result?.effects?.status?.status获取交易状态，成功为 'success'，失败为'failure'</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><strong>对交易块进行签名</strong></p>\n<p>通过 <code>provider</code> 上的 <code>signTransactionBlock</code> 方法可以签署一个交易块(多个交易的集合)。</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> tx <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TransactionBlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ntx<span class=\"token punctuation\">.</span><span class=\"token function\">moveCall</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  target<span class=\"token operator\">:</span> <span class=\"token string\">'xxx'</span><span class=\"token punctuation\">,</span>\n  arguments<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    tx<span class=\"token punctuation\">.</span><span class=\"token function\">pure</span><span class=\"token punctuation\">(</span><span class=\"token string\">'okx'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    tx<span class=\"token punctuation\">.</span><span class=\"token function\">pure</span><span class=\"token punctuation\">(</span><span class=\"token string\">'wallet'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> input <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  transactionBlockSerialized<span class=\"token operator\">:</span> tx<span class=\"token punctuation\">.</span><span class=\"token function\">serialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    showEffects<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>l\n<span class=\"token keyword\">const</span> transaction <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> suiWallet<span class=\"token punctuation\">.</span>features<span class=\"token punctuation\">[</span><span class=\"token string\">'sui:signTransactionBlock'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">signTransactionBlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> transactionBlock<span class=\"token operator\">:</span> tx <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<h2 data-content=\"签名信息\" id=\"签名信息\">签名信息<a class=\"index_header-anchor__Xqb+L\" href=\"#签名信息\" style=\"opacity:0\">#</a></h2>\n<p><strong>对单个交易签名（不发送）</strong></p>\n<p>创建交易后，Web 应用程序可能会要求用户的欧易 Web3 钱包签署交易，而无需将其提交到网络。调用 <code>signMessage</code> 方法会为已签名的交易返回 <code>Promise</code>。</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ethers <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'ethers'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 这里借用 ethers 库来帮我们处理 message，将其转为 Uint8Array 类型</span>\n\n<span class=\"token keyword\">const</span> message <span class=\"token operator\">=</span> ethers<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span><span class=\"token function\">toUtf8Bytes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'okx'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> signature<span class=\"token punctuation\">,</span> messageBytes <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> suiWallet<span class=\"token punctuation\">.</span>features<span class=\"token punctuation\">[</span><span class=\"token string\">'sui:signMessage'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">signMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> message <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<h3 id=\"错误码\">错误码<a class=\"index_header-anchor__Xqb+L\" href=\"#错误码\" style=\"opacity:0\">#</a></h3>\n<div class=\"index_table__kvZz5\"><table><thead><tr><th align=\"left\"><div style=\"width:100px\">错误码</div></th><th align=\"left\"><div style=\"width:120px\">标题</div></th><th align=\"left\">描述</th></tr></thead><tbody><tr><td align=\"left\">4900</td><td align=\"left\">断开连接</td><td align=\"left\">OKX Wallet could not connect to the network.</td></tr><tr><td align=\"left\">4100</td><td align=\"left\">未授权</td><td align=\"left\">The requested method and/or account has not been authorized by the user.</td></tr><tr><td align=\"left\">4001</td><td align=\"left\">用户拒绝请求</td><td align=\"left\">The user rejected the request through OKX wallet.</td></tr><tr><td align=\"left\">-32000</td><td align=\"left\">无效输入</td><td align=\"left\">Missing or invalid parameters.</td></tr><tr><td align=\"left\">-32002</td><td align=\"left\">请求资源不可用</td><td align=\"left\">This error occurs when a dapp attempts to submit a new transaction while OKX wallet's approval dialog is already open for a previous transaction. Only one approve window can be open at a time. Users should  approve or reject their transaction before initiating a new transaction.</td></tr><tr><td align=\"left\">-32003</td><td align=\"left\">拒绝交易</td><td align=\"left\">OKX Wallet does not recognize a valid transaction.</td></tr><tr><td align=\"left\">-32601</td><td align=\"left\">未找到方法</td><td align=\"left\">OKX Wallet does not recognize the method.</td></tr><tr><td align=\"left\">-32603</td><td align=\"left\">内部错误</td><td align=\"left\">Something went wrong within OKX wallet.</td></tr></tbody></table></div>\n<h2 data-content=\"连接账户\" id=\"连接账户\">连接账户<a class=\"index_header-anchor__Xqb+L\" href=\"#连接账户\" style=\"opacity:0\">#</a></h2>\n<p><code>suiWallet.features['standard:connect'].connect()</code></p>\n<p><strong>描述</strong></p>\n<p>连接到欧易 Web3 钱包可以通过调用  <code>suiWallet.features['standard:connect'].connect()</code>。</p>\n<p><code>connect</code> 调用将返回一个 <code>Promise</code> 对象，该 <code>Promise</code> 对象在用户接受连接请求时 <code>resolve</code>，并在用户拒绝请求或关闭弹出窗口时 <code>reject</code>。有关欧易 Web3 钱包可能发生错误的详细信息，请参考 <a href=\"#%e9%94%99%e8%af%af%e7%a0%81\">错误码</a>。\n当用户接受连接请求时，<code>suiWallet.features['standard:events']</code> 也会触发连接事件。</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\">suiWallet<span class=\"token punctuation\">.</span>features<span class=\"token punctuation\">[</span><span class=\"token string\">'standard:events'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"connect\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"connected!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>一旦 Web 应用程序连接到欧易 Web3 钱包，它将能够读取连接账户的公钥并提示用户进行其他交易。</p>\n<p><strong>例子</strong></p>\n<p>在 <a class=\"items-center\" href=\"https://codepen.io/okxwallet/pen/RweEpKL\" rel=\"nofollow noreferrer\" style=\"display:inline-flex;line-height:16px\" target=\"_blank\">codeopen<i aria-hidden=\"true\" class=\"icon iconfont doc-ssr-okds-open-link\" role=\"img\" style=\"font-size:24px;color:#0569FF;margin-left:2px\"></i></a>中打开。</p>\n<h2 data-content=\"事件\" id=\"事件\">事件<a class=\"index_header-anchor__Xqb+L\" href=\"#事件\" style=\"opacity:0\">#</a></h2>\n<p><strong>成功连接</strong></p>\n<p>连接到欧易 Web3 钱包可以通过调用 <code>suiWallet.features['standard:events'].on</code>。 当用户接受连接请求时，会触发连接事件。</p>\n<p><strong>用法</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\">suiWallet<span class=\"token punctuation\">.</span>features<span class=\"token punctuation\">[</span><span class=\"token string\">'standard:events'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"connect\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"connected!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p><strong>断开连接</strong></p>\n<p>断开连接与连接过程相同。但是，钱包也有可能发起断开连接，而不是应用程序本身。</p>\n<p><strong>用法</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\">suiWallet<span class=\"token punctuation\">.</span>features<span class=\"token punctuation\">[</span><span class=\"token string\">'standard:events'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"disconnect\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"disconnected!\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p><strong>账户变更</strong></p>\n<p>欧易 Web3 钱包允许用户从单个扩展程序或移动应用程序中无缝管理多个账户。每当用户切换账户时，欧易 Web3 钱包都会发出一个 <code>accountChanged</code> 事件。</p>\n<p>如果用户在已连接到应用程序时更改账户，并且新账户已经将该应用程序列入白名单，那么用户将保持连接状态并且欧易 Web3 钱包将传递新账户的公钥：</p>\n<p><strong>用法</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\">suiWallet<span class=\"token punctuation\">.</span>features<span class=\"token punctuation\">[</span><span class=\"token string\">'standard:events'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'accountChanged'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>publicKey<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>publicKey<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Switched to account </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>publicKey<span class=\"token punctuation\">.</span><span class=\"token function\">toBase58</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div><!--/$--></div>",
  "url": "https://web3.okx.com/zh-hans/build/dev-docs/sdks/chains/sui/provider#什么是-injected-provider-api？",
  "navigation": {
    "breadcrumbs": [
      "DApp 连接钱包",
      "sui",
      "Provider API"
    ],
    "sidebar_links": [
      "什么是连接钱包",
      "支持的网络",
      "接入前提",
      "EVM 兼容链",
      "Bitcoin 兼容链",
      "Solana 兼容链",
      "TON",
      "SUI",
      "Aptos/Movement",
      "Cosmos 系/Sei",
      "Tron",
      "Starknet",
      "常见问题",
      "接入前提",
      "EVM 兼容链",
      "Bitcoin 兼容链",
      "Tron",
      "Solana 兼容链",
      "TON",
      "Aptos/Movement"
    ],
    "toc": [
      "什么是 Injected provider API？",
      "获取 wallet 对象",
      "获取账户",
      "第一笔交易",
      "签名信息",
      "连接账户",
      "事件"
    ]
  },
  "word_count": 840,
  "extract_time": "2025-05-27 06:49:03"
}