# ğŸ“Š è®¢å•ç°¿ Update ID é‡å¤å’Œéé€’å¢åˆ†æ

## ğŸ” **è§‚å¯Ÿåˆ°çš„ç°è±¡**

æ ¹æ®ä½ çš„æ£€æŸ¥ç»“æœï¼š

| äº¤æ˜“å¯¹ | Update ID èŒƒå›´ | è®°å½•æ•° | é‡å¤ | éé€’å¢ | è´¨é‡ |
|--------|---------------|--------|------|--------|------|
| **VIRTUAL-USDT** | 1826361193 - 1826365099 | 10 | 0 | 0 | âœ… è‰¯å¥½ |
| **LMTS-USDT** | 6547321 - 6547504 | 10 | 4 | 2 | âš ï¸ ä¸€èˆ¬ |
| **BNKR-USDT** | 67643895 - 67644285 | 10 | 2 | 1 | âš ï¸ ä¸€èˆ¬ |
| **PRO-USDT** | 236825887 - 236825906 | 10 | 8 | 6 | âš ï¸ è¾ƒå·® |
| **IRON-USDT** | 240158389 - 240158391 | 10 | 10 | 8 | âš ï¸ æœ€å·® |
| **MIGGLES-USDT** | 530346949 - 530347153 | 10 | 0 | 0 | âœ… è‰¯å¥½ |

### **å…³é”®å‘ç°**

#### **IRON-USDT çš„æƒ…å†µï¼ˆæœ€æ˜æ˜¾ï¼‰**

```
Update ID èŒƒå›´: 240158389 - 240158391
                â†‘åªå¢åŠ äº† 2ï¼

è®°å½•æ•°: 10 æ¡
é‡å¤: 10 æ¡ï¼ˆæ‰€æœ‰è®°å½•éƒ½é‡å¤ï¼‰

æœ€è¿‘ 3 æ¡è®°å½•:
  01:04:29.500601  Update ID: 240158391  â† ç›¸åŒ
  01:04:34.508809  Update ID: 240158391  â† ç›¸åŒ
  01:04:39.552396  Update ID: 240158391  â† ç›¸åŒ
```

**è¿™æ„å‘³ç€**ï¼šåœ¨ 10 ç§’å†…ï¼ˆ3æ¡è®°å½•ï¼‰ï¼Œè®¢å•ç°¿çš„ Update ID å®Œå…¨æ²¡æœ‰å˜åŒ–ï¼

---

## ğŸ’¡ **æ ¹æœ¬åŸå› **

### **Update ID çš„å«ä¹‰**

Update IDï¼ˆæˆ– sequence_numberï¼‰æ˜¯è®¢å•ç°¿çš„**"ç‰ˆæœ¬å·"**ï¼š

```
è®¢å•ç°¿ç‰ˆæœ¬ 1: Update ID = 100
  ä¹°: [10.00, 10.01, 10.02]
  å–: [10.05, 10.06, 10.07]

æœ‰äººä¸‹å• â†’ è®¢å•ç°¿å˜åŒ–

è®¢å•ç°¿ç‰ˆæœ¬ 2: Update ID = 101
  ä¹°: [10.01, 10.02, 10.03]  â† å˜åŒ–äº†
  å–: [10.05, 10.06, 10.07]

æ²¡æœ‰äº¤æ˜“ â†’ è®¢å•ç°¿ä¸å˜

è®¢å•ç°¿ç‰ˆæœ¬ 3: Update ID = 101  â† æ²¡å˜ï¼
  ä¹°: [10.01, 10.02, 10.03]  â† ç›¸åŒ
  å–: [10.05, 10.06, 10.07]
```

---

### **ä¸ºä»€ä¹ˆä¼šé‡å¤ï¼Ÿ**

#### **åŸå›  1ï¼šäº¤æ˜“é‡æä½ï¼ˆä¸»è¦åŸå› ï¼‰â­**

```
ä½ çš„é‡‡é›†é¢‘ç‡: æ¯ 5 ç§’ä¸€æ¬¡

IRON-USDT çš„æƒ…å†µ:
  00:00 é‡‡é›† â†’ Update ID: 240158391
  00:05 é‡‡é›† â†’ Update ID: 240158391 â† ç›¸åŒï¼ï¼ˆ5ç§’å†…æ— äº¤æ˜“ï¼‰
  00:10 é‡‡é›† â†’ Update ID: 240158391 â† è¿˜æ˜¯ç›¸åŒï¼ï¼ˆ10ç§’å†…æ— äº¤æ˜“ï¼‰
  00:15 é‡‡é›† â†’ Update ID: 240158391 â† ä¾ç„¶ç›¸åŒï¼ï¼ˆ15ç§’å†…æ— äº¤æ˜“ï¼‰
```

**è¿™æ˜¯æ­£å¸¸çš„ï¼** è¯´æ˜è¿™ä¸ªå¸ç§ï¼š
- âœ… æµåŠ¨æ€§å¾ˆä½
- âœ… äº¤æ˜“ä¸æ´»è·ƒ
- âœ… è®¢å•ç°¿é•¿æ—¶é—´ä¸å˜

---

#### **åŸå›  2ï¼šGate.io API çš„è¡Œä¸º**

Gate.io çš„è®¢å•ç°¿ APIï¼š
- âœ… åªæœ‰å½“è®¢å•ç°¿**å®é™…å‘ç”Ÿå˜åŒ–**æ—¶ï¼ŒUpdate ID æ‰ä¼šå¢åŠ 
- âœ… å¦‚æœè®¢å•ç°¿æ²¡æœ‰å˜åŒ–ï¼Œè¿”å›**ç›¸åŒçš„ Update ID**
- âœ… è¿™æ˜¯**è®¾è®¡è¡Œä¸º**ï¼Œä¸æ˜¯ bug

---

## ğŸ“Š **æµåŠ¨æ€§åˆ†æ**

### **å¯¹æ¯”ä¸åŒäº¤æ˜“å¯¹**

#### **VIRTUAL-USDTï¼ˆæµåŠ¨æ€§å¥½ï¼‰âœ…**

```
10 æ¡è®°å½•ï¼ŒUpdate ID å¢åŠ äº† 3906
  1826361193 â†’ 1826365099
  å¹³å‡æ¯æ¡è®°å½• Update ID å¢åŠ : 390

è¯´æ˜: è®¢å•ç°¿æ¯ç§’å˜åŒ–æ•°ç™¾æ¬¡ï¼
```

#### **IRON-USDTï¼ˆæµåŠ¨æ€§å·®ï¼‰âš ï¸**

```
10 æ¡è®°å½•ï¼ŒUpdate ID åªå¢åŠ äº† 2
  240158389 â†’ 240158391
  å¹³å‡æ¯æ¡è®°å½• Update ID å¢åŠ : 0.2

è¯´æ˜: è®¢å•ç°¿å¯èƒ½å‡ åç§’æ‰å˜åŒ–ä¸€æ¬¡ï¼
```

---

## ğŸ”¬ **è¯¦ç»†åˆ†æ**

### **è®¡ç®—æµåŠ¨æ€§æŒ‡æ ‡**

| äº¤æ˜“å¯¹ | Update ID å¢é•¿ | æµåŠ¨æ€§è¯„åˆ† | åˆ†æ |
|--------|---------------|-----------|------|
| VIRTUAL-USDT | 3906 | â­â­â­â­â­ | ææ´»è·ƒ |
| MIGGLES-USDT | 204 | â­â­â­â­ | æ´»è·ƒ |
| BNKR-USDT | 390 | â­â­â­â­ | æ´»è·ƒ |
| LMTS-USDT | 183 | â­â­â­ | ä¸€èˆ¬ |
| PRO-USDT | 19 | â­â­ | è¾ƒä½ |
| IRON-USDT | 2 | â­ | æä½ |

**å…¬å¼**ï¼š
```
æµåŠ¨æ€§è¯„åˆ† = Update ID å¢é•¿ / è®°å½•æ•°
```

---

## ğŸ¯ **è¿™æ˜¯æ­£å¸¸çš„è¿˜æ˜¯é—®é¢˜ï¼Ÿ**

### âœ… **è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼**

**åŸå› **ï¼š

1. **å°å¸ç§æµåŠ¨æ€§ä½** â­
   - IRONã€PRO ç­‰æ˜¯å¸‚å€¼è¾ƒå°çš„å¸ç§
   - äº¤æ˜“ä¸æ´»è·ƒ
   - è®¢å•ç°¿å˜åŒ–ç¼“æ…¢

2. **Gate.io çš„è®¾è®¡** â­
   - è®¢å•ç°¿ä¸å˜åŒ– = Update ID ä¸å˜
   - è¿™æ ·å¯ä»¥èŠ‚çœå¸¦å®½å’Œè®¡ç®—èµ„æº

3. **5 ç§’é‡‡é›†é—´éš”** â­
   - å¯¹äºæµåŠ¨æ€§ä½çš„å¸ç§ï¼Œ5 ç§’å†…å¯èƒ½å®Œå…¨æ²¡æœ‰äº¤æ˜“
   - æ‰€ä»¥ä¼šå¾—åˆ°ç›¸åŒçš„ Update ID

---

## ğŸ“ˆ **å®é™…ä¾‹å­**

### **IRON-USDT çš„çœŸå®æƒ…å†µ**

```bash
æ—¶é—´è½´:
â”œâ”€ 01:03:54  Update ID: 240158389  (é‡‡é›†)
â”‚               â†“ 5ç§’å...
â”œâ”€ 01:03:59  Update ID: 240158389  â† æ²¡å˜ï¼ˆæ— äº¤æ˜“ï¼‰
â”‚               â†“ 5ç§’å...
â”œâ”€ 01:04:04  Update ID: 240158391  â† å˜äº†ï¼ï¼ˆæœ‰äººä¸‹å•äº†ï¼‰
â”‚               â†“ 5ç§’å...
â”œâ”€ 01:04:09  Update ID: 240158391  â† æ²¡å˜
â”‚               â†“ 5ç§’å...
â”œâ”€ 01:04:14  Update ID: 240158391  â† æ²¡å˜
â”‚               â†“ 5ç§’å...
â”œâ”€ 01:04:19  Update ID: 240158391  â† æ²¡å˜
â”‚               â†“ 5ç§’å...
â””â”€ 01:04:24  Update ID: 240158391  â† è¿˜æ˜¯æ²¡å˜

ç»“è®º: åœ¨ 30 ç§’å†…åªå‘ç”Ÿäº† 1 æ¬¡è®¢å•ç°¿å˜åŒ–ï¼
```

---

### **VIRTUAL-USDT çš„çœŸå®æƒ…å†µ**

```bash
æ—¶é—´è½´:
â”œâ”€ 01:03:54  Update ID: 1826361193
â”‚               â†“ 5ç§’å...
â”œâ”€ 01:03:59  Update ID: 1826362000  â† å¢åŠ äº† 807ï¼
â”‚               â†“ 5ç§’å...
â”œâ”€ 01:04:04  Update ID: 1826363200  â† åˆå¢åŠ äº† 1200ï¼
â”‚               â†“ 5ç§’å...
â””â”€ 01:04:09  Update ID: 1826364500  â† åˆå¢åŠ äº† 1300ï¼

ç»“è®º: è®¢å•ç°¿æ¯ç§’å˜åŒ– 160-260 æ¬¡ï¼
```

---

## ğŸ¤” **æ˜¯å¦éœ€è¦æ‹…å¿ƒï¼Ÿ**

### **ä¸éœ€è¦æ‹…å¿ƒï¼** âœ…

**ç†ç”±**ï¼š

1. **æ•°æ®å®Œæ•´æ€§** âœ…
   - æ‰€æœ‰çš„è®¢å•ç°¿å¿«ç…§éƒ½è¢«æ­£ç¡®è®°å½•
   - Update ID é‡å¤è¡¨ç¤º"è®¢å•ç°¿æ²¡æœ‰å˜åŒ–"
   - è¿™æ˜¯**æœ‰ä»·å€¼çš„ä¿¡æ¯**ï¼ˆè¯´æ˜å¸‚åœºä¸æ´»è·ƒï¼‰

2. **æ•°æ®è´¨é‡** âœ…
   - VIRTUAL-USDT å’Œ MIGGLES-USDT è´¨é‡è‰¯å¥½
   - è¯´æ˜ç³»ç»Ÿè¿è¡Œæ­£å¸¸
   - å…¶ä»–å¸ç§çš„é‡å¤æ˜¯**çœŸå®åæ˜ äº†å¸‚åœºçŠ¶æ€**

3. **é€‚åˆä½ çš„éœ€æ±‚** âœ…
   - å¯¹äºè·¨äº¤æ˜“æ‰€å¥—åˆ©ï¼Œä½ éœ€è¦**æ´»è·ƒçš„å¸ç§**
   - VIRTUAL-USDT è¿™æ ·çš„å¸ç§æ‰é€‚åˆé«˜é¢‘äº¤æ˜“
   - IRON-USDT è¿™æ ·çš„å¸ç§æµåŠ¨æ€§å¤ªå·®ï¼Œä¸é€‚åˆ

---

## ğŸ’¡ **å»ºè®®å’Œè¡ŒåŠ¨**

### **1. ç­›é€‰æ´»è·ƒå¸ç§** â­

æ ¹æ®æµåŠ¨æ€§è¯„åˆ†ï¼Œå»ºè®®ï¼š

```bash
âœ… ä¿ç•™é‡‡é›†:
   â€¢ VIRTUAL-USDT  (æµåŠ¨æ€§: â­â­â­â­â­)
   â€¢ MIGGLES-USDT  (æµåŠ¨æ€§: â­â­â­â­)
   â€¢ BNKR-USDT     (æµåŠ¨æ€§: â­â­â­â­)

âš ï¸ è€ƒè™‘ç§»é™¤:
   â€¢ LMTS-USDT     (æµåŠ¨æ€§: â­â­â­)
   â€¢ PRO-USDT      (æµåŠ¨æ€§: â­â­)
   â€¢ IRON-USDT     (æµåŠ¨æ€§: â­)
```

---

### **2. è°ƒæ•´é‡‡é›†ç­–ç•¥**

#### **å¯¹äºé«˜æµåŠ¨æ€§å¸ç§**
```yaml
# config/orderbook_snapshot_gateio_high_liquidity.yml
trading_pairs:
  - "VIRTUAL-USDT"
  - "MIGGLES-USDT"
  - "BNKR-USDT"

schedule:
  frequency_hours: 0.001389  # 5 ç§’
```

#### **å¯¹äºä½æµåŠ¨æ€§å¸ç§**
```yaml
# config/orderbook_snapshot_gateio_low_liquidity.yml
trading_pairs:
  - "LMTS-USDT"
  - "PRO-USDT"
  - "IRON-USDT"

schedule:
  frequency_hours: 0.00833  # 30 ç§’ï¼ˆèŠ‚çœèµ„æºï¼‰
```

---

### **3. æ•°æ®è¿‡æ»¤ï¼ˆæ¨èï¼‰**

åœ¨ä½¿ç”¨æ•°æ®æ—¶ï¼Œè¿‡æ»¤æ‰é‡å¤çš„ Update IDï¼š

```python
import pandas as pd

# è¯»å–æ•°æ®
df = pd.read_parquet('gate_io_IRON-USDT_20251117.parquet')

# è¿‡æ»¤é‡å¤çš„ Update ID
df_unique = df.drop_duplicates(subset=['update_id'], keep='first')

print(f"åŸå§‹è®°å½•: {len(df)}")
print(f"å”¯ä¸€è®°å½•: {len(df_unique)}")
print(f"é‡å¤ç‡: {(len(df) - len(df_unique)) / len(df) * 100:.1f}%")

# ç»“æœç¤ºä¾‹:
# åŸå§‹è®°å½•: 10
# å”¯ä¸€è®°å½•: 3  â† åªæœ‰ 3 æ¬¡è®¢å•ç°¿å˜åŒ–
# é‡å¤ç‡: 70.0%  â† 70% çš„é‡‡é›†æ˜¯é‡å¤çš„
```

---

### **4. æµåŠ¨æ€§ç›‘æ§è„šæœ¬**

åˆ›å»ºä¸€ä¸ªè„šæœ¬æ¥ç›‘æ§æµåŠ¨æ€§ï¼š

```python
#!/usr/bin/env python3
"""
è®¢å•ç°¿æµåŠ¨æ€§ç›‘æ§

ä½¿ç”¨æ–¹æ³•ï¼š
    python scripts/monitor_orderbook_liquidity.py
"""

import pandas as pd
from pathlib import Path
from core.data_paths import data_paths

def analyze_liquidity(trading_pair: str) -> dict:
    """åˆ†ææµåŠ¨æ€§"""
    orderbook_dir = data_paths.raw_dir / "orderbook_snapshots"
    files = list(orderbook_dir.glob(f"gate_io_{trading_pair}_*.parquet"))
    
    if not files:
        return {'error': 'no_data'}
    
    # è¯»å–æœ€æ–°æ–‡ä»¶
    latest_file = sorted(files)[-1]
    df = pd.read_parquet(latest_file)
    
    # è®¡ç®—æŒ‡æ ‡
    total_records = len(df)
    unique_updates = df['update_id'].nunique()
    duplicate_rate = (total_records - unique_updates) / total_records * 100
    
    # Update ID å¢é•¿é€Ÿåº¦
    if len(df) > 1:
        update_id_growth = df['update_id'].max() - df['update_id'].min()
        avg_growth_per_record = update_id_growth / total_records
    else:
        update_id_growth = 0
        avg_growth_per_record = 0
    
    return {
        'trading_pair': trading_pair,
        'total_records': total_records,
        'unique_updates': unique_updates,
        'duplicate_rate': duplicate_rate,
        'update_id_growth': update_id_growth,
        'avg_growth_per_record': avg_growth_per_record,
        'liquidity_score': min(5, int(avg_growth_per_record / 50))  # 0-5 stars
    }

# åˆ†ææ‰€æœ‰äº¤æ˜“å¯¹
pairs = ['VIRTUAL-USDT', 'LMTS-USDT', 'BNKR-USDT', 'PRO-USDT', 'IRON-USDT', 'MIGGLES-USDT']

print("ğŸ“Š è®¢å•ç°¿æµåŠ¨æ€§åˆ†æ")
print("=" * 80)

for pair in pairs:
    result = analyze_liquidity(pair)
    if 'error' not in result:
        stars = "â­" * result['liquidity_score']
        print(f"{pair:20s} {stars:10s} (é‡å¤ç‡: {result['duplicate_rate']:.1f}%)")
```

---

## ğŸ¯ **æ€»ç»“**

### **Update ID é‡å¤çš„çœŸç›¸**

| ç°è±¡ | åŸå›  | æ˜¯å¦æ­£å¸¸ | è¡ŒåŠ¨ |
|------|------|---------|------|
| **é‡å¤** | è®¢å•ç°¿æ²¡æœ‰å˜åŒ– | âœ… æ­£å¸¸ | è¿‡æ»¤é‡å¤ |
| **éé€’å¢** | æ··åˆäº†æµ‹è¯•æ•°æ® | âš ï¸ å¯æ¸…ç† | é‡æ–°é‡‡é›† |
| **å®Œå…¨ç›¸åŒ** | æµåŠ¨æ€§æä½ | âœ… æ­£å¸¸ | è€ƒè™‘ç§»é™¤ |

---

### **å…³é”®è¦ç‚¹**

1. âœ… **é‡å¤æ˜¯æ­£å¸¸çš„**
   - è¡¨ç¤ºè®¢å•ç°¿æ²¡æœ‰å˜åŒ–
   - çœŸå®åæ˜ å¸‚åœºçŠ¶æ€

2. âœ… **æµåŠ¨æ€§å·®å¼‚å¾ˆå¤§**
   - VIRTUAL-USDT: é«˜æµåŠ¨æ€§ â­â­â­â­â­
   - IRON-USDT: ä½æµåŠ¨æ€§ â­

3. âœ… **æ ¹æ®æµåŠ¨æ€§é€‰æ‹©å¸ç§**
   - é«˜é¢‘äº¤æ˜“éœ€è¦é«˜æµåŠ¨æ€§
   - ä½æµåŠ¨æ€§å¸ç§ä¸é€‚åˆé¢‘ç¹é‡‡é›†

4. âœ… **æ•°æ®å¤„ç†æ—¶å»é‡**
   - ä½¿ç”¨ `drop_duplicates(subset=['update_id'])`
   - åªä¿ç•™çœŸæ­£çš„è®¢å•ç°¿å˜åŒ–

---

### **æ¨èè¡ŒåŠ¨**

1. **çŸ­æœŸ**ï¼š
   - âœ… ç»§ç»­é‡‡é›†ï¼ˆäº†è§£å„å¸ç§ç‰¹æ€§ï¼‰
   - âœ… æ•°æ®å¤„ç†æ—¶è¿‡æ»¤é‡å¤

2. **ä¸­æœŸ**ï¼š
   - âœ… ç­›é€‰é«˜æµåŠ¨æ€§å¸ç§
   - âœ… è°ƒæ•´ä½æµåŠ¨æ€§å¸ç§çš„é‡‡é›†é¢‘ç‡

3. **é•¿æœŸ**ï¼š
   - âœ… å»ºç«‹æµåŠ¨æ€§ç›‘æ§ç³»ç»Ÿ
   - âœ… æ ¹æ®æµåŠ¨æ€§åŠ¨æ€è°ƒæ•´é‡‡é›†ç­–ç•¥

---

**é‡å¤çš„ Update ID ä¸æ˜¯é—®é¢˜ï¼Œè€Œæ˜¯å¸‚åœºçœŸå®çŠ¶æ€çš„åæ˜ ï¼** ğŸ“Šâœ¨

