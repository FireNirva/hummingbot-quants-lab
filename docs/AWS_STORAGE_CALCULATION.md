# 💾 AWS 订单簿存储空间计算

## 📊 当前配置

| 参数 | 数值 |
|------|------|
| **交易对数量** | 6 个 |
| **采集间隔** | 5 秒 |
| **订单簿深度** | 100 档 |
| **运行时间** | 24/7 连续 |

**交易对列表**：
- VIRTUAL-USDT
- LMTS-USDT
- BNKR-USDT
- PRO-USDT
- IRON-USDT
- MIGGLES-USDT

---

## 💾 单条记录大小分析

### **未压缩数据结构**

```python
单条记录包含:
- timestamp (datetime64):     8 bytes
- update_id (int64):          8 bytes
- exchange (string):         10 bytes
- trading_pair (string):     15 bytes
- best_bid_price (float64):   8 bytes
- best_bid_amount (float64):  8 bytes
- best_ask_price (float64):   8 bytes
- best_ask_amount (float64):  8 bytes
- bid_prices (100个float64): 800 bytes
- bid_amounts (100个float64): 800 bytes
- ask_prices (100个float64): 800 bytes
- ask_amounts (100个float64): 800 bytes
-----------------------------------
未压缩总计: ~3,275 bytes
```

### **Parquet 压缩后**

Parquet 格式特点：
- 列式存储：相同类型数据压缩率高
- Snappy 压缩算法：快速且高效
- 压缩率：通常 50-70%

**压缩后大小**：~1,300 bytes/条（实测）

---

## 📈 采集数据量计算

### **每日数据量**

```
采集次数/分钟: 60秒 ÷ 5秒 = 12 次
采集次数/小时: 12 × 60 = 720 次
采集次数/天:   720 × 24 = 17,280 次

单个交易对/天:
17,280 条 × 1,300 bytes = 22,464,000 bytes
= 21.43 MB/天

6个交易对/天:
21.43 MB × 6 = 128.6 MB/天
```

### **每月数据量**

```
单个交易对/月:
21.43 MB × 30 = 642.9 MB/月

6个交易对/月:
128.6 MB × 30 = 3,858 MB
= 3.77 GB/月
```

### **加上系统开销**

```
文件系统开销（元数据、索引等）: +20%
3.77 GB × 1.2 = 4.52 GB/月
```

---

## 💰 AWS 存储成本

### **S3 标准存储**

| 存储类型 | 价格 | 每月成本 |
|----------|------|----------|
| **S3 Standard** | $0.023/GB/月 | $0.10/月 |
| **S3 Intelligent-Tiering** | $0.023/GB/月 + $0.0025/1000 objects | $0.11/月 |
| **EBS gp3** | $0.08/GB/月 | $0.36/月 |

**推荐**：S3 Standard（最便宜，适合冷数据）

### **长期存储成本**

| 时长 | 数据量 | 成本 (S3) | 成本 (EBS) |
|------|--------|-----------|------------|
| **1 个月** | 4.5 GB | $0.10 | $0.36 |
| **3 个月** | 13.5 GB | $0.31 | $1.08 |
| **6 个月** | 27 GB | $0.62 | $2.16 |
| **1 年** | 54 GB | $1.24 | $4.32 |

---

## 🎯 回测所需历史数据时长

### **秒级跨交易所套利的特点**

```
持仓时间: 几秒到几分钟
交易频率: 每天数十到数百次
依赖因素: 
  • 实时订单簿深度
  • 瞬时价差
  • 滑点估计
  • 执行延迟
```

### **历史数据需求分析**

#### **方案 1：最小数据集（7 天）** ⚠️

**优点**：
- ✅ 数据量小（~30 GB）
- ✅ 回测速度快
- ✅ 存储成本低

**缺点**：
- ❌ 样本不足
- ❌ 可能错过重要市场事件
- ❌ 统计显著性不足

**适用场景**：快速验证策略可行性

---

#### **方案 2：标准数据集（30 天）** ✅ 推荐

**优点**：
- ✅ 覆盖完整市场周期
- ✅ 包含不同时段流动性
- ✅ 足够统计样本（~50万条/交易对）
- ✅ 数据量可控（~135 GB）

**缺点**：
- ⚠️ 需要一定存储空间
- ⚠️ 回测时间稍长（可接受）

**适用场景**：生产环境策略开发 🌟

**关键指标**：
```
总记录数: 518,400 条/交易对
覆盖场景:
  ✅ 工作日 vs 周末（20 vs 8-10 天）
  ✅ 不同时段（亚洲/欧洲/美洲时段）
  ✅ 高/低波动期
  ✅ 不同流动性状态
```

---

#### **方案 3：深度数据集（90 天）** 📊

**优点**：
- ✅ 包含多种市场状态
- ✅ 统计显著性强
- ✅ 可识别季节性模式
- ✅ 风险评估更准确

**缺点**：
- ❌ 数据量大（~405 GB）
- ❌ 回测时间长
- ❌ 存储成本高（$9.31/年 on S3）

**适用场景**：机构级量化策略

---

### **推荐配置：30 天滚动窗口** 🎯

#### **数据管理策略**

```python
保留策略:
- 最近 30 天: 全部保留（5秒精度）
- 31-90 天:  降采样到 1 分钟
- 91-180 天: 降采样到 5 分钟
- 180+ 天:   只保留每日统计摘要

实际存储:
- 30 天全精度: 135 GB
- 60 天降采样: +5 GB
- 90 天降采样: +2 GB
- 总计: ~142 GB
```

**成本**：
- S3: $3.27/年
- EBS: $11.36/年

---

## 🔄 回测和仓位管理时间框架

### **回测数据时长建议**

| 分析维度 | 最少 | 推荐 | 理想 |
|----------|------|------|------|
| **策略验证** | 7 天 | 14 天 | 30 天 |
| **参数优化** | 14 天 | 30 天 | 60 天 |
| **风险评估** | 30 天 | 60 天 | 90 天 |
| **生产部署** | 30 天 | 90 天 | 180 天 |

### **仓位管理所需数据**

#### **滚动统计窗口**

```python
实时监控指标:
- 订单簿深度: 实时
- 价差分布:   最近 24 小时
- 成交量:     最近 7 天
- 波动率:     最近 30 天
- 极端值:     最近 90 天

动态调整:
if 30天数据质量好:
    仓位上限 = 标准仓位
elif 7天数据波动大:
    仓位上限 = 标准仓位 × 0.5
else:
    仓位上限 = 标准仓位 × 0.7
```

---

## 💡 具体建议

### **Phase 1: 策略开发（1-2 周）**

```
数据需求: 7-14 天
存储空间: 30-60 GB
AWS 成本: $0.69-1.38/月 (S3)

目标:
✅ 验证策略逻辑
✅ 初步参数调优
✅ 识别主要风险
```

### **Phase 2: 参数优化（2-4 周）**

```
数据需求: 30 天
存储空间: 135 GB
AWS 成本: $3.10/月 (S3)

目标:
✅ 精确参数优化
✅ 多场景回测
✅ 压力测试
```

### **Phase 3: 生产部署（持续）**

```
数据需求: 30 天滚动 + 90 天降采样
存储空间: 142 GB
AWS 成本: $3.27/月 (S3)

目标:
✅ 实时监控
✅ 动态风险管理
✅ 持续策略优化
```

---

## 📊 总结表格

| 场景 | 数据时长 | 存储需求 | AWS 成本/月 | 推荐度 |
|------|----------|----------|-------------|--------|
| **快速验证** | 7 天 | 30 GB | $0.69 | ⚠️ |
| **策略开发** | 30 天 | 135 GB | $3.10 | ✅ 推荐 |
| **深度分析** | 90 天 | 405 GB | $9.31 | 📊 |
| **滚动窗口** | 30+60降采样 | 142 GB | $3.27 | 🎯 最优 |

---

## 🎯 最终建议

### **对于秒级跨交易所套利**

#### **最优配置**

```yaml
数据采集:
  间隔: 5 秒
  深度: 100 档
  交易对: 6 个

数据保留:
  全精度: 30 天
  降采样: 额外 60 天
  摘要: 永久保留

存储方案:
  实时数据: EBS gp3 (最近 7 天)
  历史数据: S3 Standard (30+ 天)
  归档数据: S3 Glacier (90+ 天)

预计成本:
  存储: $4-5/月
  计算: $10-20/月 (t3.small)
  总计: ~$15-25/月
```

#### **回测建议**

```
初期开发: 7-14 天数据
正式上线前: 30 天完整回测
持续优化: 30 天滚动窗口

仓位管理:
- 基于最近 24 小时订单簿深度
- 参考最近 7 天价差波动
- 限制每笔订单不超过 10 分钟平均成交量的 1%
```

---

## 🚀 实施步骤

### **Week 1-2: 数据积累**
```
✅ 采集 7-14 天数据
✅ 验证数据质量
✅ 初步策略测试
```

### **Week 3-4: 完整回测**
```
✅ 积累到 30 天数据
✅ 参数优化
✅ 风险评估
```

### **Week 5+: 生产部署**
```
✅ 小规模实盘
✅ 持续监控
✅ 滚动优化
```

---

## 💰 成本总结

**一年运行成本估算**：

| 项目 | 成本/年 |
|------|---------|
| **存储 (142 GB)** | $39.24 |
| **计算 (t3.small)** | $180 |
| **网络传输** | $12 |
| **CloudWatch 监控** | $24 |
| **总计** | **~$255/年** |

**折合每月**: ~$21

---

**建议从 30 天数据开始，这是秒级套利的最佳平衡点！** 🎯✨

