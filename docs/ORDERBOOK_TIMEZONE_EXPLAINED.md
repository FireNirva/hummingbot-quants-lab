# ðŸ• è®¢å•ç°¿æ•°æ®æ—¶åŒºå’Œæ—¥æœŸåˆ†åŒºè¯´æ˜Ž

## ðŸŽ¯ **å¿«é€Ÿå›žç­”**

**æŒ‰ç…§ UTC æ—¶åŒºæ¥åˆ’åˆ†å¤©æ•°ï¼**

- âœ… é‡‡é›†æ—¶é—´æˆ³ï¼š`datetime.now(timezone.utc)` - UTC æ—¶åŒº
- âœ… æ–‡ä»¶åæ—¥æœŸï¼šåŸºäºŽ UTC æ—¶é—´æˆ³ç”Ÿæˆ
- âœ… åˆ†åŒºè¾¹ç•Œï¼šUTC æ—¶é—´ 00:00:00

---

## ðŸ“‹ **ä»£ç å®žçŽ°**

### **æ—¶é—´æˆ³ç”Ÿæˆ**

```python
# åœ¨ app/tasks/data_collection/orderbook_snapshot_task.py ç¬¬ 195 è¡Œ

# æå–æ•°æ®
timestamp = datetime.now(timezone.utc)  # â† ä½¿ç”¨ UTC æ—¶åŒº
update_id = orderbook_data.get('id')
bids = orderbook_data.get('bids', [])
asks = orderbook_data.get('asks', [])
```

### **æ–‡ä»¶åç”Ÿæˆ**

```python
# åœ¨ app/tasks/data_collection/orderbook_snapshot_task.py ç¬¬ 354 è¡Œ

# ç”Ÿæˆæ–‡ä»¶åï¼ˆæŒ‰æ—¥æœŸåˆ†åŒºï¼‰
date_str = snapshot_data['timestamp'].strftime('%Y%m%d')  # â† UTC æ—¥æœŸ
filename = f"{self.connector_name}_{snapshot_data['trading_pair']}_{date_str}.parquet"
```

---

## ðŸŒ **æ—¶åŒºè½¬æ¢ç¤ºä¾‹**

### **UTC æ—¶é—´ vs æœ¬åœ°æ—¶é—´**

```python
UTC æ—¶é—´: 2025-11-16 00:00:00 UTC
         â†“
å„åœ°æœ¬åœ°æ—¶é—´:
  â€¢ åŒ—äº¬ (UTC+8):    2025-11-16 08:00:00
  â€¢ ä¸œäº¬ (UTC+9):    2025-11-16 09:00:00
  â€¢ çº½çº¦ (UTC-5):    2025-11-15 19:00:00
  â€¢ ä¼¦æ•¦ (UTC+0):    2025-11-16 00:00:00
```

---

## ðŸ“… **æ–‡ä»¶åˆ‡æ¢æ—¶é—´**

### **ä½•æ—¶åˆ›å»ºæ–°æ–‡ä»¶ï¼Ÿ**

**åœ¨ UTC æ—¶é—´çš„ 00:00:00ï¼**

| UTC æ—¶é—´ | åŒ—äº¬æ—¶é—´ (UTC+8) | æ–‡ä»¶å | è¯´æ˜Ž |
|----------|------------------|--------|------|
| 2025-11-15 23:59:55 | 2025-11-16 07:59:55 | `*_20251115.parquet` | æ—§æ–‡ä»¶ |
| 2025-11-16 00:00:00 | 2025-11-16 08:00:00 | `*_20251116.parquet` | æ–°æ–‡ä»¶ âœ¨ |
| 2025-11-16 00:00:05 | 2025-11-16 08:00:05 | `*_20251116.parquet` | ç»§ç»­è¿½åŠ  |

---

## ðŸŽ¯ **å®žé™…ä¾‹å­**

### **ä½ çš„æƒ…å†µï¼ˆåœ¨ä¸­å›½ï¼‰**

å‡è®¾ä½ åœ¨åŒ—äº¬ï¼ˆUTC+8ï¼‰ï¼š

```
åŒ—äº¬æ—¶é—´ 2025-11-16 07:59:55 (æ—©ä¸Š)
  â†’ UTC æ—¶é—´: 2025-11-15 23:59:55
  â†’ æ–‡ä»¶å: gate_io_VIRTUAL-USDT_20251115.parquet

åŒ—äº¬æ—¶é—´ 2025-11-16 08:00:00 (æ—©ä¸Š 8 ç‚¹)
  â†’ UTC æ—¶é—´: 2025-11-16 00:00:00
  â†’ æ–‡ä»¶å: gate_io_VIRTUAL-USDT_20251116.parquet  â† æ–°æ–‡ä»¶ï¼

åŒ—äº¬æ—¶é—´ 2025-11-16 23:59:55 (æ™šä¸Š)
  â†’ UTC æ—¶é—´: 2025-11-16 15:59:55
  â†’ æ–‡ä»¶å: gate_io_VIRTUAL-USDT_20251116.parquet

åŒ—äº¬æ—¶é—´ 2025-11-17 08:00:00 (ç¬¬äºŒå¤©æ—©ä¸Š 8 ç‚¹)
  â†’ UTC æ—¶é—´: 2025-11-17 00:00:00
  â†’ æ–‡ä»¶å: gate_io_VIRTUAL-USDT_20251117.parquet  â† åˆä¸€ä¸ªæ–°æ–‡ä»¶ï¼
```

**ç»“è®º**ï¼šåœ¨ä¸­å›½ï¼Œæ¯å¤©æ—©ä¸Š 8 ç‚¹ï¼ˆUTC 00:00ï¼‰ä¼šåˆ›å»ºæ–°æ–‡ä»¶ï¼

---

## ðŸ“Š **æ•°æ®ç¤ºä¾‹**

### **æŸ¥çœ‹å®žé™…æ—¶é—´æˆ³**

```python
import pandas as pd

# è¯»å–ä»Šå¤©çš„æ•°æ®
df = pd.read_parquet('app/data/raw/orderbook_snapshots/gate_io_VIRTUAL-USDT_20251116.parquet')

# æŸ¥çœ‹æ—¶é—´èŒƒå›´
print(df['timestamp'].min())
# è¾“å‡º: 2025-11-16 00:00:02+00:00  â† UTC æ—¶é—´

print(df['timestamp'].max())
# è¾“å‡º: 2025-11-16 23:59:58+00:00  â† UTC æ—¶é—´

# è½¬æ¢åˆ°åŒ—äº¬æ—¶é—´æŸ¥çœ‹
df['timestamp_beijing'] = df['timestamp'].dt.tz_convert('Asia/Shanghai')
print(df['timestamp_beijing'].min())
# è¾“å‡º: 2025-11-16 08:00:02+08:00  â† åŒ—äº¬æ—¶é—´

print(df['timestamp_beijing'].max())
# è¾“å‡º: 2025-11-17 07:59:58+08:00  â† åŒ—äº¬æ—¶é—´ï¼ˆç¬¬äºŒå¤©æ—©ä¸Šï¼‰
```

---

## ðŸ¤” **ä¸ºä»€ä¹ˆç”¨ UTCï¼Ÿ**

### **ç†ç”± 1ï¼šå›½é™…æ ‡å‡†**

- âœ… UTC æ˜¯å…¨çƒæ ‡å‡†æ—¶é—´
- âœ… ä¸å—å¤ä»¤æ—¶å½±å“
- âœ… æ‰€æœ‰åŠ å¯†è´§å¸äº¤æ˜“æ‰€éƒ½ä½¿ç”¨ UTC
- âœ… ä¾¿äºŽè·¨æ—¶åŒºæ•°æ®åˆ†æž

### **ç†ç”± 2ï¼šé¿å…æ­§ä¹‰**

```python
# é—®é¢˜ï¼šå¦‚æžœä½¿ç”¨æœ¬åœ°æ—¶é—´
å¤ä»¤æ—¶åˆ‡æ¢æ—¶:
  2025-03-10 02:00:00 â†’ è·³åˆ° 03:00:00
  è¿™ 1 å°æ—¶çš„æ•°æ®åŽ»å“ªé‡Œï¼ŸâŒ

å†¬ä»¤æ—¶åˆ‡æ¢æ—¶:
  2025-11-02 02:00:00 â†’ é‡å¤ä¸€æ¬¡
  è¿™ 1 å°æ—¶å‡ºçŽ°ä¸¤æ¬¡ï¼ŸâŒ

# UTC æ²¡æœ‰è¿™äº›é—®é¢˜
UTC æ—¶é—´æ°¸è¿œå•è°ƒé€’å¢ž âœ…
```

### **ç†ç”± 3ï¼šæ•°æ®ä¸€è‡´æ€§**

```python
å¦‚æžœä½ ä»Žä¸åŒåœ°åŒºé‡‡é›†æ•°æ®:
  â€¢ AWS ç¾Žå›½ä¸œéƒ¨ (UTC-5)
  â€¢ AWS æ–°åŠ å¡ (UTC+8)
  â€¢ æœ¬åœ°å¼€å‘ (UTC+8)

ä½¿ç”¨ UTC:
  â†’ æ‰€æœ‰æ•°æ®çš„æ—¥æœŸåˆ†åŒºè¾¹ç•Œä¸€è‡´ âœ…

ä½¿ç”¨æœ¬åœ°æ—¶é—´:
  â†’ ä¸åŒåœ°åŒºçš„"åŒä¸€å¤©"æ•°æ®ä¼šåœ¨ä¸åŒæ–‡ä»¶ âŒ
```

---

## ðŸ”„ **å¦‚ä½•æŒ‰æœ¬åœ°æ—¶é—´æŸ¥è¯¢ï¼Ÿ**

### **æ–¹æ³• 1ï¼šè½¬æ¢åˆ°æœ¬åœ°æ—¶é—´åŽè¿‡æ»¤**

```python
import pandas as pd
from datetime import datetime
import pytz

# è¯»å–æ•°æ®
df = pd.read_parquet('gate_io_VIRTUAL-USDT_20251116.parquet')

# è½¬æ¢åˆ°åŒ—äº¬æ—¶é—´
df['timestamp_beijing'] = df['timestamp'].dt.tz_convert('Asia/Shanghai')

# è¿‡æ»¤åŒ—äº¬æ—¶é—´çš„æŸä¸ªæ—¶æ®µï¼ˆæ¯”å¦‚äº¤æ˜“æ—¥ 9:00-15:00ï¼‰
beijing_tz = pytz.timezone('Asia/Shanghai')
start = beijing_tz.localize(datetime(2025, 11, 16, 9, 0, 0))
end = beijing_tz.localize(datetime(2025, 11, 16, 15, 0, 0))

df_trading_hours = df[(df['timestamp_beijing'] >= start) & 
                      (df['timestamp_beijing'] <= end)]
```

### **æ–¹æ³• 2ï¼šè®¡ç®—éœ€è¦è¯»å–çš„ UTC æ—¥æœŸ**

```python
from datetime import datetime, timedelta
import pytz

# ä½ æƒ³æŸ¥è¯¢çš„åŒ—äº¬æ—¶é—´èŒƒå›´
beijing_tz = pytz.timezone('Asia/Shanghai')
beijing_start = beijing_tz.localize(datetime(2025, 11, 16, 0, 0, 0))
beijing_end = beijing_tz.localize(datetime(2025, 11, 16, 23, 59, 59))

# è½¬æ¢åˆ° UTC
utc_start = beijing_start.astimezone(pytz.UTC)
utc_end = beijing_end.astimezone(pytz.UTC)

print(f"åŒ—äº¬æ—¶é—´ 2025-11-16 å…¨å¤©")
print(f"  å¯¹åº” UTC: {utc_start} åˆ° {utc_end}")
print(f"  éœ€è¦è¯»å–æ–‡ä»¶: *_20251115.parquet å’Œ *_20251116.parquet")
```

---

## ðŸ“‹ **å®žé™…ä½¿ç”¨å»ºè®®**

### **æŽ¨èåšæ³•ï¼šä¿æŒ UTC**

```python
# âœ… æŽ¨èï¼šç›´æŽ¥ä½¿ç”¨ UTC æ—¶é—´
df = load_orderbook_snapshots('gate_io', 'VIRTUAL-USDT',
                             start_date='20251116',  # UTC æ—¥æœŸ
                             end_date='20251116')

# å¦‚éœ€æœ¬åœ°æ—¶é—´ï¼Œåœ¨åˆ†æžæ—¶è½¬æ¢
df['timestamp_local'] = df['timestamp'].dt.tz_convert('Asia/Shanghai')
```

**ç†ç”±**ï¼š
- âœ… æ•°æ®ä¸€è‡´æ€§
- âœ… é¿å…æ—¶åŒºæ··æ·†
- âœ… ä¾¿äºŽè·¨æ—¶åŒºåˆ†æž
- âœ… ä¸Žäº¤æ˜“æ‰€æ—¶é—´å¯¹é½

### **ç‰¹æ®Šéœ€æ±‚ï¼šæŒ‰æœ¬åœ°æ—¶é—´æŸ¥è¯¢**

```python
# å¦‚æžœç¡®å®žéœ€è¦æŒ‰åŒ—äº¬æ—¶é—´æŸ¥è¯¢æŸå¤©
import pytz
from datetime import datetime

# åŒ—äº¬æ—¶é—´ 11 æœˆ 16 æ—¥
beijing_tz = pytz.timezone('Asia/Shanghai')
beijing_date = datetime(2025, 11, 16)

# è®¡ç®—å¯¹åº”çš„ UTC æ—¥æœŸèŒƒå›´
utc_start = beijing_tz.localize(beijing_date).astimezone(pytz.UTC)
utc_start_date = utc_start.strftime('%Y%m%d')  # å¯èƒ½æ˜¯ 20251115

utc_end = beijing_tz.localize(beijing_date + timedelta(days=1)).astimezone(pytz.UTC)
utc_end_date = utc_end.strftime('%Y%m%d')  # å¯èƒ½æ˜¯ 20251116

# è¯»å–ç›¸å…³æ–‡ä»¶
df = load_orderbook_snapshots('gate_io', 'VIRTUAL-USDT',
                             start_date=utc_start_date,
                             end_date=utc_end_date)

# è½¬æ¢å¹¶è¿‡æ»¤åˆ°ç²¾ç¡®çš„åŒ—äº¬æ—¶é—´èŒƒå›´
df['timestamp_beijing'] = df['timestamp'].dt.tz_convert('Asia/Shanghai')
df = df[df['timestamp_beijing'].dt.date == beijing_date.date()]
```

---

## ðŸŒ **ä¸åŒæ—¶åŒºçš„æ–‡ä»¶åˆ‡æ¢æ—¶é—´**

| æ—¶åŒº | UTC åç§» | æ–‡ä»¶åˆ‡æ¢çš„æœ¬åœ°æ—¶é—´ |
|------|----------|-------------------|
| **åŒ—äº¬/ä¸Šæµ·** | UTC+8 | æ—©ä¸Š 08:00 |
| **ä¸œäº¬** | UTC+9 | æ—©ä¸Š 09:00 |
| **æ–°åŠ å¡** | UTC+8 | æ—©ä¸Š 08:00 |
| **ä¼¦æ•¦** | UTC+0 | å‡Œæ™¨ 00:00 |
| **çº½çº¦** | UTC-5 | å‰ä¸€å¤© 19:00 |
| **æ´›æ‰çŸ¶** | UTC-8 | å‰ä¸€å¤© 16:00 |

---

## ðŸ“Š **æ•°æ®å®Œæ•´æ€§**

### **è·¨å¤©æ•°æ®ç¤ºä¾‹**

```
æ–‡ä»¶: gate_io_VIRTUAL-USDT_20251116.parquet

åŒ…å«çš„ UTC æ—¶é—´:
  2025-11-16 00:00:00 è‡³ 2025-11-16 23:59:59

åŒ…å«çš„åŒ—äº¬æ—¶é—´ï¼ˆUTC+8ï¼‰:
  2025-11-16 08:00:00 è‡³ 2025-11-17 07:59:59

ç»“è®º:
- ä¸€ä¸ª UTC å¤©çš„æ–‡ä»¶
- è·¨è¶ŠåŒ—äº¬æ—¶é—´çš„ä¸¤ä¸ªè‡ªç„¶æ—¥
- ä½†æ•°æ®æ˜¯å®Œæ•´è¿žç»­çš„ âœ…
```

---

## ðŸŽ¯ **æ€»ç»“**

| é¡¹ç›® | è¯´æ˜Ž |
|------|------|
| **æ—¶åŒº** | UTCï¼ˆåè°ƒä¸–ç•Œæ—¶ï¼‰ |
| **æ—¶é—´æˆ³** | `datetime.now(timezone.utc)` |
| **æ–‡ä»¶å** | åŸºäºŽ UTC æ—¥æœŸç”Ÿæˆ |
| **åˆ†åŒºè¾¹ç•Œ** | UTC 00:00:00 |
| **åŒ—äº¬æ—¶é—´åˆ‡æ¢** | æ¯å¤©æ—©ä¸Š 8:00 åˆ›å»ºæ–°æ–‡ä»¶ |
| **æ•°æ®å®Œæ•´æ€§** | âœ… å®Œå…¨è¿žç»­ï¼Œæ— é—æ¼ |
| **è·¨æ—¶åŒºåˆ†æž** | âœ… æ‰€æœ‰åœ°åŒºä¸€è‡´ |

---

## ðŸ’¡ **å…³é”®è¦ç‚¹**

1. âœ… **ä½¿ç”¨ UTC æ˜¯æ­£ç¡®çš„é€‰æ‹©**
   - å›½é™…æ ‡å‡†
   - æ— å¤ä»¤æ—¶é—®é¢˜
   - æ•°æ®ä¸€è‡´æ€§

2. âœ… **æ–‡ä»¶æŒ‰ UTC æ—¥æœŸåˆ†åŒº**
   - æ¯å¤© UTC 00:00:00 åˆ›å»ºæ–°æ–‡ä»¶
   - åŒ—äº¬æ—¶é—´æ˜¯æ—©ä¸Š 8:00

3. âœ… **æŸ¥è¯¢æ—¶çš„æ³¨æ„äº‹é¡¹**
   - æ–‡ä»¶åä½¿ç”¨ UTC æ—¥æœŸ
   - å¯ä»¥åœ¨è¯»å–åŽè½¬æ¢åˆ°æœ¬åœ°æ—¶é—´
   - è·¨å¤©æŸ¥è¯¢éœ€è¦è¯»å–å¤šä¸ªæ–‡ä»¶

4. âœ… **æ•°æ®å®Œæ•´æ€§ä¿è¯**
   - æ•°æ®æ°¸è¿œè¿žç»­
   - æ— æ—¶åŒºæ­§ä¹‰
   - ä¾¿äºŽå…¨çƒåˆ†æž

---

**ä½ çš„ç³»ç»Ÿä½¿ç”¨ UTC æ—¶åŒºï¼Œè¿™æ˜¯æœ€ä½³å®žè·µï¼** ðŸŒâœ¨

