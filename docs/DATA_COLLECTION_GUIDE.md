# ğŸ“Š QuantsLab æ•°æ®æ”¶é›†ç³»ç»Ÿå®Œæ•´æŒ‡å—

## ğŸ—ï¸ ä¸€ã€ç³»ç»Ÿæ¶æ„æ€»è§ˆ

### æ ¸å¿ƒç»„ä»¶å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä»»åŠ¡é…ç½®æ–‡ä»¶ (YAML)                            â”‚
â”‚  - å®šä¹‰ä»»åŠ¡å‚æ•°                                                    â”‚
â”‚  - é…ç½®è°ƒåº¦è§„åˆ™                                                    â”‚
â”‚  - è®¾ç½®ä¾èµ–å…³ç³»                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TaskRunner (ä»»åŠ¡è¿è¡Œå™¨)                        â”‚
â”‚  - åŠ è½½é…ç½®æ–‡ä»¶                                                    â”‚
â”‚  - åˆå§‹åŒ–ä»»åŠ¡å®ä¾‹                                                  â”‚
â”‚  - ç®¡ç† TaskOrchestrator                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 TaskOrchestrator (ä»»åŠ¡ç¼–æ’å™¨)                     â”‚
â”‚  - ä»»åŠ¡è°ƒåº¦ (Cron/é¢‘ç‡)                                           â”‚
â”‚  - ä¾èµ–ç®¡ç†                                                        â”‚
â”‚  - å¹¶å‘æ§åˆ¶                                                        â”‚
â”‚  - é‡è¯•æœºåˆ¶                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   BaseTask (ä»»åŠ¡åŸºç±»)                             â”‚
â”‚  ç”Ÿå‘½å‘¨æœŸé’©å­ï¼š                                                    â”‚
â”‚  1. setup()      - ä»»åŠ¡åˆå§‹åŒ–                                     â”‚
â”‚  2. execute()    - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘                                   â”‚
â”‚  3. cleanup()    - èµ„æºæ¸…ç†                                       â”‚
â”‚  4. on_success() - æˆåŠŸå›è°ƒ                                       â”‚
â”‚  5. on_failure() - å¤±è´¥å›è°ƒ                                       â”‚
â”‚  6. on_retry()   - é‡è¯•å›è°ƒ                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®æ”¶é›†ä»»åŠ¡      â”‚        â”‚   å…¶ä»–ä»»åŠ¡ç±»å‹    â”‚
â”‚                  â”‚        â”‚                  â”‚
â”‚ - Candlesä¸‹è½½    â”‚        â”‚ - å›æµ‹ä»»åŠ¡        â”‚
â”‚ - Poolsç­›é€‰      â”‚        â”‚ - ä¼˜åŒ–ä»»åŠ¡        â”‚
â”‚ - èµ„é‡‘è´¹ç‡       â”‚        â”‚ - Notebookæ‰§è¡Œ    â”‚
â”‚ - Tradesæ•°æ®     â”‚        â”‚ - éƒ¨ç½²ä»»åŠ¡        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ äºŒã€æ•°æ®æ”¶é›†ä»»åŠ¡ç±»å‹è¯¦è§£

### 1. CandlesDownloaderTask (Kçº¿æ•°æ®ä¸‹è½½)

**åŠŸèƒ½**: ä»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ä¸‹è½½æ‰€æœ‰äº¤æ˜“å¯¹çš„Kçº¿æ•°æ®å¹¶ç¼“å­˜ä¸º Parquet æ–‡ä»¶

**æ ¸å¿ƒä»£ç ä½ç½®**: `app/tasks/data_collection/candles_downloader_task.py`

**å·¥ä½œæµç¨‹**:
```python
1. åˆå§‹åŒ– CLOBDataSource
2. è·å–äº¤æ˜“æ‰€çš„æ‰€æœ‰äº¤æ˜“è§„åˆ™ (get_trading_rules)
3. éå†æ‰€æœ‰äº¤æ˜“å¯¹å’Œæ—¶é—´é—´éš”
4. è°ƒç”¨ CLOB.get_candles() è·å–æ•°æ®
5. è‡ªåŠ¨ç¼“å­˜åˆ° Parquet æ–‡ä»¶
6. è¿”å›ç»Ÿè®¡ä¿¡æ¯
```

**é…ç½®å‚æ•°**:
```yaml
config:
  connector_name: "binance_perpetual"  # äº¤æ˜“æ‰€åç§°
  quote_asset: "USDT"                  # æŠ¥ä»·èµ„äº§
  intervals: ["1m", "15m", "1h"]       # æ—¶é—´é—´éš”
  days_data_retention: 30              # æ•°æ®ä¿ç•™å¤©æ•°
  min_notional_size: 10                # æœ€å°åä¹‰ä»·å€¼
```

**æ•°æ®å­˜å‚¨è·¯å¾„**: `app/data/cache/candles/`
- æ–‡ä»¶å‘½åæ ¼å¼: `{connector}|{pair}|{interval}.parquet`
- ä¾‹å¦‚: `binance_perpetual|BTC-USDT|15m.parquet`

---

### 2. SimpleCandlesDownloader (æŒ‡å®šäº¤æ˜“å¯¹Kçº¿ä¸‹è½½)

**åŠŸèƒ½**: åªä¸‹è½½æŒ‡å®šäº¤æ˜“å¯¹çš„Kçº¿æ•°æ®ï¼ˆæ›´å¿«é€Ÿã€æ›´ç²¾ç¡®ï¼‰

**æ ¸å¿ƒä»£ç ä½ç½®**: `app/tasks/data_collection/simple_candles_downloader.py`

**ä¸ CandlesDownloaderTask çš„åŒºåˆ«**:
- âœ… ä¸éœ€è¦è·å–æ‰€æœ‰äº¤æ˜“å¯¹
- âœ… é€Ÿåº¦æ›´å¿«ï¼Œé€‚åˆç‰¹å®šç­–ç•¥
- âœ… é…ç½®æ›´ç®€å•

**é…ç½®å‚æ•°**:
```yaml
config:
  connector_name: "binance_perpetual"
  trading_pairs: ["BTC-USDT", "ETH-USDT", "SOL-USDT"]  # æŒ‡å®šäº¤æ˜“å¯¹
  intervals: ["15m", "1h"]
  days_data_retention: 7
```

---

### 3. PoolsScreenerTask (æµåŠ¨æ€§æ± ç­›é€‰)

**åŠŸèƒ½**: ä» GeckoTerminal è·å– DEX æ± å­æ•°æ®å¹¶ç­›é€‰

**æ ¸å¿ƒä»£ç ä½ç½®**: `app/tasks/data_collection/pools_screener.py`

**å·¥ä½œæµç¨‹**:
```python
1. åˆå§‹åŒ– GeckoTerminalAsyncClient
2. è·å– Top Pools å’Œ New Pools
3. æ¸…æ´—æ•°æ®ï¼ˆè®¡ç®—æµåŠ¨æ€§æ¯”ç‡ç­‰ï¼‰
4. æŒ‰æ¡ä»¶ç­›é€‰æ± å­
5. å­˜å‚¨åˆ° MongoDB
```

**é…ç½®å‚æ•°**:
```yaml
config:
  network: "solana"              # åŒºå—é“¾ç½‘ç»œ
  quote_asset: "SOL"             # æŠ¥ä»·èµ„äº§
  min_pool_age_days: 2           # æœ€å°æ± é¾„
  min_fdv: 70000                 # æœ€å° FDV
  max_fdv: 5000000               # æœ€å¤§ FDV
  min_volume_24h: 150000         # æœ€å° 24h äº¤æ˜“é‡
  min_liquidity: 50000           # æœ€å°æµåŠ¨æ€§
  min_transactions_24h: 300      # æœ€å° 24h äº¤æ˜“æ•°
```

**æ•°æ®å­˜å‚¨**: MongoDB `quants_lab.pools` é›†åˆ

---

## ğŸ”§ ä¸‰ã€æ ¸å¿ƒæ•°æ®æºè¯¦è§£

### CLOBDataSource (ä¸­å¿ƒåŒ–è®¢å•ç°¿æ•°æ®æº)

**ä½ç½®**: `core/data_sources/clob.py`

**æ ¸å¿ƒåŠŸèƒ½**:
1. **è‡ªåŠ¨ç¼“å­˜ç®¡ç†**: Parquet æ–‡ä»¶è¯»å†™
2. **æ™ºèƒ½æ•°æ®åˆå¹¶**: å¢é‡æ›´æ–°å·²æœ‰æ•°æ®
3. **å¤šäº¤æ˜“æ‰€æ”¯æŒ**: æ”¯æŒæ‰€æœ‰ Hummingbot CLOB è¿æ¥å™¨
4. **æ•°æ®éªŒè¯**: è‡ªåŠ¨è¿‡æ»¤æ— æ•ˆæ•°æ®

**å…³é”®æ–¹æ³•**:
```python
# è·å–Kçº¿æ•°æ®ï¼ˆè‡ªåŠ¨ç¼“å­˜ï¼‰
candles = await clob.get_candles(
    connector_name="binance_perpetual",
    trading_pair="BTC-USDT", 
    interval="15m",
    start_time=start_timestamp,
    end_time=end_timestamp
)

# ä¿å­˜ç¼“å­˜åˆ°æ–‡ä»¶
clob.dump_candles_cache()

# ä»ç¼“å­˜åŠ è½½æ•°æ®
candles = clob.get_candles_from_cache(
    connector_name="binance_perpetual",
    trading_pair="BTC-USDT",
    interval="15m"
)
```

**æ”¯æŒçš„äº¤æ˜“æ‰€**:
- Binance / Binance Perpetual
- OKX / OKX Perpetual
- Bybit / Bybit Perpetual
- Gate.io
- ç­‰ç­‰ï¼ˆæ’é™¤éƒ¨åˆ†ä¸ç¨³å®šè¿æ¥å™¨ï¼‰

---

## âš™ï¸ å››ã€ä»»åŠ¡ç³»ç»Ÿå·¥ä½œåŸç†

### ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ

```python
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é…ç½®åŠ è½½    â”‚  TaskRunner è¯»å– YAML
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»»åŠ¡åˆå§‹åŒ–   â”‚  åˆ›å»º Task å®ä¾‹
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è°ƒåº¦æ£€æŸ¥     â”‚  Orchestrator æ£€æŸ¥æ˜¯å¦è¯¥è¿è¡Œ
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ setup()     â”‚  åˆå§‹åŒ–èµ„æºï¼ˆDBã€API å®¢æˆ·ç«¯ç­‰ï¼‰
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ execute()   â”‚  æ‰§è¡Œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ æˆåŠŸ â”€â”€â†’ on_success()
       â”‚
       â”œâ”€ å¤±è´¥ â”€â”€â†’ on_failure() â”€â”€â†’ é‡è¯•ï¼Ÿâ”€â”€â†’ on_retry()
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ cleanup()   â”‚  æ¸…ç†èµ„æº
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è°ƒåº¦æœºåˆ¶

#### 1. é¢‘ç‡è°ƒåº¦ (Frequency)
```yaml
schedule:
  type: frequency
  frequency_hours: 2.0  # æ¯ 2 å°æ—¶è¿è¡Œä¸€æ¬¡
```

#### 2. Cron è°ƒåº¦
```yaml
schedule:
  type: cron
  cron: "0 */6 * * *"   # æ¯ 6 å°æ—¶æ•´ç‚¹è¿è¡Œ
  timezone: "UTC"
```

#### 3. ä¾èµ–è§¦å‘
```yaml
dependencies:
  - task_name: "candles_downloader"
    on_completion: true      # ä»»æ„å®ŒæˆçŠ¶æ€è§¦å‘
    # on_success: true       # ä»…æˆåŠŸæ—¶è§¦å‘
    # on_failure: true       # ä»…å¤±è´¥æ—¶è§¦å‘
    delay_seconds: 300       # å»¶è¿Ÿ 5 åˆ†é’Ÿ
```

---

## ğŸ“ äº”ã€å¦‚ä½•åˆ›å»ºæ•°æ®æ”¶é›†é…ç½®

### ç¤ºä¾‹ 1: åŸºç¡€ Kçº¿ä¸‹è½½é…ç½®

```yaml
# config/my_candles_downloader.yml

tasks:
  btc_eth_candles:
    enabled: true
    task_class: app.tasks.data_collection.simple_candles_downloader.SimpleCandlesDownloader
    
    schedule:
      type: frequency
      frequency_hours: 1.0  # æ¯å°æ—¶è¿è¡Œ
    
    max_retries: 3
    retry_delay_seconds: 60
    timeout_seconds: 600
    
    config:
      connector_name: "binance_perpetual"
      trading_pairs:
        - "BTC-USDT"
        - "ETH-USDT"
        - "SOL-USDT"
      intervals: ["15m", "1h"]
      days_data_retention: 7
```

**è¿è¡Œå‘½ä»¤**:
```bash
# æ–¹æ³•1: æŒç»­è¿è¡Œï¼ˆæŒ‰è°ƒåº¦ï¼‰
python cli.py run-tasks --config my_candles_downloader.yml

# æ–¹æ³•2: å•æ¬¡è§¦å‘
python cli.py trigger-task --task btc_eth_candles --config my_candles_downloader.yml

# æ–¹æ³•3: ç›´æ¥è¿è¡Œï¼ˆä½¿ç”¨å†…ç½®é»˜è®¤é…ç½®ï¼‰
python cli.py run app.tasks.data_collection.simple_candles_downloader
```

---

### ç¤ºä¾‹ 2: å¤šæ•°æ®æºç»„åˆé…ç½®

```yaml
# config/multi_source_data.yml

tasks:
  # ä»»åŠ¡1: ä¸‹è½½Kçº¿
  candles_downloader:
    enabled: true
    task_class: app.tasks.data_collection.candles_downloader_task.CandlesDownloaderTask
    
    schedule:
      type: frequency
      frequency_hours: 2.0
    
    config:
      connector_name: "binance_perpetual"
      quote_asset: "USDT"
      intervals: ["15m", "1h"]
      days_data_retention: 14
    
    tags:
      - data_collection
      - candles

  # ä»»åŠ¡2: ç­›é€‰æ± å­ï¼ˆç‹¬ç«‹è¿è¡Œï¼‰
  solana_pools:
    enabled: true
    task_class: app.tasks.data_collection.pools_screener.PoolsScreenerTask
    
    schedule:
      type: frequency
      frequency_hours: 1.0
    
    config:
      network: "solana"
      quote_asset: "SOL"
      min_volume_24h: 100000
      min_liquidity: 50000
    
    tags:
      - data_collection
      - pools
```

---

### ç¤ºä¾‹ 3: å¸¦ä¾èµ–å…³ç³»çš„é…ç½®

```yaml
# config/candles_with_analysis.yml

tasks:
  # ä¸»ä»»åŠ¡: ä¸‹è½½æ•°æ®
  download_candles:
    enabled: true
    task_class: app.tasks.data_collection.simple_candles_downloader.SimpleCandlesDownloader
    
    schedule:
      type: frequency
      frequency_hours: 4.0  # æ¯4å°æ—¶
    
    config:
      connector_name: "binance_perpetual"
      trading_pairs: ["BTC-USDT", "ETH-USDT"]
      intervals: ["15m"]
      days_data_retention: 30
    
    tags:
      - data_collection

  # ä¾èµ–ä»»åŠ¡: æ•°æ®ä¸‹è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œåˆ†æ
  analyze_volatility:
    enabled: true
    task_class: app.tasks.screeners.volume_volatility_screener_task.VolumeVolatilityScreenerTask
    
    # ä¸è®¾ç½® scheduleï¼Œä»…é€šè¿‡ä¾èµ–è§¦å‘
    dependencies:
      - task_name: "download_candles"
        on_success: true       # ä»…åœ¨æˆåŠŸæ—¶è§¦å‘
        delay_seconds: 60      # ç­‰å¾…1åˆ†é’Ÿ
    
    config:
      connector_name: "binance_perpetual"
      interval: "15m"
      days: 30
    
    tags:
      - analysis
```

---

## ğŸš€ å…­ã€å®æˆ˜æ¼”ç»ƒ

### åœºæ™¯1: å¿«é€Ÿä¸‹è½½ BTC å’Œ ETH æ•°æ®

**æ­¥éª¤1**: åˆ›å»ºé…ç½®æ–‡ä»¶
```bash
cat > config/quick_btc_eth.yml << 'EOF'
tasks:
  quick_download:
    enabled: true
    task_class: app.tasks.data_collection.simple_candles_downloader.SimpleCandlesDownloader
    
    schedule:
      type: frequency
      frequency_hours: 999  # è®¾ç½®å¾ˆå¤§é¿å…è‡ªåŠ¨é‡å¤
    
    config:
      connector_name: "binance_perpetual"
      trading_pairs: ["BTC-USDT", "ETH-USDT"]
      intervals: ["15m", "1h", "4h"]
      days_data_retention: 30
EOF
```

**æ­¥éª¤2**: è¿è¡Œä»»åŠ¡
```bash
python cli.py trigger-task --task quick_download --config quick_btc_eth.yml
```

**æ­¥éª¤3**: æ£€æŸ¥æ•°æ®
```bash
ls -lh app/data/cache/candles/ | grep "BTC-USDT\|ETH-USDT"
```

---

### åœºæ™¯2: æ¯æ—¥è‡ªåŠ¨æ”¶é›†å¤šäº¤æ˜“æ‰€æ•°æ®

**é…ç½®æ–‡ä»¶**: `config/daily_multi_exchange.yml`
```yaml
tasks:
  binance_daily:
    enabled: true
    task_class: app.tasks.data_collection.candles_downloader_task.CandlesDownloaderTask
    
    schedule:
      type: cron
      cron: "0 0 * * *"  # æ¯å¤© UTC 00:00
      timezone: "UTC"
    
    config:
      connector_name: "binance_perpetual"
      quote_asset: "USDT"
      intervals: ["1d"]
      days_data_retention: 365
    
    tags:
      - daily
      - binance

  okx_daily:
    enabled: true
    task_class: app.tasks.data_collection.candles_downloader_task.CandlesDownloaderTask
    
    schedule:
      type: cron
      cron: "0 1 * * *"  # æ¯å¤© UTC 01:00 (é”™å¼€æ—¶é—´)
      timezone: "UTC"
    
    config:
      connector_name: "okx_perpetual"
      quote_asset: "USDT"
      intervals: ["1d"]
      days_data_retention: 365
    
    tags:
      - daily
      - okx
```

**è¿è¡Œ**:
```bash
# åå°æŒç»­è¿è¡Œ
nohup python cli.py run-tasks --config daily_multi_exchange.yml > logs/daily.log 2>&1 &
```

---

## ğŸ’¡ ä¸ƒã€å¸¸è§é—®é¢˜ä¸æœ€ä½³å®è·µ

### Q1: æ•°æ®å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ

**Kçº¿æ•°æ®**: `app/data/cache/candles/`
- æ ¼å¼: Parquet æ–‡ä»¶
- å‘½å: `{connector}|{pair}|{interval}.parquet`

**æ± å­æ•°æ®**: MongoDB `quants_lab.pools` é›†åˆ

**å›æµ‹ç»“æœ**: `app/data/processed/backtesting/`

### Q2: å¦‚ä½•é¿å…é‡å¤ä¸‹è½½æ•°æ®ï¼Ÿ

CLOBDataSource è‡ªåŠ¨å¤„ç†ç¼“å­˜ï¼š
1. æ£€æŸ¥æœ¬åœ° Parquet æ–‡ä»¶
2. å¦‚æœæ•°æ®å­˜åœ¨ä¸”æ—¶é—´èŒƒå›´è¦†ç›–ï¼Œç›´æ¥è¯»å–
3. å¦‚æœéœ€è¦æ›´æ–°ï¼Œåªä¸‹è½½ç¼ºå¤±éƒ¨åˆ†
4. è‡ªåŠ¨åˆå¹¶æ–°æ—§æ•°æ®

### Q3: ä»»åŠ¡å¤±è´¥åä¼šæ€æ ·ï¼Ÿ

```yaml
max_retries: 3              # æœ€å¤šé‡è¯•3æ¬¡
retry_delay_seconds: 60     # æ¯æ¬¡é‡è¯•é—´éš”60ç§’
```

ä»»åŠ¡ä¼šï¼š
1. è°ƒç”¨ `on_failure()` é’©å­
2. ç­‰å¾… `retry_delay_seconds`
3. è°ƒç”¨ `on_retry()` é’©å­
4. é‡æ–°æ‰§è¡Œ `execute()`
5. é‡å¤ç›´åˆ°æˆåŠŸæˆ–è¾¾åˆ° `max_retries`

### Q4: å¦‚ä½•ç›‘æ§ä»»åŠ¡è¿è¡ŒçŠ¶æ€ï¼Ÿ

**æ–¹æ³•1**: æŸ¥çœ‹æ—¥å¿—
```bash
tail -f logs/task_runner.log
```

**æ–¹æ³•2**: ä½¿ç”¨ APIï¼ˆå¦‚æœå¯ç”¨ï¼‰
```bash
# å¯ç”¨ API
python cli.py serve --config my_config.yml --port 8000

# æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
curl http://localhost:8000/tasks
curl http://localhost:8000/tasks/candles_downloader
```

**æ–¹æ³•3**: æŸ¥è¯¢ MongoDB
```python
from core.database_manager import db_manager
mongo = await db_manager.get_mongodb_client()
tasks = await mongo.find_documents("task_executions", {})
```

### Q5: å¦‚ä½•ä¼˜åŒ–ä¸‹è½½é€Ÿåº¦ï¼Ÿ

1. **ä½¿ç”¨ SimpleCandlesDownloader** è€Œä¸æ˜¯ CandlesDownloaderTaskï¼ˆé’ˆå¯¹ç‰¹å®šäº¤æ˜“å¯¹ï¼‰
2. **å‡å°‘æ—¶é—´é—´éš”æ•°é‡** ï¼ˆåªä¸‹è½½éœ€è¦çš„ï¼Œå¦‚ ["1h"]ï¼‰
3. **å‡å°‘æ•°æ®ä¿ç•™å¤©æ•°** ï¼ˆä» 365 æ”¹ä¸º 30ï¼‰
4. **å¢åŠ å¹¶å‘æ•°**:
   ```yaml
   max_concurrent_tasks: 5  # åœ¨ config é¡¶å±‚è®¾ç½®
   ```

---

## ğŸ” å…«ã€è°ƒè¯•æŠ€å·§

### 1. æµ‹è¯•å•ä¸ªä»»åŠ¡

ä»»åŠ¡æ–‡ä»¶åº•éƒ¨éƒ½æœ‰ `main()` å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œï¼š
```bash
cd /path/to/quants-lab
python -m app.tasks.data_collection.simple_candles_downloader
```

### 2. éªŒè¯é…ç½®æ–‡ä»¶

```bash
python cli.py validate-config --config my_config.yml
```

### 3. åˆ—å‡ºæ‰€æœ‰ä»»åŠ¡

```bash
python cli.py list-tasks --config my_config.yml
```

### 4. æŸ¥çœ‹å¯ç”¨è¿æ¥å™¨

```bash
python list_connectors.py
```

---

## ğŸ“š ä¹ã€å‚è€ƒèµ„æ–™

### å…³é”®æ–‡ä»¶è·¯å¾„

```
æ ¸å¿ƒä»»åŠ¡ç³»ç»Ÿ:
â”œâ”€â”€ core/tasks/base.py           # BaseTask åŸºç±»
â”œâ”€â”€ core/tasks/orchestrator.py   # ä»»åŠ¡ç¼–æ’å™¨
â”œâ”€â”€ core/tasks/runner.py         # ä»»åŠ¡è¿è¡Œå™¨
â””â”€â”€ core/tasks/storage.py        # ä»»åŠ¡çŠ¶æ€å­˜å‚¨

æ•°æ®æ”¶é›†ä»»åŠ¡:
â”œâ”€â”€ app/tasks/data_collection/
â”‚   â”œâ”€â”€ candles_downloader_task.py       # å…¨é‡Kçº¿ä¸‹è½½
â”‚   â”œâ”€â”€ simple_candles_downloader.py     # æŒ‡å®šäº¤æ˜“å¯¹Kçº¿
â”‚   â”œâ”€â”€ pools_screener.py                # æ± å­ç­›é€‰
â”‚   â”œâ”€â”€ funding_rates_task.py            # èµ„é‡‘è´¹ç‡
â”‚   â””â”€â”€ trades_downloader_task.py        # äº¤æ˜“æ•°æ®

æ•°æ®æº:
â”œâ”€â”€ core/data_sources/clob.py            # CLOBæ•°æ®æº
â””â”€â”€ core/services/okx_dex_api.py         # OKX DEX API

é…ç½®ç¤ºä¾‹:
â”œâ”€â”€ config/template_1_candles_optimization.yml
â”œâ”€â”€ config/template_2_candles_pools_screener.yml
â””â”€â”€ config/template_3_periodic_reports.yml
```

### ç¯å¢ƒå˜é‡é…ç½® (.env)

```bash
# MongoDB (ç”¨äºå­˜å‚¨æ± å­æ•°æ®å’Œä»»åŠ¡çŠ¶æ€)
MONGO_URI=mongodb://admin:admin@localhost:27017
MONGO_DATABASE=quants_lab

# ä»»åŠ¡ç³»ç»Ÿ API
TASK_API_ENABLED=false
TASK_API_HOST=0.0.0.0
TASK_API_PORT=8000

# é€šçŸ¥ç³»ç»Ÿ
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id
```

---

## ğŸ¯ åã€ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªé…ç½®æ–‡ä»¶
2. âœ… è¿è¡Œä¸€ä¸ªç®€å•çš„æ•°æ®ä¸‹è½½ä»»åŠ¡
3. âœ… æ£€æŸ¥ç”Ÿæˆçš„ Parquet æ–‡ä»¶
4. âœ… åœ¨ Jupyter Notebook ä¸­åŠ è½½å’Œåˆ†ææ•°æ®
5. âœ… åˆ›å»ºè‡ªå·±çš„è‡ªå®šä¹‰æ•°æ®æ”¶é›†ä»»åŠ¡

**ç¥ä½ æ•°æ®æ”¶é›†æ„‰å¿«ï¼ğŸ“Šâœ¨**

