# DEX-CEX å¥—åˆ©ç­–ç•¥è§„åˆ’æ–‡æ¡£

> **ç­–ç•¥ç›®æ ‡ï¼š** åœ¨ DEX å’Œ CEX ä¹‹é—´å¯»æ‰¾ä»·æ ¼å·®å¼‚ï¼Œæ‰§è¡Œå¥—åˆ©äº¤æ˜“  
> **åˆ›å»ºæ—¥æœŸï¼š** 2025-10-05  
> **çŠ¶æ€ï¼š** è§„åˆ’é˜¶æ®µ

---

## ğŸ“‹ ç›®å½•

1. [ç­–ç•¥æ¦‚è¿°](#ç­–ç•¥æ¦‚è¿°)
2. [ä¸¤ç§å®ç°æ€è·¯å¯¹æ¯”](#ä¸¤ç§å®ç°æ€è·¯å¯¹æ¯”)
3. [æ¨èæ–¹æ¡ˆ](#æ¨èæ–¹æ¡ˆ)
4. [å®Œæ•´æµç¨‹è®¾è®¡](#å®Œæ•´æµç¨‹è®¾è®¡)
5. [æŠ€æœ¯å®ç°ç»†èŠ‚](#æŠ€æœ¯å®ç°ç»†èŠ‚)
6. [é£é™©å’ŒæŒ‘æˆ˜](#é£é™©å’ŒæŒ‘æˆ˜)
7. [ä¸‹ä¸€æ­¥è¡ŒåŠ¨](#ä¸‹ä¸€æ­¥è¡ŒåŠ¨)

---

## ç­–ç•¥æ¦‚è¿°

### æ ¸å¿ƒé€»è¾‘

åœ¨ DEX å’Œ CEX ä¹‹é—´å¯»æ‰¾åŒä¸€äº¤æ˜“å¯¹çš„ä»·æ ¼å·®å¼‚ï¼Œå½“ä»·å·®å¤§äºäº¤æ˜“æˆæœ¬æ—¶æ‰§è¡Œå¥—åˆ©ã€‚

```
å¥—åˆ©æœºä¼š = |DEXä»·æ ¼ - CEXä»·æ ¼| - (Gasè´¹ + CEXæ‰‹ç»­è´¹ + æ»‘ç‚¹)
```

### å¥—åˆ©ç±»å‹

1. **DEXä¹°å…¥ â†’ CEXå–å‡º**
   - DEX ä»·æ ¼ < CEX ä»·æ ¼
   - åœ¨ DEX ä¹°å…¥ï¼Œè½¬åˆ° CEX å–å‡º

2. **CEXä¹°å…¥ â†’ DEXå–å‡º**
   - CEX ä»·æ ¼ < DEX ä»·æ ¼
   - åœ¨ CEX ä¹°å…¥ï¼Œè½¬åˆ° DEX å–å‡º

### å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | è¯´æ˜ | ç›®æ ‡å€¼ |
|-----|------|-------|
| **ä»·å·®ç™¾åˆ†æ¯”** | (ä»·å·® / å¹³å‡ä»·æ ¼) Ã— 100% | > 0.5% |
| **DEX æµåŠ¨æ€§** | æ± å­ä¸­çš„ USD ä»·å€¼ | > $100K |
| **DEX äº¤æ˜“é‡** | 24h äº¤æ˜“é‡ | > $50K |
| **CEX äº¤æ˜“é‡** | 24h äº¤æ˜“é‡ | > $100K |
| **äº¤æ˜“æˆæœ¬** | Gas + æ‰‹ç»­è´¹ + æ»‘ç‚¹ | < 0.3% |

---

## ä¸¤ç§å®ç°æ€è·¯å¯¹æ¯”

### æ€è·¯ Aï¼šDEX Firstï¼ˆPool Screener â†’ CEXï¼‰

**æµç¨‹ï¼š**
```
1. Pool Screener ç­›é€‰ DEX æ± å­
   â†“
2. è·å– DEX æ± å­çš„ä»£å¸å¯¹
   â†“
3. åœ¨ CEX æŸ¥æ‰¾å¯¹åº”äº¤æ˜“å¯¹
   â†“
4. è®¡ç®—ä»·å·®
   â†“
5. è¯„ä¼°å¯è¡Œæ€§
```

**ä¼˜åŠ¿ï¼š**
- âœ… DEX æ•°æ®å®Œæ•´ï¼ˆæµåŠ¨æ€§ã€äº¤æ˜“é‡ã€ä»·æ ¼ï¼‰
- âœ… å¯ä»¥ç­›é€‰é«˜è´¨é‡æ± å­
- âœ… é¿å…ä½æµåŠ¨æ€§ DEX æ± å­
- âœ… é€‚åˆå‘ç°æ–°çš„å¥—åˆ©æœºä¼š

**åŠ£åŠ¿ï¼š**
- âŒ DEX æ± å­æ•°é‡å·¨å¤§ï¼ˆBase é“¾ > 1000 ä¸ªï¼‰
- âŒ å¤§éƒ¨åˆ† DEX ä»£å¸åœ¨ CEX ä¸å­˜åœ¨
- âŒ éœ€è¦å¤§é‡ API è°ƒç”¨æ£€æŸ¥ CEX äº¤æ˜“å¯¹
- âŒ æ•ˆç‡ä½ï¼Œæµªè´¹èµ„æº

**é€‚ç”¨åœºæ™¯ï¼š**
- æ¢ç´¢æ€§åˆ†æ
- å‘ç°æ–°å¸ç§å¥—åˆ©æœºä¼š
- ä¸å…³å¿ƒå®æ—¶æ€§

---

### æ€è·¯ Bï¼šCEX Firstï¼ˆCEX â†’ DEX Searchï¼‰â­ï¸

**æµç¨‹ï¼š**
```
1. è·å– CEX æ”¯æŒçš„äº¤æ˜“å¯¹åˆ—è¡¨
   â†“
2. ç”¨ GeckoTerminal Search API æŸ¥æ‰¾å¯¹åº” DEX æ± å­
   â†“
3. ç­›é€‰ DEX æ± å­ï¼ˆæµåŠ¨æ€§ã€äº¤æ˜“é‡ï¼‰
   â†“
4. è®¡ç®—ä»·å·®
   â†“
5. è¯„ä¼°å¯è¡Œæ€§
```

**ä¼˜åŠ¿ï¼š**
- âœ… CEX äº¤æ˜“å¯¹æœ‰é™ï¼ˆå¸å®‰ ~500 ä¸ª USDT å¯¹ï¼‰
- âœ… ç¡®ä¿ CEX å¯¹æ‰‹æ–¹å­˜åœ¨
- âœ… é«˜æ•ˆï¼Œå‡å°‘æ— æ•ˆæŸ¥è¯¢
- âœ… é€‚åˆå®é™…äº¤æ˜“æ‰§è¡Œ
- âœ… æ˜“äºè‡ªåŠ¨åŒ–å’Œç›‘æ§

**åŠ£åŠ¿ï¼š**
- âŒ å¯èƒ½é”™è¿‡ä¸€äº›æ–°å¸ç§æœºä¼š
- âŒ ä¾èµ– CEX äº¤æ˜“å¯¹åˆ—è¡¨

**é€‚ç”¨åœºæ™¯ï¼š**
- å®é™…å¥—åˆ©äº¤æ˜“
- è‡ªåŠ¨åŒ–ç›‘æ§
- èµ„æºæœ‰é™çš„æƒ…å†µ

---

## æ¨èæ–¹æ¡ˆ

### ğŸ¯ æ¨èï¼šæ€è·¯ Bï¼ˆCEX Firstï¼‰

**åŸå› ï¼š**

1. **æ•ˆç‡æ›´é«˜**
   - CEX äº¤æ˜“å¯¹æ˜¯å·²çŸ¥ä¸”æœ‰é™çš„ï¼ˆ~500ä¸ªï¼‰
   - é¿å…æŸ¥è¯¢å¤§é‡ä¸å¯äº¤æ˜“çš„ DEX æ± å­

2. **å®ç”¨æ€§å¼º**
   - ç¡®ä¿ CEX å¯¹æ‰‹æ–¹å­˜åœ¨
   - å‡å°‘æ— æ•ˆå¥—åˆ©æœºä¼š

3. **æ˜“äºå®ç°**
   - CEX API è·å–äº¤æ˜“å¯¹åˆ—è¡¨
   - GeckoTerminal Search API æŸ¥æ‰¾å¯¹åº”æ± å­
   - ç­›é€‰å’Œè®¡ç®—ä»·å·®

4. **æˆæœ¬å¯æ§**
   - API è°ƒç”¨æ¬¡æ•°å¯é¢„æµ‹
   - é€‚åˆé€Ÿç‡é™åˆ¶ï¼ˆ30æ¬¡/åˆ†é’Ÿï¼‰

---

## å®Œæ•´æµç¨‹è®¾è®¡

### é˜¶æ®µ 1ï¼šæ•°æ®æ”¶é›†

#### 1.1 è·å– CEX äº¤æ˜“å¯¹åˆ—è¡¨

**ç›®æ ‡ï¼š** è·å–å¸å®‰ï¼ˆæˆ–å…¶ä»– CEXï¼‰æ‰€æœ‰ USDT äº¤æ˜“å¯¹

**å®ç°ï¼š**
```python
import ccxt

exchange = ccxt.binance()
markets = exchange.load_markets()

# ç­›é€‰ USDT äº¤æ˜“å¯¹
usdt_pairs = [
    symbol for symbol in markets.keys()
    if '/USDT' in symbol and markets[symbol]['active']
]

# ç»“æœç¤ºä¾‹
# ['BTC/USDT', 'ETH/USDT', 'SOL/USDT', ...]
```

**è¾“å‡ºï¼š**
- CEX äº¤æ˜“å¯¹åˆ—è¡¨ï¼ˆ~500 ä¸ªï¼‰
- ä¿å­˜ä¸ºï¼š`data/cex_trading_pairs.json`

---

#### 1.2 æŸ¥æ‰¾å¯¹åº”çš„ DEX æ± å­

**ç›®æ ‡ï¼š** ä¸ºæ¯ä¸ª CEX äº¤æ˜“å¯¹æ‰¾åˆ°å¯¹åº”çš„ DEX æ± å­

**å®ç°ï¼š**
```python
from geckoterminal_py import GeckoTerminalAsyncClient

gt = GeckoTerminalAsyncClient()

async def find_dex_pools(base_token: str, quote_token: str, network: str = "base"):
    """
    æœç´¢ DEX æ± å­
    
    Args:
        base_token: åŸºç¡€ä»£å¸ï¼ˆå¦‚ BTC, ETHï¼‰
        quote_token: æŠ¥ä»·ä»£å¸ï¼ˆå¦‚ USDC, USDTï¼‰
        network: ç½‘ç»œï¼ˆbase, ethereum, solanaï¼‰
    
    Returns:
        åŒ¹é…çš„æ± å­åˆ—è¡¨
    """
    # æœç´¢åŸºç¡€ä»£å¸çš„æ± å­
    results = await gt.search_pools(
        query=base_token,
        network=network
    )
    
    # ç­›é€‰åŒ…å«æŠ¥ä»·ä»£å¸çš„æ± å­
    matching_pools = []
    for pool in results['data']:
        pool_name = pool['attributes']['name']
        if quote_token in pool_name:
            matching_pools.append(pool)
    
    return matching_pools

# ä½¿ç”¨ç¤ºä¾‹
pools = await find_dex_pools("BTC", "USDC", "base")
```

**ç­›é€‰æ¡ä»¶ï¼š**
- âœ… æ± å­åç§°åŒ…å« CEX çš„ä¸¤ä¸ªä»£å¸
- âœ… æµåŠ¨æ€§ > $100K
- âœ… 24h äº¤æ˜“é‡ > $50K
- âœ… æ± å­å¹´é¾„ > 7 å¤©

**è¾“å‡ºï¼š**
- DEX æ± å­åˆ—è¡¨ï¼ˆæ¯ä¸ª CEX äº¤æ˜“å¯¹å¯¹åº” 0-N ä¸ªæ± å­ï¼‰
- ä¿å­˜ä¸ºï¼š`data/dex_pools_matched.json`

---

### é˜¶æ®µ 2ï¼šä»·å·®åˆ†æ

#### 2.1 è·å–å®æ—¶ä»·æ ¼

**CEX ä»·æ ¼ï¼š**
```python
# ä½¿ç”¨ ccxt è·å– CEX ä»·æ ¼
ticker = exchange.fetch_ticker('BTC/USDT')
cex_price = ticker['last']
```

**DEX ä»·æ ¼ï¼š**
```python
# ä» GeckoTerminal è·å–æ± å­ä»·æ ¼
pool_data = await gt.get_pool(network="base", pool_address="0x...")
dex_price = float(pool_data['data']['attributes']['base_token_price_usd'])
```

#### 2.2 è®¡ç®—ä»·å·®

```python
def calculate_price_difference(cex_price: float, dex_price: float) -> dict:
    """
    è®¡ç®—ä»·å·®
    
    Returns:
        {
            'absolute_diff': ç»å¯¹ä»·å·®,
            'percentage_diff': ç™¾åˆ†æ¯”ä»·å·®,
            'direction': å¥—åˆ©æ–¹å‘ï¼ˆ'dex_to_cex' æˆ– 'cex_to_dex'ï¼‰
        }
    """
    absolute_diff = abs(cex_price - dex_price)
    avg_price = (cex_price + dex_price) / 2
    percentage_diff = (absolute_diff / avg_price) * 100
    
    # ç¡®å®šå¥—åˆ©æ–¹å‘
    if dex_price < cex_price:
        direction = 'dex_to_cex'  # DEX ä¹°å…¥ï¼ŒCEX å–å‡º
    else:
        direction = 'cex_to_dex'  # CEX ä¹°å…¥ï¼ŒDEX å–å‡º
    
    return {
        'absolute_diff': absolute_diff,
        'percentage_diff': percentage_diff,
        'direction': direction,
        'cex_price': cex_price,
        'dex_price': dex_price
    }
```

**è¾“å‡ºï¼š**
- ä»·å·®åˆ†æç»“æœ
- ä¿å­˜ä¸ºï¼š`data/price_differences.json`

---

### é˜¶æ®µ 3ï¼šå¯è¡Œæ€§è¯„ä¼°

#### 3.1 äº¤æ˜“æˆæœ¬ä¼°ç®—

```python
def estimate_trading_cost(
    network: str,
    trade_amount_usd: float,
    dex_pool_liquidity: float
) -> dict:
    """
    ä¼°ç®—äº¤æ˜“æˆæœ¬
    
    Returns:
        {
            'gas_fee_usd': Gas è´¹ç”¨,
            'cex_fee_percentage': CEX æ‰‹ç»­è´¹ç™¾åˆ†æ¯”,
            'slippage_percentage': é¢„ä¼°æ»‘ç‚¹,
            'total_cost_percentage': æ€»æˆæœ¬ç™¾åˆ†æ¯”
        }
    """
    # Gas è´¹ç”¨ï¼ˆæ ¹æ®ç½‘ç»œï¼‰
    gas_fees = {
        'base': 0.1,      # Base é“¾ Gas è´¹å¾ˆä½
        'ethereum': 15,   # ä»¥å¤ªåŠä¸»ç½‘è¾ƒé«˜
        'arbitrum': 0.5,  # Arbitrum è¾ƒä½
        'optimism': 0.5   # Optimism è¾ƒä½
    }
    gas_fee_usd = gas_fees.get(network, 5)
    
    # CEX æ‰‹ç»­è´¹ï¼ˆå¸å®‰ç°è´§ï¼‰
    cex_fee_percentage = 0.1  # 0.1%
    
    # DEX æ»‘ç‚¹ä¼°ç®—ï¼ˆåŸºäºäº¤æ˜“é‡å æµåŠ¨æ€§æ¯”ä¾‹ï¼‰
    trade_ratio = trade_amount_usd / dex_pool_liquidity
    if trade_ratio < 0.01:  # < 1%
        slippage = 0.1
    elif trade_ratio < 0.05:  # 1-5%
        slippage = 0.3
    else:
        slippage = 0.5
    
    # æ€»æˆæœ¬
    gas_fee_percentage = (gas_fee_usd / trade_amount_usd) * 100
    total_cost = gas_fee_percentage + cex_fee_percentage + slippage
    
    return {
        'gas_fee_usd': gas_fee_usd,
        'gas_fee_percentage': gas_fee_percentage,
        'cex_fee_percentage': cex_fee_percentage,
        'slippage_percentage': slippage,
        'total_cost_percentage': total_cost
    }
```

#### 3.2 å¯è¡Œæ€§åˆ¤æ–­

```python
def is_arbitrage_feasible(
    price_diff_percentage: float,
    total_cost_percentage: float,
    min_profit_percentage: float = 0.5
) -> dict:
    """
    åˆ¤æ–­å¥—åˆ©æ˜¯å¦å¯è¡Œ
    
    Args:
        price_diff_percentage: ä»·å·®ç™¾åˆ†æ¯”
        total_cost_percentage: æ€»æˆæœ¬ç™¾åˆ†æ¯”
        min_profit_percentage: æœ€å°åˆ©æ¶¦è¦æ±‚
    
    Returns:
        {
            'is_feasible': æ˜¯å¦å¯è¡Œ,
            'net_profit_percentage': å‡€åˆ©æ¶¦ç™¾åˆ†æ¯”,
            'reason': åŸå› 
        }
    """
    net_profit = price_diff_percentage - total_cost_percentage
    
    if net_profit >= min_profit_percentage:
        return {
            'is_feasible': True,
            'net_profit_percentage': net_profit,
            'reason': f'Net profit {net_profit:.2f}% exceeds minimum {min_profit_percentage}%'
        }
    else:
        return {
            'is_feasible': False,
            'net_profit_percentage': net_profit,
            'reason': f'Net profit {net_profit:.2f}% below minimum {min_profit_percentage}%'
        }
```

**è¾“å‡ºï¼š**
- å¯è¡Œæ€§è¯„ä¼°ç»“æœ
- ä¿å­˜ä¸ºï¼š`data/feasibility_results.json`

---

### é˜¶æ®µ 4ï¼šç›‘æ§å’Œæ‰§è¡Œ

#### 4.1 å®æ—¶ç›‘æ§

```python
async def monitor_arbitrage_opportunities(
    trading_pairs: list,
    network: str = "base",
    check_interval: int = 10  # ç§’
):
    """
    å®æ—¶ç›‘æ§å¥—åˆ©æœºä¼š
    """
    while True:
        opportunities = []
        
        for pair in trading_pairs:
            # è·å–ä»·æ ¼
            cex_price = get_cex_price(pair)
            dex_pools = await find_dex_pools(pair['base'], pair['quote'], network)
            
            for pool in dex_pools:
                dex_price = get_dex_price(pool)
                
                # è®¡ç®—ä»·å·®
                diff = calculate_price_difference(cex_price, dex_price)
                
                # è¯„ä¼°æˆæœ¬
                cost = estimate_trading_cost(
                    network=network,
                    trade_amount_usd=1000,
                    dex_pool_liquidity=pool['liquidity']
                )
                
                # åˆ¤æ–­å¯è¡Œæ€§
                feasibility = is_arbitrage_feasible(
                    diff['percentage_diff'],
                    cost['total_cost_percentage']
                )
                
                if feasibility['is_feasible']:
                    opportunities.append({
                        'pair': pair,
                        'pool': pool,
                        'diff': diff,
                        'cost': cost,
                        'feasibility': feasibility,
                        'timestamp': datetime.now()
                    })
        
        # è®°å½•å’Œé€šçŸ¥
        if opportunities:
            log_opportunities(opportunities)
            send_notification(opportunities)
        
        await asyncio.sleep(check_interval)
```

#### 4.2 æ‰§è¡Œæµç¨‹ï¼ˆæ‰‹åŠ¨/è‡ªåŠ¨ï¼‰

**DEXä¹°å…¥ â†’ CEXå–å‡ºï¼š**
```
1. åœ¨ DEX ä½¿ç”¨ Swap åˆçº¦ä¹°å…¥ä»£å¸
2. ç­‰å¾…äº¤æ˜“ç¡®è®¤ï¼ˆ~1-5ç§’ï¼‰
3. å°†ä»£å¸è½¬åˆ° CEX å……å€¼åœ°å€
4. ç­‰å¾… CEX åˆ°è´¦ï¼ˆ~10-60ç§’ï¼‰
5. åœ¨ CEX å¸‚ä»·å–å‡º
```

**CEXä¹°å…¥ â†’ DEXå–å‡ºï¼š**
```
1. åœ¨ CEX å¸‚ä»·ä¹°å…¥ä»£å¸
2. ä» CEX æç°åˆ°é’±åŒ…ï¼ˆ~1-10åˆ†é’Ÿï¼‰
3. åœ¨ DEX ä½¿ç”¨ Swap åˆçº¦å–å‡º
4. æ”¶åˆ° USDT/USDC
```

---

## æŠ€æœ¯å®ç°ç»†èŠ‚

### æ•°æ®ç»“æ„è®¾è®¡

#### CEX-DEX äº¤æ˜“å¯¹æ˜ å°„

```python
@dataclass
class TradingPairMapping:
    """CEX-DEX äº¤æ˜“å¯¹æ˜ å°„"""
    # CEX ä¿¡æ¯
    cex_symbol: str              # 'BTC/USDT'
    cex_base: str                # 'BTC'
    cex_quote: str               # 'USDT'
    
    # DEX ä¿¡æ¯
    dex_network: str             # 'base'
    dex_pools: List[Dict]        # åŒ¹é…çš„æ± å­åˆ—è¡¨
    
    # çŠ¶æ€
    is_matched: bool             # æ˜¯å¦æ‰¾åˆ°åŒ¹é…æ± å­
    last_updated: datetime       # æœ€åæ›´æ–°æ—¶é—´

@dataclass
class ArbitrageOpportunity:
    """å¥—åˆ©æœºä¼š"""
    pair_mapping: TradingPairMapping
    
    # ä»·æ ¼
    cex_price: float
    dex_price: float
    price_diff_percentage: float
    direction: str  # 'dex_to_cex' or 'cex_to_dex'
    
    # æˆæœ¬
    gas_fee_usd: float
    total_cost_percentage: float
    
    # å¯è¡Œæ€§
    net_profit_percentage: float
    is_feasible: bool
    
    # æ± å­ä¿¡æ¯
    pool_address: str
    pool_liquidity_usd: float
    pool_volume_24h_usd: float
    
    # æ—¶é—´æˆ³
    timestamp: datetime
```

### ä»»åŠ¡å®ç°

#### Task 1: CEX-DEX é…å¯¹ä»»åŠ¡

**æ–‡ä»¶ï¼š** `app/tasks/data_collection/cex_dex_pair_matcher.py`

```python
class CexDexPairMatcherTask(BaseTask):
    """åŒ¹é… CEX äº¤æ˜“å¯¹å’Œ DEX æ± å­"""
    
    async def execute(self, context: TaskContext):
        # 1. è·å– CEX äº¤æ˜“å¯¹
        cex_pairs = self.get_cex_trading_pairs()
        
        # 2. ä¸ºæ¯ä¸ªäº¤æ˜“å¯¹æŸ¥æ‰¾ DEX æ± å­
        mappings = []
        for pair in cex_pairs:
            dex_pools = await self.find_dex_pools(pair)
            mapping = TradingPairMapping(
                cex_symbol=pair,
                dex_pools=dex_pools,
                is_matched=len(dex_pools) > 0
            )
            mappings.append(mapping)
        
        # 3. ä¿å­˜åˆ° MongoDB
        await self.save_mappings(mappings)
        
        return {
            'total_pairs': len(cex_pairs),
            'matched_pairs': sum(1 for m in mappings if m.is_matched),
            'total_pools': sum(len(m.dex_pools) for m in mappings)
        }
```

#### Task 2: ä»·å·®åˆ†æä»»åŠ¡

**æ–‡ä»¶ï¼š** `app/tasks/analysis/arbitrage_scanner.py`

```python
class ArbitrageScannerTask(BaseTask):
    """æ‰«æå¥—åˆ©æœºä¼š"""
    
    async def execute(self, context: TaskContext):
        # 1. åŠ è½½é…å¯¹å…³ç³»
        mappings = await self.load_mappings()
        
        # 2. è·å–å®æ—¶ä»·æ ¼å¹¶è®¡ç®—ä»·å·®
        opportunities = []
        for mapping in mappings:
            if not mapping.is_matched:
                continue
            
            cex_price = await self.get_cex_price(mapping.cex_symbol)
            
            for pool in mapping.dex_pools:
                dex_price = await self.get_dex_price(pool)
                
                # è®¡ç®—ä»·å·®
                diff = calculate_price_difference(cex_price, dex_price)
                
                # è¯„ä¼°å¯è¡Œæ€§
                cost = estimate_trading_cost(
                    network=mapping.dex_network,
                    trade_amount_usd=1000,
                    dex_pool_liquidity=pool['liquidity']
                )
                
                feasibility = is_arbitrage_feasible(
                    diff['percentage_diff'],
                    cost['total_cost_percentage']
                )
                
                if feasibility['is_feasible']:
                    opportunity = ArbitrageOpportunity(
                        pair_mapping=mapping,
                        cex_price=cex_price,
                        dex_price=dex_price,
                        price_diff_percentage=diff['percentage_diff'],
                        direction=diff['direction'],
                        gas_fee_usd=cost['gas_fee_usd'],
                        total_cost_percentage=cost['total_cost_percentage'],
                        net_profit_percentage=feasibility['net_profit_percentage'],
                        is_feasible=True,
                        pool_address=pool['address'],
                        pool_liquidity_usd=pool['liquidity'],
                        pool_volume_24h_usd=pool['volume_24h'],
                        timestamp=datetime.now()
                    )
                    opportunities.append(opportunity)
        
        # 3. ä¿å­˜æœºä¼šåˆ° MongoDB
        await self.save_opportunities(opportunities)
        
        # 4. å‘é€é€šçŸ¥ï¼ˆå¦‚æœæœ‰æœºä¼šï¼‰
        if opportunities:
            await self.send_notification(opportunities)
        
        return {
            'opportunities_found': len(opportunities),
            'total_scanned': len(mappings)
        }
```

### é…ç½®æ–‡ä»¶

**æ–‡ä»¶ï¼š** `config/cex_dex_arbitrage.yml`

```yaml
tasks:
  # é˜¶æ®µ 1: é…å¯¹ä»»åŠ¡ï¼ˆæ¯å¤©è¿è¡Œä¸€æ¬¡ï¼‰
  cex_dex_pair_matcher:
    enabled: true
    task_class: app.tasks.data_collection.cex_dex_pair_matcher.CexDexPairMatcherTask
    
    schedule:
      type: frequency
      frequency_hours: 24.0  # æ¯å¤©æ›´æ–°ä¸€æ¬¡é…å¯¹å…³ç³»
      timezone: UTC
    
    max_retries: 3
    retry_delay_seconds: 300
    timeout_seconds: 1800
    
    config:
      # CEX é…ç½®
      exchange: "binance"  # æˆ– 'okx', 'bybit'
      quote_currencies: ["USDT", "USDC"]
      
      # DEX é…ç½®
      networks: ["base", "arbitrum", "optimism"]
      min_pool_liquidity: 100000  # $100K
      min_pool_volume_24h: 50000  # $50K
      min_pool_age_days: 7
    
    tags:
      - arbitrage
      - pair_matching

  # é˜¶æ®µ 2: å¥—åˆ©æ‰«æï¼ˆæ¯åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ï¼‰
  arbitrage_scanner:
    enabled: true
    task_class: app.tasks.analysis.arbitrage_scanner.ArbitrageScannerTask
    
    schedule:
      type: frequency
      frequency_hours: 0.0167  # æ¯åˆ†é’Ÿï¼ˆ1/60ï¼‰
      timezone: UTC
    
    max_retries: 2
    retry_delay_seconds: 10
    timeout_seconds: 60
    
    config:
      # äº¤æ˜“å‚æ•°
      trade_amount_usd: 1000  # æµ‹è¯•é‡‘é¢
      min_profit_percentage: 0.5  # æœ€ä½åˆ©æ¶¦è¦æ±‚ 0.5%
      
      # é€šçŸ¥é…ç½®
      notify_on_opportunity: true
      notification_channels: ["telegram", "discord"]
      
      # è¿‡æ»¤æ¡ä»¶
      max_cost_percentage: 0.5  # æœ€å¤§æˆæœ¬ 0.5%
      min_pool_liquidity: 50000  # é™ä½è¦æ±‚åˆ° $50K
    
    tags:
      - arbitrage
      - scanner
      - realtime
```

---

## é£é™©å’ŒæŒ‘æˆ˜

### 1. æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|-----|------|---------|
| **ä»·æ ¼å»¶è¿Ÿ** | ä»·æ ¼å˜åŒ–å¯¼è‡´å¥—åˆ©å¤±è´¥ | ä½¿ç”¨ WebSocket å®æ—¶ä»·æ ¼ |
| **Gas è´¹æ³¢åŠ¨** | æˆæœ¬è¶…å‡ºé¢„æœŸ | åŠ¨æ€ Gas è´¹ä¼°ç®— |
| **äº¤æ˜“å¤±è´¥** | äº¤æ˜“æœªç¡®è®¤æˆ–å¤±è´¥ | è®¾ç½®åˆç†çš„ Gas Limit å’Œ slippage |
| **ç½‘ç»œæ‹¥å µ** | äº¤æ˜“å»¶è¿Ÿ | é€‰æ‹©ä½ Gas è´¹çš„é“¾ï¼ˆBase, Arbitrumï¼‰|

### 2. å¸‚åœºé£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|-----|------|---------|
| **æµåŠ¨æ€§ä¸è¶³** | å¤§é¢äº¤æ˜“å¯¼è‡´é«˜æ»‘ç‚¹ | é™åˆ¶å•ç¬”äº¤æ˜“é‡‘é¢ |
| **ä»·æ ¼å‰§çƒˆæ³¢åŠ¨** | å¥—åˆ©çª—å£æ¶ˆå¤± | å¿«é€Ÿæ‰§è¡Œï¼Œè®¾ç½®æ­¢æŸ |
| **ç«äº‰å¯¹æ‰‹** | å…¶ä»–å¥—åˆ©è€…æŠ¢å…ˆäº¤æ˜“ | ä¼˜åŒ–æ‰§è¡Œé€Ÿåº¦ |

### 3. æ“ä½œé£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|-----|------|---------|
| **èµ„é‡‘è¢«å¡** | æç°å»¶è¿Ÿå¯¼è‡´æ— æ³•åŠæ—¶å¥—åˆ© | åœ¨å¤šä¸ª CEX å‡†å¤‡èµ„é‡‘ |
| **API é™åˆ¶** | è¶…è¿‡é€Ÿç‡é™åˆ¶ | ä½¿ç”¨ä»˜è´¹ APIï¼Œå¢åŠ é™åˆ¶å¤„ç† |
| **äººä¸ºé”™è¯¯** | é”™è¯¯é…ç½®æˆ–æ“ä½œ | å……åˆ†æµ‹è¯•ï¼Œä½¿ç”¨æµ‹è¯•ç½‘ |

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç¬¬ä¸€é˜¶æ®µï¼šéªŒè¯å¯è¡Œæ€§ï¼ˆ1-2 å‘¨ï¼‰

**ç›®æ ‡ï¼š** è¯æ˜ç­–ç•¥åœ¨ç†è®ºä¸Šå¯è¡Œ

- [ ] **ä»»åŠ¡ 1.1ï¼š** å®ç° CEX äº¤æ˜“å¯¹è·å–
  - ä½¿ç”¨ ccxt åº“è·å–å¸å®‰ USDT äº¤æ˜“å¯¹
  - ä¿å­˜åˆ° JSON æ–‡ä»¶

- [ ] **ä»»åŠ¡ 1.2ï¼š** å®ç° DEX æ± å­æœç´¢
  - ä½¿ç”¨ GeckoTerminal Search API
  - åŒ¹é… CEX äº¤æ˜“å¯¹

- [ ] **ä»»åŠ¡ 1.3ï¼š** å†å²æ•°æ®åˆ†æ
  - æ”¶é›† 1 å‘¨çš„ä»·æ ¼æ•°æ®
  - åˆ†æå†å²ä»·å·®
  - ç»Ÿè®¡å¥—åˆ©æœºä¼šé¢‘ç‡

- [ ] **ä»»åŠ¡ 1.4ï¼š** æˆæœ¬ä¼°ç®—éªŒè¯
  - å®é™…æµ‹è¯•å°é¢äº¤æ˜“
  - è®°å½•çœŸå® Gas è´¹å’Œæ»‘ç‚¹
  - éªŒè¯æˆæœ¬æ¨¡å‹

**è¾“å‡ºï¼š**
- å¯è¡Œæ€§æŠ¥å‘Š
- å†å²å¥—åˆ©æœºä¼šç»Ÿè®¡
- æˆæœ¬æ¨¡å‹éªŒè¯ç»“æœ

---

### ç¬¬äºŒé˜¶æ®µï¼šåŸå‹å¼€å‘ï¼ˆ2-3 å‘¨ï¼‰

**ç›®æ ‡ï¼š** å¼€å‘è‡ªåŠ¨åŒ–ç›‘æ§ç³»ç»Ÿ

- [ ] **ä»»åŠ¡ 2.1ï¼š** å¼€å‘é…å¯¹ä»»åŠ¡
  - å®ç° `CexDexPairMatcherTask`
  - é…ç½®æ–‡ä»¶å’Œæ•°æ®åº“è®¾è®¡

- [ ] **ä»»åŠ¡ 2.2ï¼š** å¼€å‘æ‰«æä»»åŠ¡
  - å®ç° `ArbitrageScannerTask`
  - ä»·å·®è®¡ç®—å’Œå¯è¡Œæ€§è¯„ä¼°

- [ ] **ä»»åŠ¡ 2.3ï¼š** å®æ—¶ç›‘æ§ç³»ç»Ÿ
  - WebSocket æ¥å…¥ CEX ä»·æ ¼
  - å®æ—¶è®¡ç®—ä»·å·®
  - é€šçŸ¥ç³»ç»Ÿï¼ˆTelegram/Discordï¼‰

- [ ] **ä»»åŠ¡ 2.4ï¼š** æ•°æ®å¯è§†åŒ–
  - Jupyter Notebook åˆ†æ
  - ä»·å·®è¶‹åŠ¿å›¾è¡¨
  - å¥—åˆ©æœºä¼šç»Ÿè®¡

**è¾“å‡ºï¼š**
- è‡ªåŠ¨åŒ–ç›‘æ§ç³»ç»Ÿ
- å®æ—¶é€šçŸ¥åŠŸèƒ½
- æ•°æ®åˆ†æ Notebook

---

### ç¬¬ä¸‰é˜¶æ®µï¼šæµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ2-3 å‘¨ï¼‰

**ç›®æ ‡ï¼š** åœ¨æµ‹è¯•ç½‘éªŒè¯å®Œæ•´æµç¨‹

- [ ] **ä»»åŠ¡ 3.1ï¼š** æµ‹è¯•ç½‘éƒ¨ç½²
  - åœ¨ Base Goerli æµ‹è¯•ç½‘æµ‹è¯•
  - éªŒè¯ DEX Swap æµç¨‹

- [ ] **ä»»åŠ¡ 3.2ï¼š** æ¨¡æ‹Ÿäº¤æ˜“
  - çº¸ä¸Šäº¤æ˜“ï¼ˆPaper Tradingï¼‰
  - è®°å½•æ¯ç¬”æ¨¡æ‹Ÿäº¤æ˜“ç»“æœ

- [ ] **ä»»åŠ¡ 3.3ï¼š** æ€§èƒ½ä¼˜åŒ–
  - å‡å°‘ API è°ƒç”¨æ¬¡æ•°
  - ä¼˜åŒ–ä»·æ ¼è·å–é€Ÿåº¦
  - æé«˜æ‰«ææ•ˆç‡

- [ ] **ä»»åŠ¡ 3.4ï¼š** é£é™©æ§åˆ¶
  - è®¾ç½®æ­¢æŸæœºåˆ¶
  - å•ç¬”äº¤æ˜“é‡‘é¢é™åˆ¶
  - å¼‚å¸¸æƒ…å†µå¤„ç†

**è¾“å‡ºï¼š**
- æµ‹è¯•æŠ¥å‘Š
- ä¼˜åŒ–åçš„ç³»ç»Ÿ
- é£é™©æ§åˆ¶æœºåˆ¶

---

### ç¬¬å››é˜¶æ®µï¼šå°è§„æ¨¡å®ç›˜ï¼ˆ1-2 å‘¨ï¼‰

**ç›®æ ‡ï¼š** ç”¨å°èµ„é‡‘éªŒè¯å®ç›˜æ•ˆæœ

- [ ] **ä»»åŠ¡ 4.1ï¼š** èµ„é‡‘å‡†å¤‡
  - CEX å……å€¼ï¼ˆå»ºè®® $1000-5000ï¼‰
  - é’±åŒ…å‡†å¤‡ Gas è´¹

- [ ] **ä»»åŠ¡ 4.2ï¼š** å°é¢äº¤æ˜“æµ‹è¯•
  - å•ç¬” $100-500
  - è®°å½•æ¯ç¬”äº¤æ˜“
  - åˆ†æç›ˆäº

- [ ] **ä»»åŠ¡ 4.3ï¼š** æ•°æ®æ”¶é›†å’Œåˆ†æ
  - å®é™…æˆæœ¬ç»Ÿè®¡
  - ç›ˆåˆ©ç‡åˆ†æ
  - é—®é¢˜æ€»ç»“

**è¾“å‡ºï¼š**
- å®ç›˜æµ‹è¯•æŠ¥å‘Š
- çœŸå®æ”¶ç›Šæ•°æ®
- æ”¹è¿›å»ºè®®

---

## é™„å½•

### A. æ¨èå·¥å…·å’Œåº“

**Python åº“ï¼š**
- `ccxt` - ç»Ÿä¸€çš„ CEX API æ¥å£
- `web3.py` - ä»¥å¤ªåŠäº¤äº’
- `geckoterminal_py` - GeckoTerminal API å®¢æˆ·ç«¯
- `pandas` - æ•°æ®åˆ†æ
- `asyncio` - å¼‚æ­¥ç¼–ç¨‹

**æœåŠ¡ï¼š**
- **GeckoTerminal** - DEX æ•°æ®
- **å¸å®‰ API** - CEX æ•°æ®
- **Infura/Alchemy** - åŒºå—é“¾èŠ‚ç‚¹
- **Telegram Bot** - é€šçŸ¥

### B. å‚è€ƒèµ„æº

- [GeckoTerminal API æ–‡æ¡£](./GECKOTERMINAL_API_REFERENCE.md)
- [ccxt æ–‡æ¡£](https://docs.ccxt.com/)
- [Uniswap V3 æ–‡æ¡£](https://docs.uniswap.org/)
- [Web3.py æ–‡æ¡£](https://web3py.readthedocs.io/)

### C. æˆæœ¬ä¼°ç®—å‚è€ƒ

**ä¸åŒç½‘ç»œçš„ Swap Gas è´¹ï¼š**

| ç½‘ç»œ | Gas è´¹ï¼ˆUSDï¼‰| é€‚åˆé‡‘é¢ |
|-----|-------------|----------|
| Ethereum | $15-50 | > $10,000 |
| Arbitrum | $0.5-2 | > $500 |
| Optimism | $0.5-2 | > $500 |
| Base | $0.1-0.5 | > $200 |
| Polygon | $0.05-0.2 | > $100 |

**CEX æ‰‹ç»­è´¹ï¼š**
- å¸å®‰ç°è´§ï¼š0.1%ï¼ˆVIP 0ï¼‰
- OKX ç°è´§ï¼š0.1%
- Bybit ç°è´§ï¼š0.1%

**æç°è´¹ç”¨ï¼š**
- USDT (ERC-20): ~$1-10
- USDT (Base): ~$0.5-2
- USDT (TRC-20): ~$1

---

**æœ€åæ›´æ–°ï¼š** 2025-10-05  
**ä¸‹æ¬¡å®¡æŸ¥ï¼š** å®Œæˆç¬¬ä¸€é˜¶æ®µå  
**è´Ÿè´£äººï¼š** Alice


