# ğŸ—‘ï¸ è®¢å•ç°¿æ•°æ®æ¸…ç†æŒ‡å—

## âœ… **ä¿®å¤å®Œæˆ**

å·²ä¿®å¤ `scripts/cleanup_old_orderbook_data.py` è„šæœ¬ä¸­çš„è·¯å¾„é”™è¯¯ã€‚

**ä¿®å¤å†…å®¹**ï¼š
- âŒ æ—§ä»£ç ï¼š`data_paths.orderbook_snapshots_dir`ï¼ˆä¸å­˜åœ¨çš„å±æ€§ï¼‰
- âœ… æ–°ä»£ç ï¼š`data_paths.raw_dir / "orderbook_snapshots"`ï¼ˆæ­£ç¡®è·¯å¾„ï¼‰

---

## ğŸ“Š **å½“å‰æ•°æ®çŠ¶æ€**

```
ğŸ“ è®¢å•ç°¿æ•°æ®ç›®å½•: app/data/raw/orderbook_snapshots/
   â€¢ æ€»æ–‡ä»¶æ•°: 17 ä¸ª
   â€¢ æ€»å¤§å°: 1.94 MB
   â€¢ æ—§æ–‡ä»¶æ•°: 0 ä¸ªï¼ˆéƒ½åœ¨ä¿ç•™æœŸå†…ï¼‰
   â€¢ ç£ç›˜å¯ç”¨: 41.2 GB
```

---

## ğŸš€ **ä½¿ç”¨æ–¹æ³•**

### **1. é¢„è§ˆæ¨¡å¼ï¼ˆæ¨èå…ˆä½¿ç”¨ï¼‰**

```bash
# é¢„è§ˆå°†è¦åˆ é™¤çš„æ–‡ä»¶ï¼Œä¸å®é™…åˆ é™¤
python scripts/cleanup_old_orderbook_data.py --days 7 --dry-run
```

**è¾“å‡ºç¤ºä¾‹**ï¼š

```
ğŸ—‘ï¸  è®¢å•ç°¿æ•°æ®æ¸…ç†é¢„è§ˆæŠ¥å‘Š
================================================================================

ğŸ“Š æ–‡ä»¶ç»Ÿè®¡:
   â€¢ æ€»æ–‡ä»¶æ•°: 17
   â€¢ æ—§æ–‡ä»¶æ•°: 0
   â€¢ å°†åˆ é™¤: 0 ä¸ªæ–‡ä»¶

ğŸ’¾ ç©ºé—´ç»Ÿè®¡:
   â€¢ æ•°æ®ç›®å½•æ€»å¤§å°: 1.94 MB
   â€¢ å°†é‡Šæ”¾ç©ºé—´: 0.00 MB

âœ… æ— éœ€æ¸…ç†
   æ‰€æœ‰æ–‡ä»¶éƒ½åœ¨ä¿ç•™æœŸå†…
```

---

### **2. å®é™…åˆ é™¤**

```bash
# åˆ é™¤è¶…è¿‡ 7 å¤©çš„æ•°æ®
python scripts/cleanup_old_orderbook_data.py --days 7

# åˆ é™¤è¶…è¿‡ 14 å¤©çš„æ•°æ®
python scripts/cleanup_old_orderbook_data.py --days 14

# åˆ é™¤è¶…è¿‡ 30 å¤©çš„æ•°æ®
python scripts/cleanup_old_orderbook_data.py --days 30
```

---

### **3. æŸ¥çœ‹å¸®åŠ©**

```bash
python scripts/cleanup_old_orderbook_data.py --help
```

---

## âš™ï¸ **å‚æ•°è¯´æ˜**

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `--days N` | ä¿ç•™æœ€è¿‘ N å¤©çš„æ•°æ® | 7 |
| `--dry-run` | é¢„è§ˆæ¨¡å¼ï¼Œä¸å®é™…åˆ é™¤ | False |
| `--help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ | - |

---

## ğŸ“… **æ¸…ç†ç­–ç•¥ç¤ºä¾‹**

### **åœºæ™¯ 1ï¼šå¼€å‘æµ‹è¯•ï¼ˆä¿ç•™ 3 å¤©ï¼‰**

```bash
# é¢„è§ˆ
python scripts/cleanup_old_orderbook_data.py --days 3 --dry-run

# æ‰§è¡Œ
python scripts/cleanup_old_orderbook_data.py --days 3
```

**é€‚ç”¨äº**ï¼š
- é¢‘ç¹æµ‹è¯•å’Œè°ƒè¯•
- ç£ç›˜ç©ºé—´ç´§å¼ 
- åªå…³å¿ƒæœ€æ–°æ•°æ®

---

### **åœºæ™¯ 2ï¼šæ­£å¸¸è¿è¥ï¼ˆä¿ç•™ 7 å¤©ï¼‰**

```bash
python scripts/cleanup_old_orderbook_data.py --days 7
```

**é€‚ç”¨äº**ï¼š
- æ—¥å¸¸äº¤æ˜“ç­–ç•¥
- çŸ­æœŸå›æµ‹éœ€æ±‚
- å¹³è¡¡å­˜å‚¨å’Œæ•°æ®éœ€æ±‚

---

### **åœºæ™¯ 3ï¼šé•¿æœŸå›æµ‹ï¼ˆä¿ç•™ 30 å¤©ï¼‰**

```bash
python scripts/cleanup_old_orderbook_data.py --days 30
```

**é€‚ç”¨äº**ï¼š
- ç­–ç•¥éªŒè¯å’Œä¼˜åŒ–
- éœ€è¦è¾ƒé•¿å†å²æ•°æ®
- å……è¶³çš„ç£ç›˜ç©ºé—´

---

## ğŸ¤– **è‡ªåŠ¨åŒ–æ¸…ç†ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰**

### **æ–¹æ³• 1ï¼šCronï¼ˆLinux/macOSï¼‰**

```bash
# ç¼–è¾‘ crontab
crontab -e
```

æ·»åŠ ä»¥ä¸‹è¡Œï¼š

```cron
# æ¯å¤©å‡Œæ™¨ 2 ç‚¹æ¸…ç†è¶…è¿‡ 7 å¤©çš„æ•°æ®
0 2 * * * cd /Users/alice/Dropbox/æŠ•èµ„/é‡åŒ–äº¤æ˜“/quants-lab && python scripts/cleanup_old_orderbook_data.py --days 7 >> logs/cleanup.log 2>&1

# æ¯å‘¨æ—¥å‡Œæ™¨ 3 ç‚¹æ¸…ç†è¶…è¿‡ 30 å¤©çš„æ•°æ®
0 3 * * 0 cd /Users/alice/Dropbox/æŠ•èµ„/é‡åŒ–äº¤æ˜“/quants-lab && python scripts/cleanup_old_orderbook_data.py --days 30 >> logs/cleanup.log 2>&1
```

---

### **æ–¹æ³• 2ï¼šåˆ›å»ºæ¸…ç†è„šæœ¬**

åˆ›å»º `scripts/auto_cleanup.sh`ï¼š

```bash
#!/bin/bash
# è‡ªåŠ¨æ¸…ç†è®¢å•ç°¿æ•°æ®

cd /Users/alice/Dropbox/æŠ•èµ„/é‡åŒ–äº¤æ˜“/quants-lab

# è®°å½•å¼€å§‹æ—¶é—´
echo "[$(date)] å¼€å§‹æ¸…ç†è®¢å•ç°¿æ•°æ®..."

# æ‰§è¡Œæ¸…ç†
python scripts/cleanup_old_orderbook_data.py --days 7

# è®°å½•ç»“æŸæ—¶é—´
echo "[$(date)] æ¸…ç†å®Œæˆ"
echo "----------------------------------------"
```

æ·»åŠ æ‰§è¡Œæƒé™ï¼š

```bash
chmod +x scripts/auto_cleanup.sh
```

---

## ğŸ“ˆ **å­˜å‚¨ç©ºé—´ä¼°ç®—**

### **ä¸åŒä¿ç•™æœŸçš„ç©ºé—´å ç”¨**

åŸºäºä½ å½“å‰çš„é‡‡é›†è®¾ç½®ï¼ˆ6ä¸ªäº¤æ˜“å¯¹ï¼Œ5ç§’é—´éš”ï¼‰ï¼š

| ä¿ç•™å¤©æ•° | é¢„è®¡æ–‡ä»¶æ•° | é¢„è®¡ç©ºé—´ |
|---------|-----------|----------|
| 1 å¤© | 6 | 126 MB |
| 3 å¤© | 18 | 378 MB |
| 7 å¤© | 42 | 882 MB |
| 14 å¤© | 84 | 1.76 GB |
| 30 å¤© | 180 | 3.78 GB |

**è®¡ç®—å…¬å¼**ï¼š
```
å•ä¸ªæ–‡ä»¶ = 21 MB
æ€»æ–‡ä»¶æ•° = 6 ä¸ªäº¤æ˜“å¯¹ Ã— ä¿ç•™å¤©æ•°
æ€»ç©ºé—´ = æ€»æ–‡ä»¶æ•° Ã— 21 MB
```

---

## ğŸ” **æ¸…ç†å‰çš„æ£€æŸ¥æ¸…å•**

### **1. æŸ¥çœ‹å½“å‰æ•°æ®**

```bash
# æŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶
ls -lh app/data/raw/orderbook_snapshots/

# ç»Ÿè®¡æ–‡ä»¶æ•°å’Œæ€»å¤§å°
du -sh app/data/raw/orderbook_snapshots/
ls app/data/raw/orderbook_snapshots/*.parquet | wc -l
```

---

### **2. ç¡®è®¤ä¿ç•™æœŸ**

```bash
# æŸ¥çœ‹æœ€æ—©å’Œæœ€æ–°çš„æ–‡ä»¶æ—¥æœŸ
ls app/data/raw/orderbook_snapshots/ | grep "20251" | sort | head -1
ls app/data/raw/orderbook_snapshots/ | grep "20251" | sort | tail -1
```

---

### **3. ä½¿ç”¨é¢„è§ˆæ¨¡å¼**

```bash
# å…ˆé¢„è§ˆè¦åˆ é™¤ä»€ä¹ˆ
python scripts/cleanup_old_orderbook_data.py --days 7 --dry-run
```

---

## ğŸš¨ **è­¦å‘Šå’Œæ³¨æ„äº‹é¡¹**

### âš ï¸ **é‡è¦æé†’**

1. **æ•°æ®ä¸å¯æ¢å¤**ï¼šåˆ é™¤çš„æ–‡ä»¶æ— æ³•æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œ
2. **å…ˆä½¿ç”¨é¢„è§ˆ**ï¼šå§‹ç»ˆå…ˆç”¨ `--dry-run` é¢„è§ˆ
3. **ç¡®è®¤å¤‡ä»½**ï¼šå¦‚éœ€å¤‡ä»½ï¼Œå…ˆå¤‡ä»½å†åˆ é™¤
4. **åœæ­¢é‡‡é›†**ï¼šæ¸…ç†æœŸé—´å»ºè®®åœæ­¢é‡‡é›†æœåŠ¡

---

### **å®‰å…¨æ¸…ç†æµç¨‹**

```bash
# 1. åœæ­¢é‡‡é›†
bash scripts/stop_all_orderbook.sh

# 2. é¢„è§ˆæ¸…ç†
python scripts/cleanup_old_orderbook_data.py --days 7 --dry-run

# 3. ç¡®è®¤æ— è¯¯åæ‰§è¡Œ
python scripts/cleanup_old_orderbook_data.py --days 7

# 4. é‡å¯é‡‡é›†
python cli.py run-tasks --config config/orderbook_snapshot_gateio.yml &
```

---

## ğŸ“‹ **æ¸…ç†æŠ¥å‘Šç¤ºä¾‹**

### **æœ‰æ–‡ä»¶éœ€è¦æ¸…ç†æ—¶**

```
ğŸ—‘ï¸  è®¢å•ç°¿æ•°æ®æ¸…ç†æŠ¥å‘Š
================================================================================

ğŸ“Š æ–‡ä»¶ç»Ÿè®¡:
   â€¢ æ€»æ–‡ä»¶æ•°: 42
   â€¢ æ—§æ–‡ä»¶æ•°: 15
   â€¢ âœ… å·²åˆ é™¤: 15 ä¸ªæ–‡ä»¶

ğŸ’¾ ç©ºé—´ç»Ÿè®¡:
   â€¢ æ•°æ®ç›®å½•æ€»å¤§å°: 882.00 MB (0.86 GB)
   â€¢ å·²é‡Šæ”¾ç©ºé—´: 315.00 MB (0.31 GB)
   â€¢ å¹³å‡æ–‡ä»¶å¤§å°: 21.00 MB

ğŸ’¿ ç£ç›˜ä½¿ç”¨æƒ…å†µ:
   æ¸…ç†å‰:
      â€¢ æ€»ç©ºé—´: 926.4 GB
      â€¢ å·²ä½¿ç”¨: 885.2 GB (95.6%)
      â€¢ å¯ç”¨: 41.2 GB
   æ¸…ç†å:
      â€¢ å¯ç”¨: 41.5 GB
      â€¢ é‡Šæ”¾: 0.31 GB

âœ… å·²åˆ é™¤çš„æ–‡ä»¶ (å‰10ä¸ª):
    1. gate_io_VIRTUAL-USDT_20251101.parquet    21.00 MB  2025-11-01
    2. gate_io_IRON-USDT_20251101.parquet       21.00 MB  2025-11-01
    3. gate_io_LMTS-USDT_20251101.parquet       21.00 MB  2025-11-01
   ...

âœ… æ¸…ç†å®Œæˆï¼
   é‡Šæ”¾äº† 0.31 GB ç£ç›˜ç©ºé—´
```

---

## ğŸ’¡ **æœ€ä½³å®è·µ**

### **1. å®šæœŸæ¸…ç†**

```bash
# æ¯å‘¨æ¸…ç†ä¸€æ¬¡
0 2 * * 0 cd /path/to/quants-lab && python scripts/cleanup_old_orderbook_data.py --days 7
```

---

### **2. ç›‘æ§ç£ç›˜ç©ºé—´**

```bash
# æ£€æŸ¥ç£ç›˜ä½¿ç”¨ç‡
df -h /Users/alice/Dropbox

# æ£€æŸ¥è®¢å•ç°¿ç›®å½•å¤§å°
du -sh app/data/raw/orderbook_snapshots/
```

---

### **3. å½’æ¡£é‡è¦æ•°æ®**

```bash
# å‹ç¼©å¹¶å½’æ¡£ 10 å¤©å‰çš„æ•°æ®
tar -czf orderbook_archive_$(date +%Y%m%d).tar.gz \
    app/data/raw/orderbook_snapshots/*_202511[01-06]*.parquet

# ä¸Šä¼ åˆ°äº‘å­˜å‚¨ï¼ˆå¯é€‰ï¼‰
# aws s3 cp orderbook_archive_*.tar.gz s3://my-bucket/archive/
```

---

## ğŸ¯ **å¿«é€Ÿå‚è€ƒ**

```bash
# é¢„è§ˆï¼ˆå®‰å…¨ï¼‰
python scripts/cleanup_old_orderbook_data.py --days 7 --dry-run

# åˆ é™¤è¶…è¿‡ 7 å¤©
python scripts/cleanup_old_orderbook_data.py --days 7

# æŸ¥çœ‹æ–‡ä»¶
ls -lh app/data/raw/orderbook_snapshots/

# æŸ¥çœ‹æ€»å¤§å°
du -sh app/data/raw/orderbook_snapshots/

# ç»Ÿè®¡æ–‡ä»¶æ•°
ls app/data/raw/orderbook_snapshots/*.parquet | wc -l
```

---

## â“ **å¸¸è§é—®é¢˜**

### **Q1: å¦‚ä½•ç¡®å®šä¿ç•™å¤šå°‘å¤©åˆé€‚ï¼Ÿ**

**A:** å–å†³äºä½ çš„éœ€æ±‚ï¼š
- **çŸ­æœŸäº¤æ˜“**ï¼š3-7 å¤©
- **ç­–ç•¥å›æµ‹**ï¼š14-30 å¤©
- **ç ”ç©¶åˆ†æ**ï¼š30-90 å¤©

### **Q2: æ¸…ç†ä¼šå½±å“æ­£åœ¨è¿è¡Œçš„é‡‡é›†ä»»åŠ¡å—ï¼Ÿ**

**A:** 
- âœ… ä¸ä¼šå½±å“ï¼ˆæ–°æ•°æ®å†™å…¥æ–°æ–‡ä»¶ï¼‰
- âš ï¸ ä½†å»ºè®®åœ¨ä½å³°æœŸæ‰§è¡Œ

### **Q3: å¦‚ä½•æ¢å¤è¯¯åˆ çš„æ•°æ®ï¼Ÿ**

**A:**
- âŒ æ— æ³•æ¢å¤ï¼ˆæ–‡ä»¶å·²åˆ é™¤ï¼‰
- âœ… é‡æ–°é‡‡é›†ï¼ˆä»å½“å‰æ—¶é—´å¼€å§‹ï¼‰
- âœ… ä»å¤‡ä»½æ¢å¤ï¼ˆå¦‚æœæœ‰ï¼‰

### **Q4: èƒ½å¦åªåˆ é™¤ç‰¹å®šäº¤æ˜“å¯¹çš„æ•°æ®ï¼Ÿ**

**A:** ç›®å‰è„šæœ¬ä¸æ”¯æŒï¼Œä½†å¯ä»¥æ‰‹åŠ¨åˆ é™¤ï¼š

```bash
# åªåˆ é™¤ IRON-USDT çš„æ—§æ•°æ®
rm app/data/raw/orderbook_snapshots/gate_io_IRON-USDT_202510*.parquet
```

---

## ğŸ‰ **æ€»ç»“**

âœ… **è„šæœ¬å·²ä¿®å¤**ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨  
âœ… **å½“å‰æ— éœ€æ¸…ç†**ï¼Œæ‰€æœ‰æ–‡ä»¶éƒ½åœ¨ä¿ç•™æœŸå†…  
âœ… **å»ºè®®ä¿ç•™ 7-14 å¤©**ï¼Œå¹³è¡¡å­˜å‚¨å’Œéœ€æ±‚  
âœ… **ä½¿ç”¨é¢„è§ˆæ¨¡å¼**ï¼Œç¡®ä¿å®‰å…¨  

**ç°åœ¨ä½ å¯ä»¥å®‰å…¨åœ°ç®¡ç†è®¢å•ç°¿æ•°æ®äº†ï¼** ğŸš€âœ¨

